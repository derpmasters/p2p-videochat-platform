(this.webpackJsonpquackamole=this.webpackJsonpquackamole||[]).push([[0],{176:function(e,t,a){e.exports=a(252)},178:function(e,t,a){},216:function(e,t){},252:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=(a(178),a(11)),c=a.n(o),i=a(18),l=a(42),s=a(146),u=a(147),d=a(22),m=Object(d.a)((function(e,t){switch(t.type){case"SET_CURRENT_ROOM":return e.data=t.payload.room,void(e.error=null);case"SET_CURRENT_ROOM_ERROR":return void(e.error=t.payload.error)}}),{data:{},error:null}),p=a(21),f=a(148),g=a.n(f),h=function(e){e&&e.getTracks().forEach((function(e){return e.stop()}))},E=function(e){var t=localStorage.getItem(e);return t?JSON.parse(t):{}},y={socket:null,metadata:E("metadata"),loading:!1,error:null},b=Object(d.a)((function(e,t){switch(t.type){case"SET_LOCAL_USER_LOADING":return void(e.loading=t.payload.loading);case"INIT_LOCAL_USER_SOCKET":return e.socket=t.payload.socket,void(e.error=null);case"SET_LOCAL_USER_METADATA":return e.metadata=t.payload.metadata,void(e.error=null);case"SET_LOCAL_USER_ERROR":return void(e.error=t.payload.error);case"RESET_LOCAL_USER":return e.socket=null,e.loading=!1,e.metadata=E("metadata"),void(e.error=null)}}),y),x=Object(d.a)((function(e,t){switch(t.type){case"ADD_PEER":var a=t.payload,n=a.socketId,r=a.metadata;return e.data[n]={metadata:r},void(e.error=null);case"REMOVE_PEER":var o=t.payload.peer;return delete e.data[o.id],void(e.error=null);case"SET_PEERS_ERROR":return void(e.error=t.payload.error)}}),{data:{},error:null}),v=Object(d.a)((function(e,t){switch(t.type){case"ADD_CONNECTION":var a=t.payload.connection;return e.data[a.remoteSocketId]=a,void(e.error=null);case"REMOVE_CONNECTION":var n=t.payload.connection;return delete e.data[n.remoteSocketId],void(e.error=null);case"SET_CONNECTIONS_ERROR":return void(e.error=t.payload.error)}}),{data:{},error:null}),k=Object(d.a)((function(e,t){switch(t.type){case"ADD_STREAM":var a=t.payload,n=a.socketId,r=a.stream;return e.data[n]=r,void(e.error=null);case"REMOVE_STREAM":var o=t.payload.socketId,c=e.data[o];return h(c),void delete e.data[o];case"SET_STREAM_ERROR":return void(e.error=t.payload.error);case"CLEAR_ALL_STREAMS":return Object.values(e.data).forEach(h),e.data={},void(e.error=null)}}),{data:{},error:null}),S=Object(d.a)((function(e,t){switch(t.type){case"SET_PLUGIN":var a=t.payload.plugin,n=a.url,r=a.name,o=a.iframe;return e.iframe=o,e.url=n,e.name=r,void(e.error=null);case"SET_PLUGIN_ERROR":return void(e.error=t.payload.error)}}),{iframe:null,url:"",name:"p2p-test-plugin",error:null}),O=Object(d.a)((function(e,t){switch(t.type){case"ADD_NEW_MESSAGE":return void e.push(t.payload)}}),[]),w=Object(l.combineReducers)({room:m,localUser:b,peers:x,connections:v,streams:k,plugin:S,chat:O}),C=Object(l.createStore)(w,Object(u.composeWithDevTools)(Object(l.applyMiddleware)(s.a))),R=a(26),I=a(12),j=a(280),N=a(282),T=a(165),D=Object(T.a)({palette:{primary:{main:"#2E7D32"},secondary:{main:"#FBC02D"}}}),_=a(298),L=a(93),A=a(295),U=a(286),P=a(86),M=a.n(P),B=a(8),z=a.n(B),F=a(14),G=a(152),q=a.n(G),W=function(e,t){return function(a,n){t&&a({type:"ADD_STREAM",payload:{socketId:e,stream:t}})}},J=function(e){return function(t,a){e&&t({type:"REMOVE_STREAM",payload:{socketId:e}})}},K=function(e,t){return function(){var a=Object(F.a)(z.a.mark((function a(n,r){var o,c,i,l;return z.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=e||r().localUser.socket,e){a.next=3;break}return a.abrupt("return");case 3:if(c=e.id,r().streams.data[c]){a.next=20;break}return a.prev=6,i={audio:!0,video:{frameRate:{ideal:20,max:25},width:{ideal:128},height:{ideal:72}}},a.next=10,navigator.mediaDevices.getUserMedia(t||i);case 10:return l=a.sent,n(W(o.id,l)),a.abrupt("return",l);case 15:a.prev=15,a.t0=a.catch(6),console.error("local stream couldnt be started",a.t0);case 18:a.next=21;break;case 20:console.log("local stream already active");case 21:case"end":return a.stop()}}),a,null,[[6,15]])})));return function(e,t){return a.apply(this,arguments)}}()},V=function(e){return{type:"SET_CURRENT_ROOM_ERROR",payload:{error:e}}},H=function(e){return function(){var t=Object(F.a)(z.a.mark((function t(a,n){return z.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e||!e.socketId){t.next=6;break}return console.log("addConnection",e),t.next=4,a({type:"ADD_CONNECTION",payload:{connection:e}});case 4:return t.next=6,a(Y(e));case 6:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}()},Q=function(e){return function(){var t=Object(F.a)(z.a.mark((function t(a,n){return z.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e&&e.remoteSocketId&&e.socketId)){t.next=7;break}if(!n().streams.data[e.remoteSocketId]){t.next=5;break}return t.next=5,a(J(e.remoteSocketId));case 5:return t.next=7,a({type:"REMOVE_CONNECTION",payload:{connection:e}});case 7:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}()},X=function(e){return function(t,a){console.log("initDataChannelListeners",e),e&&(e.onmessage=function(e){console.log("received message: ",e);var n=JSON.parse(e.data),r=n.type;if(n.textMessage){t({type:"ADD_NEW_MESSAGE",payload:n.textMessage});var o=a().localUser.metadata;console.log("%c MESSAGE - ".concat(o.nickname||n.textMessage.authorSocketId,': "').concat(n.textMessage.text,'"'),"background: black; color: white; padding: 1rem; border: 1px solid white; border-radius: 5px;")}if("PLUGIN_DATA"===r){window.postMessage(n.payload,"*");var c=a().plugin.iframe;c&&c.contentWindow.postMessage(n,"*")}if("PEER_INTRODUCTION"===r){console.log("Connected peer is introducing himself to you:",n.payload);var i=n.payload,l=i.senderSocketId,s=i.metadata;t({type:"ADD_PEER",payload:{metadata:s,socketId:l}})}},e.onopen=function(){console.log("datachannel open",e)},e.onclose=function(){console.log("datachannel close")})}},Y=function(e){return function(t,a){e&&e.socketId&&(e.onicecandidate=function(t){var n=t.candidate;if(n){var r=a().localUser.socket;r.emit("ice-candidate",{senderSocketId:r.id,receiverSocketId:e.remoteSocketId,iceCandidate:n})}else console.log("no more ICE")},e.onaddstream=function(a){t(W(e.remoteSocketId,a.stream))},e.onsignalingstatechange=function(t){e.signalingState&&e.localDescription&&e.remoteDescription&&console.log("CONNECTION ESTABLISHED!!")},e.ondatachannel=function(){var a=Object(F.a)(z.a.mark((function a(n){return z.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("ondatachannel",n),e.defaultDataChannel=n.channel,a.next=4,t(X(e.defaultDataChannel));case 4:t($(e.defaultDataChannel));case 5:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}(),e.onmessage=function(e){console.log("---------connection.onmessage",e)})}},Z=function(e,t){return function(){var a=Object(F.a)(z.a.mark((function a(n,r){var o;return z.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:e&&(o=JSON.stringify(t),e.send(o));case 1:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}()},$=function(e){return function(){var t=Object(F.a)(z.a.mark((function t(a,n){var r,o,c;return z.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=n().localUser,o=r.socket,c=r.metadata,o&&c?a(Z(e,{type:"PEER_INTRODUCTION",payload:{senderSocketId:o.id,metadata:c}})):console.error("socket and/or metadata not available!");case 2:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}()},ee=function(){return{type:"RESET_LOCAL_USER"}},te=function(e){return function(){var t=Object(F.a)(z.a.mark((function t(a,n){var r;return z.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a({type:"SET_LOCAL_USER_LOADING",payload:{loading:!0}}),"https",r=q()("".concat("https","://").concat("derpmasters.online",":").concat("5002"),{secure:!0,query:(n=e,Object.entries(n).map((function(e){var t=Object(p.a)(e,2),a=t[0],n=t[1];return"".concat(a,"=").concat(n)})).join("&"))}),a(ae(r));case 4:case"end":return t.stop()}var n}),t)})));return function(e,a){return t.apply(this,arguments)}}()},ae=function(e){return function(){var t=Object(F.a)(z.a.mark((function t(a,n){return z.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.on("ready",(function(t){a({type:"INIT_LOCAL_USER_SOCKET",payload:{socket:e}}),e.on("user-leave",(function(e){var t=n().connections.data[e];t&&a(Q(t))})),e.on("offer",function(){var t=Object(F.a)(z.a.mark((function t(r){var o,c,i,l,s;return z.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=r.senderSocketId,c=r.offer,console.log("OFFER received - senderId:",o,"offer:",c),(i=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceCandidatePoolSize:1})).socketId=e.id,i.remoteSocketId=o,i.defaultDataChannel=i.createDataChannel("default"),console.log("--defaultDataChannel created",i.defaultDataChannel),a(X(i.defaultDataChannel)),t.next=11,n().streams.data[e.id];case 11:if(t.t0=t.sent,t.t0){t.next=14;break}t.t0=a(K());case 14:return l=t.t0,i.addStream(l),t.next=18,a(H(i));case 18:return t.next=20,i.setRemoteDescription(new RTCSessionDescription(c));case 20:return t.next=22,i.createAnswer();case 22:return s=t.sent,t.next=25,i.setLocalDescription(s);case 25:e.emit("answer",{receiverSocketId:o,answer:s});case 26:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.on("answer",(function(e){var t=e.senderSocketId,a=e.answer,r=n().connections.data[t];r&&(console.log("ANSWER received - senderId:",t,"answer:",a,"connection:",r),r.setRemoteDescription(new RTCSessionDescription(a)))})),e.on("ice-candidate",(function(e){var t=e.senderSocketId,a=e.iceCandidate,r=n().connections.data[t];r&&(console.log("ICE Candidate received - senderId:",t),r.addIceCandidate(new RTCIceCandidate(a)))}))}));case 1:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}()},ne=a(284),re=Object(j.a)({containerStyle:{display:"flex",justifyContent:"center",paddingTop:"128px"},titleStyle:{display:"flex",justifyContent:"center",width:"100%",padding:"16px",color:"white",fontWeight:"bold",backgroundColor:"#388E3C"},nicknameStyle:{width:"90%",margin:"16px"},textfieldLink:{width:"90%",marginRight:"16px",marginLeft:"16px"},nextButton:{color:"white",boxShadow:"none",width:"100%"},alignbutton:{display:"flex",justifyContent:"center",width:"80%",marginTop:"24px",marginBottom:"24px"}}),oe=Object(i.b)((function(e){return{nickname:e.localUser.metadata.nickname||"",roomError:e.room.error}}),{setMetadata:function(e){return function(t,a){!function(e,t){var a=JSON.stringify(t);localStorage.setItem(e,a)}("metadata",e),t({type:"SET_LOCAL_USER_METADATA",payload:{metadata:e}})}},setCurrentRoomError:V,resetLocalUser:ee})((function(e){var t=e.history,a=e.match,o=e.setMetadata,c=e.nickname,i=e.roomError,l=e.setCurrentRoomError,s=e.resetLocalUser,u=Object(n.useState)(c),d=Object(p.a)(u,2),m=d[0],f=d[1],g=Object(n.useState)(a.params.roomId),h=Object(p.a)(g,2),E=h[0],y=h[1],b=re(),x=function(e){o({nickname:m}),l(null),s(),t.push("/rooms/".concat(a.params.roomId))};return r.a.createElement(N.a,{theme:D},r.a.createElement(_.a,{display:"flex",height:63,bgcolor:"#2E7D32",alignItems:"center",paddingLeft:"36px"},r.a.createElement(R.b,{to:"/",style:{textDecoration:"none",color:"white"}},r.a.createElement(M.a,null))),r.a.createElement(ne.a,{container:!0,className:b.containerStyle},r.a.createElement(ne.a,{item:!0,xs:11,md:6,lg:5},r.a.createElement(_.a,{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",borderRadius:"5px",bgcolor:"white"},r.a.createElement(L.a,{variant:"h4",className:b.titleStyle},"Enter the room"),r.a.createElement(A.a,{required:!0,id:"outlined-required",label:"Nickname",variant:"outlined",value:m,className:b.nicknameStyle,onChange:function(e){f(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&x()},autoFocus:!0}),r.a.createElement(A.a,{required:!0,id:"outlined-required",label:"Room ID",variant:"outlined",value:E,className:b.textfieldLink,onChange:function(e){y(e.target.value)}}),r.a.createElement("div",{className:b.alignbutton},r.a.createElement(U.a,{onClick:x,size:"large",color:"secondary",variant:"contained",className:b.nextButton},"join")),i&&r.a.createElement(_.a,{color:"red",textAlign:"center"},i.error.message)))))})),ce=a(58),ie=function(e){return function(t,a){e&&t({type:"SET_PLUGIN",payload:{plugin:e}})}},le={PLUGIN_SEND_TO_ALL_PEERS:function(e){return function(t,a){var n=Object.values(a().connections.data),r={type:"PLUGIN_DATA",payload:e.data.payload};n.forEach((function(e){t(Z(e.defaultDataChannel,r))}))}},PLUGIN_SEND_TO_PEER:function(e){return function(t,a){var n=e.data,r=n.peerId,o=n.payload,c=a().connections.data[r],i={type:"PLUGIN_DATA",payload:o};t(Z(c.defaultDataChannel,i))}},PLUGIN_PLATFORM_CONTROL_REQUEST:function(){return console.log("plugin is requesting something from the platform (mute local user, rumble screen, etc")}},se=Object(i.b)((function(e){return{plugin:e.plugin}}),{handlePluginMessage:function(e){return function(){var t=Object(F.a)(z.a.mark((function t(a,n){var r;return z.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.data.type&&e.data.type.startsWith("PLUGIN")&&(r=le[e.data.type],a(r(e)));case 1:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}()},setPlugin:ie})((function(e){var t=e.plugin,a=e.handlePluginMessage,o=e.setPlugin,c=Object(n.useRef)();return Object(n.useEffect)((function(){var e=function(e){a(e)};return window.addEventListener("message",e),function(){return window.removeEventListener("message",e)}}),[]),Object(n.useEffect)((function(){c&&c.current&&o(Object(ce.a)(Object(ce.a)({},t),{},{iframe:c.current}))}),[c,t.url]),r.a.createElement(_.a,{flexGrow:1},t&&t.url&&r.a.createElement("iframe",{src:t.url,style:{width:"100%",height:"100%",border:"none"},ref:c,title:"plugin"}))})),ue=a(287),de=a(288),me=Object(j.a)((function(e){return{root:{display:"flex"},cardWrapper:{position:"relative",display:"flex",flexFlow:"column nowrap",marginBottom:"5px",width:"100%",height:"130px"},media:{width:"100%",height:"100%",objectFit:"cover"},displayName:{color:"white",opacity:"0.8",position:"absolute",bottom:"5px",left:"5px",fontSize:"0.9rem",userSelect:"none"}}})),pe=function(e){var t=e.stream,a=e.muted,o=void 0!==a&&a,c=e.user,i=me(),l=Object(n.useRef)(null),s=c.nickname;return Object(n.useEffect)((function(){!function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.current&&t&&(e.current.srcObject=t,e.current.oncanplay=function(){e.current.play(),e.current.muted=a})}(l,t,o)}),[t]),r.a.createElement(ue.a,{className:i.cardWrapper},t?r.a.createElement("video",{ref:l,className:i.media}):r.a.createElement(de.a,{color:"inherit"}),r.a.createElement(_.a,{className:i.displayName},s))},fe=Object(i.b)((function(e,t){var a=t.connection.remoteSocketId;return{remoteStream:a?e.streams.data[a]:null,remoteNickname:(e.peers.data[a]?e.peers.data[a].metadata:{}).nickname||"missing Nickname"}}))((function(e){var t=e.remoteStream,a=e.remoteNickname;return r.a.createElement(pe,{stream:t,user:{nickname:a}})})),ge=Object(i.b)((function(e){return{connections:Object.values(e.connections.data)}}))((function(e){var t=e.connections;return r.a.createElement(r.a.Fragment,null,t&&t.map((function(e){return r.a.createElement(fe,{key:"conn"+e.remoteSocketId,connection:e})})))})),he=Object(j.a)((function(e){return{roomMediaManager:{padding:"5px",backgroundColor:"#f5deb340",borderLeft:"1px solid #0000003b"}}})),Ee=Object(i.b)((function(e){var t=e.localUser.socket,a=t?e.streams.data[t.id]:null;return{localPeerMetadata:e.localUser.metadata,localStream:a}}),{})((function(e){var t=e.localStream,a=e.localPeerMetadata,n=he();return r.a.createElement(_.a,{bgcolor:"lightblue",width:"220px",minWidth:"150px",className:n.roomMediaManager},r.a.createElement(pe,{stream:t,muted:!0,user:{nickname:a.nickname}}),r.a.createElement(ge,null))})),ye=a(160),be=a.n(ye),xe=a(153),ve=a.n(xe),ke=a(154),Se=a.n(ke),Oe=a(297),we=a(285),Ce=a(292),Re=a(289),Ie=a(290),je=a(291),Ne=a(155),Te=a.n(Ne),De=Object(j.a)({list:{width:250},menuIcon:{margin:"8px"}}),_e=[{name:"Random number",url:"https://andreas-schoch.github.io/p2p-test-plugin/"},{name:"Paint",url:"https://andreas-schoch.github.io/quackamole-plugin-paint/"},{name:"Gomoku",url:"https://derpmasters.github.io/quackamole-plugin-gomoku/"},{name:"2d Shooter (WIP)",url:"https://andreas-schoch.github.io/quackamole-plugin-2d-topdown-shooter/"},{name:"Breakout game",url:"https://andreas-schoch.github.io/breakout-game/"}],Le=Object(i.b)((function(e){return{plugin:e.plugin}}),{setPlugin:ie})((function(e){var t=e.plugin,a=e.setPlugin,o=De(),c=Object(n.useState)(!1),i=Object(p.a)(c,2),l=i[0],s=i[1],u=function(e){"keydown"!==e.type&&s(!l)},d=function(e){var n=e.currentTarget.dataset.index;a(t?Object(ce.a)(Object(ce.a)({},t),_e[n]):_e[n])};return r.a.createElement(N.a,{theme:D},r.a.createElement(U.a,null,r.a.createElement(Te.a,{onClick:u,color:"primary",fontSize:"large",className:o.menuIcon}),r.a.createElement(Oe.a,{open:l,onClose:u,anchor:"left"},r.a.createElement("div",{className:o.list,role:"presentation",onClick:u},r.a.createElement(we.a,null,_e.map((function(e,t){var a=e.name;return r.a.createElement(Re.a,{button:!0,key:a,onClick:d,"data-index":t},r.a.createElement(Ie.a,null,r.a.createElement(ve.a,null)),r.a.createElement(je.a,{primary:a}))}))),r.a.createElement(Ce.a,null),r.a.createElement(we.a,null,r.a.createElement(Re.a,{button:!0},r.a.createElement(Ie.a,null,r.a.createElement(Se.a,null)),r.a.createElement(je.a,{primary:"Browse Plugins"})))))))})),Ae=a(159),Ue=a.n(Ae),Pe=a(3),Me=a(299),Be=a(156),ze=a.n(Be)()((function(e){var t=e.palette,a=e.spacing,n=a(2.5),r=a(4),o=t.primary.main;return{wrapper:{"&:nth-child(1)":{marginTop:"auto"}},avatar:{width:r,height:r},leftRow:{textAlign:"left"},rightRow:{textAlign:"right"},msg:{padding:a(1,2),borderRadius:4,marginBottom:4,display:"inline-block",wordBreak:"break-word",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',fontSize:"14px"},left:{borderTopRightRadius:n,borderBottomRightRadius:n,backgroundColor:t.grey[100]},right:{borderTopLeftRadius:n,borderBottomLeftRadius:n,backgroundColor:o,color:t.common.white},leftFirst:{borderTopLeftRadius:n},leftLast:{borderBottomLeftRadius:n},rightFirst:{borderTopRightRadius:n},rightLast:{borderBottomRightRadius:n}}}),{name:"ChatMsg"})((function(e){var t=e.classes,a=e.avatar,n=e.messages,o=e.side,c=e.GridContainerProps,i=e.GridItemProps,l=e.AvatarProps,s=e.getTypographyProps;return r.a.createElement(ne.a,Object.assign({container:!0,spacing:2,justify:"right"===o?"flex-end":"flex-start"},c,{className:t.wrapper}),"left"===o&&r.a.createElement(ne.a,Object.assign({item:!0},i),r.a.createElement(Me.a,Object.assign({src:a},l,{className:Object(Pe.a)(t.avatar,l.className)}))),r.a.createElement(ne.a,{item:!0,xs:8},n.map((function(a,c){var i,l=s(a,c,e);return r.a.createElement("div",{key:a.id||c,className:t["".concat(o,"Row")]},r.a.createElement(L.a,Object.assign({align:"left"},l,{className:Object(Pe.a)(t.msg,t[o],(i=c,0===i?t["".concat(o,"First")]:i===n.length-1?t["".concat(o,"Last")]:""),l.className)}),a))}))))}));ze.defaultProps={avatar:"",messages:[],side:"left",GridContainerProps:{},GridItemProps:{},AvatarProps:{},getTypographyProps:function(){return{}}};var Fe=ze,Ge=a(158),qe=a.n(Ge),We=a(157),Je=Object(j.a)({chat:{height:"100vh",display:"flex",flexFlow:"column nowrap",width:"320px"},chatFeed:{display:"flex",flexFlow:"column nowrap",flexGrow:1,maxHeight:"calc(100% - 60px)",overflow:"auto",padding:"8px"},chatInput:{display:"flex",flexFlow:"row nowrap",alignItems:"flex-end",padding:"8px"},chatInputTextfield:{flexGrow:1,zIndex:1e3,backgroundColor:"white"},chatInputSendBtn:{fontSize:"40px",margin:"auto 5px",cursor:"pointer",opacity:.8,transition:"opacity 0.2s","&:hover":{opacity:.95}}}),Ke=Object(i.b)((function(e){return{chatData:e.chat,socket:e.localUser.socket}}),{sendMessage:function(e){return function(){var t=Object(F.a)(z.a.mark((function t(a,n){var r,o;return z.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=Object.values(n().connections.data),(o=n().localUser.socket)?(r.forEach((function(t){var n={textMessage:{text:e,authorSocketId:o.id}};a(Z(t.defaultDataChannel,n))})),a({type:"ADD_NEW_MESSAGE",payload:{text:e,authorSocketId:o.id}})):console.error("socket not found");case 3:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}()}})((function(e){var t=e.chatData,a=e.sendMessage,o=e.socket,c=Je(""),i=Object(n.useState)(""),l=Object(p.a)(i,2),s=l[0],u=l[1],d=Object(n.useRef)(null);Object(n.useEffect)((function(){d.current&&(d.current.scrollTop=d.current.scrollHeight)}),[t]);var m=function(e){e.preventDefault(),s.replace(/\n/g,"").length&&(a(s),u(""))},f=function(e){return Object(We.toArray)(e).reduce((function(e,t){return"string"===typeof t?e+t:e+t.props.children}),"")},g=t.map((function(e,t){return e.authorSocketId===o.id?r.a.createElement(Fe,{key:t,side:"right",messages:[f(e.text)]}):r.a.createElement(Fe,{key:t,avatar:"",messages:[f(e.text)]})}));return r.a.createElement("div",{className:c.chat},r.a.createElement("div",{className:c.chatFeed,ref:d},g),r.a.createElement("div",{className:c.chatInput},r.a.createElement(A.a,{variant:"outlined",multiline:!0,rowsMax:5,className:c.chatInputTextfield,onChange:function(e){u(e.target.value)},onKeyPress:function(e){"Enter"===e.key&&(e.shiftKey?u(s.concat("\n")):m(e))},value:s,autoFocus:!0}),r.a.createElement(qe.a,{className:c.chatInputSendBtn,onClick:m})))})),Ve=function(){var e=Object(n.useState)(!1),t=Object(p.a)(e,2),a=t[0],o=t[1],c=function(e){return o(!a)};return r.a.createElement(N.a,{theme:D},r.a.createElement(U.a,{onClick:c},r.a.createElement(Ue.a,{color:"primary",fontSize:"large"})),r.a.createElement(Oe.a,{open:a,onClose:c,anchor:"right"},r.a.createElement(Ke,null)))},He=function(){return r.a.createElement(_.a,{bgcolor:"#f5deb3eb",height:"10%",display:"flex",justifyContent:"center",borderTop:"1px solid #0000003b",alignItems:"center"},r.a.createElement(Le,null),r.a.createElement(R.b,{to:"/",style:{height:"100%"}},r.a.createElement(U.a,{style:{height:"100%"}},r.a.createElement(be.a,{color:"primary",fontSize:"large"}))),r.a.createElement(Ve,null))},Qe=Object(i.b)((function(e){return{socket:e.localUser.socket,localPeerLoading:e.localUser.loading,roomError:e.room.error,currentRoom:e.room.data}}),{initLocalUser:function(){return function(){var e=Object(F.a)(z.a.mark((function e(t,a){var n;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=E("metadata"),a().localUser.loading||(n.nickname&&n.nickname.length?t(te(n)):t(V({error:{name:"RoomError",message:"Please enter a nickname before joining the room."}})));case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},joinRoom:function(e,t){return function(){var a=Object(F.a)(z.a.mark((function a(n,r){var o;return z.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:(o=r().localUser.socket)&&o.emit("join",{roomId:e,password:t,peerId:o.id},function(){var e=Object(F.a)(z.a.mark((function e(t,a){return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=9;break}return e.next=3,n(K(o));case 3:return e.next=5,n({type:"SET_CURRENT_ROOM",payload:{room:a.room}});case 5:a.room.joinedUsers.forEach((function(e){return n((t=e,function(){var e=Object(F.a)(z.a.mark((function e(a,n){var r,o,c,i;return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n().localUser.socket,t===r.id){e.next=26;break}return(o=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}],iceCandidatePoolSize:1})).socketId=r.id,o.remoteSocketId=t,o.defaultDataChannel=o.createDataChannel("default"),console.log("--defaultDataChannel created",o.defaultDataChannel),e.next=10,a(X(o.defaultDataChannel));case 10:return e.next=12,n().streams.data[r.id];case 12:if(e.t0=e.sent,e.t0){e.next=15;break}e.t0=a(K());case 15:return c=e.t0,o.addStream(c),e.next=19,a(H(o));case 19:return e.next=21,o.createOffer();case 21:return i=e.sent,console.log("offer created",i),e.next=25,o.setLocalDescription(i);case 25:r.emit("offer",{receiverSocketId:t,offer:i});case 26:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()));var t})),console.log("There are ".concat(a.room.joinedUsers.length,"x joinedUsers")),e.next=10;break;case 9:n(V(t));case 10:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}());case 2:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}()},roomExitCleanup:function(){return function(e,t){var a=t(),n=a.localUser.socket,r=n.id;if(n){var o=a.room.data;o.id&&(n.emit("leave",o.id),e({type:"SET_CURRENT_ROOM",payload:{room:{}}})),n.disconnect(),e(ee())}var c=a.connections.data;c&&Object.values(c).forEach((function(e){return e.close()})),a.streams[r]&&window.localStream.getTracks().forEach((function(e){return e.stop()})),e(function(){var e=Object(F.a)(z.a.mark((function e(t,a){return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t({type:"CLEAR_ALL_STREAMS"});case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())}},startLocalStream:K})((function(e){var t=e.socket,a=e.match,o=e.history,c=e.initLocalUser,i=e.joinRoom,l=e.roomError,s=e.currentRoom,u=e.localPeerLoading,d=e.roomExitCleanup,m=e.startLocalStream;return Object(n.useEffect)((function(){l?o.push("/room-lobby/".concat(a.params.roomId)):t||u?t&&t.id&&!s.id&&(console.log("Room#useEffect before joinRoom"),m(),i(a.params.roomId,"dummy123")):(console.log("Room#useEffect before initLocalUser"),c())}),[l,t]),Object(n.useEffect)((function(){return function(){return d()}}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{display:"flex",flexDirection:"column",width:1,height:"100%",justifyContent:"space-between"},r.a.createElement(_.a,{display:"flex",flexDirection:"row",width:1,height:"90%",justifyContent:"space-between"},r.a.createElement(se,null),r.a.createElement(Ee,null)),r.a.createElement(He,null)))})),Xe=a(162),Ye=a.n(Xe),Ze=a(163),$e=a.n(Ze),et=a(161),tt=a.n(et),at=a(293),nt=Object(j.a)({container:{display:"flex",flexDirection:"column",alignItems:"center",width:314,height:400,border:"solid 1px lightgrey",backgroundColor:"white"},smallScreenContainer:{display:"flex",flexDirection:"column",alignItems:"center",width:314,height:400,border:"solid 1px lightgrey",backgroundColor:"white",margin:8},alignTitle:{display:"flex",margin:24},customizeTitle:{fontWeight:"bold",marginLeft:4},customizeIcon:{marginRight:4},customizeText:{paddingLeft:16,paddingRight:16,marginBottom:16}}),rt=function(e){var t,a=nt(),n=Object(at.a)("(max-width: 950px)");return r.a.createElement("div",{className:n?a.smallScreenContainer:a.container},r.a.createElement("div",{className:a.alignTitle},"VideogameAssetIcon"===(t=e.content.icon)?r.a.createElement(tt.a,{fontSize:"large",className:a.customizeIcon}):"AssessmentOutlinedIcon"===t?r.a.createElement(Ye.a,{fontSize:"large",className:a.customizeIcon}):"CallOutlinedIcon"===t?r.a.createElement($e.a,{fontSize:"large",className:a.customizeIcon}):void 0,r.a.createElement(L.a,{variant:"h5",className:a.customizeTitle},e.content.title)),r.a.createElement(L.a,{className:a.customizeText,align:"center"},e.content.text),r.a.createElement("img",{src:e.content.image,height:"181",width:"275",alt:"icon"}))},ot=Object(j.a)({header:{color:"white",textTransform:"uppercase",display:"flex",justifyContent:"center",alignItems:"center"},box:{display:"flex",width:"100%",height:"100%",justifyContent:"center"},smallScreenBox:{display:"flex",flexDirection:"column",width:"100%",height:"100%",alignItems:"center"},titleContainer:{display:"flex",flexDirection:"column",alignItems:"center",width:"40%",minWidth:310},titleStyle:{color:"white",fontWeight:"bold",marginTop:"98px"},buttonStyle:{borderRadius:"5px",fontWeight:"bold",color:"white",backgroundColor:"#FBC02D","&:hover":{backgroundColor:"#f9a825"},"&:focus":{outline:0}},mainImg:{display:"flex",height:224,width:309,borderRadius:5,marginTop:76,marginLeft:36,marginRight:36},smallScreenMainImg:{display:"flex",height:224,width:309,borderRadius:5,margin:36},bulletPoints:{display:"flex",justifyContent:"center",zIndex:"3",position:"relative",bottom:150},smallScreenBulletPoints:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:72}}),ct=function(){var e=ot(),t=Object(at.a)("(max-width: 950px)");return r.a.createElement(N.a,{theme:D},r.a.createElement(_.a,{height:63,bgcolor:"#2E7D32",className:e.header},r.a.createElement("h1",null,r.a.createElement("span",{role:"img","aria-label":"a duck"},"\ud83e\udd86 "),"Quackamole",r.a.createElement("span",{role:"img","aria-label":"an avocado"}," \ud83e\udd51"))),r.a.createElement(_.a,{height:540,display:"flex",zIndex:1},r.a.createElement(_.a,{className:t?e.smallScreenBox:e.box,bgcolor:"#388E3C"},r.a.createElement("div",{className:e.titleContainer},r.a.createElement(L.a,{variant:"h3",className:e.titleStyle,gutterBottom:!0,align:"center"},"Peer-to-peer video chat platform"),r.a.createElement(R.b,{to:"/create-room",style:{textDecoration:"none"}},r.a.createElement(U.a,{size:"large",className:e.buttonStyle},"Create a room"))),r.a.createElement("img",{src:"https://via.placeholder.com/400x300",className:t?e.smallScreenMainImg:e.mainImg,alt:"quackamole room preview"}))),r.a.createElement("div",{className:t?e.smallScreenBulletPoints:e.bulletPoints},[{title:"Gaming",icon:"VideogameAssetIcon",image:"https://via.placeholder.com/400x300",text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet."},{title:"Working",icon:"AssessmentOutlinedIcon",image:"https://via.placeholder.com/400x300",text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet."},{title:"Chatting",icon:"CallOutlinedIcon",image:"https://via.placeholder.com/400x300",text:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet."}].map((function(e,t){return r.a.createElement(rt,{content:e,key:e.title+t}," ")}))),r.a.createElement(R.b,{to:"/rooms/dummy-room-id"},"Test room"))},it=Object(j.a)({containerStyle:{display:"flex",justifyContent:"center",paddingTop:"128px"},titleStyle:{display:"flex",justifyContent:"center",padding:"16px",color:"white",fontWeight:"bold",backgroundColor:"#388E3C",width:"100%"},formControl:{width:"20%",margin:"16px"},select:{borderColor:"#FB8C00","&:before":{borderColor:"#FB8C00"},"&:after":{borderColor:"#f57c00"}},textfield:{width:"90%",marginTop:"48px"},textfieldLink:{width:"90%",marginRight:"16px",marginLeft:"16px"},alignButton:{display:"flex",justifyContent:"flex-end",width:"100%",margin:"16px"},myButton:{color:"white",boxShadow:"none",margin:"16px"},paper:{padding:D.spacing(2),textAlign:"center",color:D.palette.text.secondary},copyLink:{display:"flex",alignItems:"center",marginTop:"16px",width:"90%"},nextButton:{color:"white",boxShadow:"none",marginBottom:"16px",width:"100%"},subtitle:{display:"flex",justifyContent:"center",margin:"16px"}}),lt=function(){var e=r.a.useState(""),t=Object(p.a)(e,2),a=t[0],n=t[1],o=r.a.useState(""),c=Object(p.a)(o,2),i=c[0],l=c[1],s=r.a.useState(""),u=Object(p.a)(s,2),d=u[0],m=u[1],f=r.a.useState(!0),h=Object(p.a)(f,2),E=h[0],y=h[1],b=it(),x=Object(I.f)(),v=function(e){n(e.target.value)},k=function(e){E?"Enter"===e.key&&S():x.push("/room-lobby/".concat(d))},S=function(){var e={name:a,password:"Test123.",maxUsers:4};if(a.length>0){fetch("".concat("https","://").concat("derpmasters.online",":").concat("5002","/api/rooms"),{method:"post",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){var t,a=(t="quackamole.io",g()().test(t)?":3000":"");l("".concat("https","://").concat("quackamole.io").concat(a,"/#/room-lobby/").concat(e)),m(e),y(!1)}))}else console.log("please enter your name")},O=r.a.createElement(_.a,{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",borderRadius:"5px",bgcolor:"white"},r.a.createElement(L.a,{variant:"h4",className:b.titleStyle},"Create a new room"),r.a.createElement(A.a,{required:!0,id:"outlined-required",label:"Room name",variant:"outlined",value:a,onChange:v,className:b.textfield,onKeyPress:k,autoFocus:!0}),r.a.createElement("div",{className:b.alignButton},r.a.createElement(U.a,{size:"large",color:"secondary",variant:"contained",className:b.myButton,onClick:S},"create"))),w=r.a.createElement(_.a,{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",borderRadius:"5px",bgcolor:"white",onKeyPress:k},r.a.createElement(L.a,{variant:"h4",className:b.titleStyle},"Room was created"),r.a.createElement("div",{className:b.copyLink},r.a.createElement(A.a,{variant:"outlined",value:i,onChange:v,className:b.textfieldLink,minWidth:300,autoFocus:!0}),r.a.createElement(U.a,{size:"large",color:"secondary",variant:"contained",className:b.myButton,onClick:function(){navigator.clipboard.writeText(i)}},"copy")),r.a.createElement(L.a,{variant:"h6",align:"center",className:b.subtitle},"Share the link to invite someones to your room"),r.a.createElement(R.b,{to:"/room-lobby/".concat(d),style:{textDecoration:"none",width:"80%"}},r.a.createElement(U.a,{size:"large",color:"secondary",variant:"contained",className:b.nextButton,to:"/room-lobby/".concat(d)},"next")));return r.a.createElement(N.a,{theme:D},r.a.createElement(_.a,{display:"flex",height:63,bgcolor:"#2E7D32",alignItems:"center",paddingLeft:"36px"},r.a.createElement(R.b,{to:"/",style:{textDecoration:"none",color:"white"}},r.a.createElement(M.a,null))),r.a.createElement(ne.a,{container:!0,className:b.containerStyle},r.a.createElement(ne.a,{item:!0,xs:11,md:6,lg:5},E?O:w)))},st=a(294),ut=function(){return r.a.createElement(st.a,null,r.a.createElement(R.a,null,r.a.createElement(I.c,null,r.a.createElement(I.a,{exact:!0,path:"/",component:ct}),r.a.createElement(I.a,{exact:!0,path:"/create-room",component:lt}),r.a.createElement(I.a,{exact:!0,path:"/room-lobby/:roomId",component:oe}),r.a.createElement(I.a,{path:"/rooms/:roomId",component:Qe}))))};a(253);c.a.render(r.a.createElement(r.a.Fragment,null,r.a.createElement(i.a,{store:C},r.a.createElement(ut,null))),document.getElementById("root"))}},[[176,1,2]]]);
//# sourceMappingURL=main.551d74c2.chunk.js.map