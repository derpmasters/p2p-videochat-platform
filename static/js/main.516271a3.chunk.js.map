{"version":3,"sources":["store/reducers/room.reducer.js","store/actionTypes.js","utils.js","store/reducers/localUser.reducer.js","store/reducers/peers.reducer.js","store/reducers/connections.reducer.js","store/reducers/remoteStreams.reducer.js","store/reducers/plugin.reducer.js","store/reducers/chat.reducer.js","store/reducers/index.js","store/index.js","style/theme/MainTheme.jsx","store/actions/remoteStreams.actions.js","store/actions/room.actions.js","store/actions/localStream.actions.js","store/actions/connections.actions.js","store/actions/localUser.actions.js","constants.js","components/Room/GenericMediaCard/GenericMediaCard.jsx","components/RoomLobby/MediaPreview/MediaPreview.jsx","components/RoomLobby/RoomLobby.jsx","store/actions/plugin.actions.js","components/Room/RoomPluginContent/RoomPluginContent.jsx","components/Room/RoomMediaManager/RemoteMediaCard/RemoteMediaCard.jsx","components/Room/RoomMediaManager/RemoteMediaManager/RemoteMediaManager.jsx","components/Room/RoomMediaManager/RoomMediaManager.jsx","components/Room/RoomSidebarMenu/RoomSidebarMenu.jsx","components/Room/RoomSidebarChat/Chat/ChatMsg.jsx","components/Room/RoomSidebarChat/Chat/ChatStyle.jsx","components/Room/RoomSidebarChat/Chat/Chat.jsx","store/actions/chat.actions.js","components/Room/RoomSidebarChat/RoomSidebarChat.jsx","components/Room/RoomActionbar/RoomActionbar.jsx","components/Room/Room.jsx","components/Home/BulletPoint/BulletPoint.jsx","components/Home/Home.jsx","components/RoomCreateForm/RoomCreateForm.jsx","components/App/App.jsx","index.jsx"],"names":["roomReducer","produce","roomDraft","action","type","data","payload","room","error","clearStreamTracks","stream","getTracks","console","forEach","track","stop","getPersistedData","key","dataJson","localStorage","getItem","JSON","parse","defaultMediaConstraints","audio","video","width","ideal","height","initialState","socket","metadata","mediaConstraints","mediaStream","micEnabled","camEnabled","loading","localUserReducer","localPeerDraft","oldMediaStream","id","constraints","enabled","peersReducer","peersDraft","socketId","peer","connectionsReducer","connectionsDraft","connection","remoteSocketId","remoteStreamsReducer","streamsDraft","streamWrapper","streamWrappers","current","Object","values","wrappedStream","pluginReducer","pluginDraft","plugin","url","name","iframe","chatReducer","messagesDraft","push","reducer","combineReducers","localUser","peers","connections","remoteStreams","chat","store","createStore","composeWithDevTools","applyMiddleware","thunk","theme","createMuiTheme","palette","primary","main","secondary","addStream","dispatch","getState","removeStream","setCurrentRoomError","startLocalStream","a","log","stopLocalStream","actualConstraints","navigator","mediaDevices","getUserMedia","newStream","updateStreamForConnections","setMediaStreamConstraints","toggleMicrophoneEnabled","newEnabled","toggleCameraEnabled","addConnection","initConnectionListeners","removeConnection","close","initDataChannelListeners","dataChannel","onmessage","evt","textMessage","nickname","authorSocketId","text","window","postMessage","contentWindow","senderSocketId","onopen","onclose","currentIteration","iceCandidates","timer","length","emit","receiverSocketId","rawDelay","Math","pow","roundedDelay","round","setTimeout","onicecandidate","iceCandidate","candidate","maxIterations","ontrack","streams","onnegotiationneeded","signalingState","trace","makingOffer","createOffer","offer","setLocalDescription","description","localDescription","oniceconnectionstatechange","iceConnectionState","restartIce","onsignalingstatechange","remoteDescription","ondatachannel","defaultDataChannel","channel","introduceYourself","connectWithPeer","existingConnection","initNewRTCPeerConnection","newConnection","sendDataToConnection","serializedData","stringify","send","RTCPeerConnection","iceServers","urls","iceCandidatePoolSize","createDataChannel","localStreamWrapper","addTrack","senders","getSenders","sender","removeTrack","resetLocalUser","initLocalUserSocket","io","process","secure","location","protocol","query","object","entries","map","value","join","initLocalUserSocketListeners","on","wasNew","polite","ignoringOffer","isSettingRemoteAnswerPending","readyForOffer","offerCollision","ignoreOffer","setRemoteDescription","RTCSessionDescription","createAnswer","answer","addIceCandidate","RTCIceCandidate","useStyles","makeStyles","root","display","cardWrapper","position","flexFlow","justifyContent","alignItems","marginBottom","videoOffIcon","top","left","transform","media","objectFit","displayName","color","opacity","bottom","fontSize","userSelect","GenericMediaCard","muted","user","classes","videoRef","useRef","useEffect","srcObject","oncanplay","play","setVideoSrc","className","ref","getVideoTracks","containerForm","maxWidth","formControl","select","connect","state","useState","audioInputDevices","setAudioInputDevices","videoInputDevices","setVideoInputDevices","currentAudioDevice","setCurrentAudioDevice","currentVideoDevice","setCurrentVideoDevice","settingsOpen","setSettingsOpen","initListOfDevices","handleSaveSettings","audioTrack","getAudioTracks","audioDevice","find","d","label","videoTrack","videoDevice","enumerateDevices","devices","filter","device","kind","handleClickOpen","handleClose","newConstraints","deviceId","onClick","disableBackdropClick","disableEscapeKeyDown","open","onClose","style","setVideoIcon","setAudioIcon","htmlFor","native","onChange","selectedLabel","target","selectedDevice","input","i","groupId","containerStyle","paddingTop","titleStyle","padding","fontWeight","backgroundColor","nicknameStyle","margin","textfieldLink","marginRight","marginLeft","nextButton","boxShadow","alignbutton","marginTop","roomError","setMetadata","dataStringified","setItem","persistData","history","match","newNickname","setNewNickname","params","roomId","link","setLink","handleJoin","e","ThemeProvider","bgcolor","paddingLeft","to","textDecoration","container","item","xs","md","lg","flexDirection","borderRadius","variant","required","onKeyPress","autoFocus","size","textAlign","message","setPlugin","pluginMessageActions","peerId","handlePluginMessage","startsWith","iframeRef","handleMessage","addEventListener","removeEventListener","flexGrow","src","border","title","ownProps","remoteStreamWrapper","remoteStream","remoteMetadata","remoteNickname","roomMediaManager","borderLeft","localStream","localPeerMetadata","minWidth","list","menuIcon","plugins","setOpen","toggleDrawer","event","handleSelectPlugin","index","currentTarget","dataset","anchor","role","button","data-index","ChatMsg","withStyles","spacing","radius","rightBgColor","wrapper","avatar","leftRow","rightRow","msg","wordBreak","fontFamily","borderTopRightRadius","borderBottomRightRadius","grey","right","borderTopLeftRadius","borderBottomLeftRadius","common","white","leftFirst","leftLast","rightFirst","rightLast","props","messages","side","GridContainerProps","GridItemProps","AvatarProps","getTypographyProps","justify","cx","TypographyProps","align","defaultProps","chatFeed","maxHeight","overflow","chatInput","chatInputTextfield","zIndex","chatInputSendBtn","cursor","transition","chatData","sendMessage","newMessage","setNewMessage","feedRef","scrollTop","scrollHeight","preventDefault","replace","chatMessages","multiline","rowsMax","shiftKey","concat","RoomSidebarChat","_","borderTop","localPeerLoading","currentRoom","initLocalUser","joinRoom","password","err","joinedUsers","roomExitCleanup","disconnect","conn","smallScreenContainer","alignTitle","customizeTitle","customizeIcon","customizeText","paddingRight","BulletPoint","icon","smallScreen","useMediaQuery","content","image","alt","header","textTransform","box","smallScreenBox","titleContainer","buttonStyle","outline","mainImg","smallScreenMainImg","bulletPoints","smallScreenBulletPoints","Home","aria-label","gutterBottom","borderColor","textfield","alignButton","btnCreateWrapper","btnCreate","fabProgress","btnCreateProgress","paper","copyLink","subtitle","RoomCreateForm","setName","setRoomId","setLoading","setError","useHistory","handleChangeTexfield","handleKeyPress","createRoom","origin","maxUsers","Error","fetch","method","body","headers","res","status","json","createRoomJSX","disabled","CircularProgress","shareRoomJSX","myButton","clipboard","writeText","App","exact","path","component","RoomLobby","Room","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.516271a3.chunk.js","sourcesContent":["import {SET_CURRENT_ROOM, SET_CURRENT_ROOM_ERROR} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = {\r\n  data: {\r\n    // id: 'dummy-room-id',\r\n    // name: 'Dummy Room',\r\n  },\r\n  error: null\r\n};\r\n\r\nconst roomReducer = produce((roomDraft, action) => {\r\n  switch (action.type) {\r\n    case SET_CURRENT_ROOM: {\r\n      roomDraft.data = action.payload.room;\r\n      roomDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_CURRENT_ROOM_ERROR: {\r\n      roomDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default roomReducer;\r\n","export const ADD_PEER = 'ADD_PEER';\r\nexport const REMOVE_PEER = 'REMOVE_PEER';\r\nexport const SET_PEERS_ERROR = 'SET_PEERS_ERROR';\r\n\r\nexport const ADD_CONNECTION = 'ADD_CONNECTION';\r\nexport const REMOVE_CONNECTION = 'REMOVE_CONNECTION';\r\nexport const SET_CONNECTIONS_ERROR = 'SET_CONNECTIONS_ERROR';\r\n\r\nexport const ADD_STREAM = 'ADD_STREAM';\r\nexport const REMOVE_STREAM = 'REMOVE_STREAM';\r\nexport const SET_STREAMS_ERROR = 'SET_STREAM_ERROR';\r\nexport const CLEAR_ALL_STREAMS = 'CLEAR_ALL_STREAMS';\r\n\r\nexport const SET_CURRENT_ROOM = 'SET_CURRENT_ROOM';\r\nexport const SET_CURRENT_ROOM_ERROR = 'SET_CURRENT_ROOM_ERROR';\r\n\r\nexport const SET_LOCAL_USER_LOADING = 'SET_LOCAL_USER_LOADING';\r\nexport const INIT_LOCAL_USER_SOCKET = 'INIT_LOCAL_USER_SOCKET';\r\nexport const INIT_LOCAL_USER_PEER = 'INIT_LOCAL_USER_PEER';\r\nexport const SET_LOCAL_USER_METADATA = 'SET_LOCAL_USER_METADATA';\r\nexport const SET_LOCAL_USER_MEDIA_STREAM = 'SET_LOCAL_USER_MEDIA_STREAM';\r\nexport const SET_LOCAL_USER_MEDIA_CONSTRAINTS = 'SET_LOCAL_USER_MEDIA_CONSTRAINTS';\r\nexport const SET_LOCAL_USER_MICROPHONE_ENABLED = 'SET_LOCAL_USER_MICROPHONE_ENABLED';\r\nexport const SET_LOCAL_USER_CAMERA_ENABLED = 'SET_LOCAL_USER_CAMERA_ENABLED';\r\nexport const SET_LOCAL_USER_ERROR = 'SET_LOCAL_USER_ERROR';\r\nexport const RESET_LOCAL_USER = 'RESET_LOCAL_USER';\r\n\r\nexport const SET_PLUGIN = 'SET_PLUGIN';\r\nexport const SET_PLUGIN_ERROR = 'SET_PLUGIN_ERROR';\r\n\r\nexport const ADD_NEW_MESSAGE = 'ADD_NEW_MESSAGE';\r\n","// The place to put all helper methods that do not necessarily belong to a specific component\r\n// Once this file gets too crowded, create an utils folder and start seperating the exported helper methods\r\n\r\n// import {useEffect, useRef, useState} from \"react\";\r\nimport ipRegex from 'ip-regex';\r\n\r\n/**\r\n * Transforms a javascript object into a query string.\r\n * @param object The source object. Example: {a: 5, b: 10}\r\n * @returns {string} The resulting query string. Example 'a=5&b=10'\r\n */\r\nexport const serializeQueryString = object => {\r\n  return Object.entries(object).map(([key, value]) => `${key}=${value}`).join('&');\r\n};\r\n\r\n/**\r\n * Set the src of a html5 <video> element and start playing\r\n * @param videoRef The reference to the video element\r\n * @param stream The stream that should be played by the referenced video element\r\n * @param muted Whether or not the audio of the stream should be muted\r\n */\r\nexport const setVideoSrc = (videoRef, stream, muted = true) => {\r\n  if (videoRef.current && stream) {\r\n    videoRef.current.srcObject = stream;\r\n    videoRef.current.oncanplay = () => { // FIXME rarely does not get fired for all peers, so remote stream can appear white\r\n      if (videoRef.current) {\r\n        videoRef.current.play();\r\n        videoRef.current.muted = muted;\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\n// untested prototype for a hook that might replace setVideoSrc(). Right now there is no benefit of using it. Rethink design\r\n// export const useStream = (muted = false) => {\r\n//     const videoRef = useRef(null);\r\n//     const [stream, setStream] = useState(null);\r\n//\r\n//     useEffect(() => {\r\n//         if (videoRef.current && stream) {\r\n//             videoRef.current.srcObject = stream;\r\n//             videoRef.current.oncanplay = () => {\r\n//                 videoRef.current.play();\r\n//                 videoRef.current.muted = muted;\r\n//             };\r\n//         }\r\n//     }, [stream, videoRef, muted]);\r\n//\r\n//     return [videoRef, setStream];\r\n// };\r\n\r\nexport const clearStreamTracks = stream => {\r\n  if (stream) {\r\n    if (!stream.getTracks) {\r\n      console.error('something wrong with the stream:', stream);\r\n      return;\r\n    }\r\n\r\n    stream.getTracks().forEach(track => track.stop());\r\n  }\r\n};\r\n\r\nexport const getPersistedData = (key) => {\r\n  const dataJson = localStorage.getItem(key);\r\n  return dataJson ? JSON.parse(dataJson) : {};\r\n};\r\n\r\nexport const persistData = (key, data) => {\r\n  const dataStringified = JSON.stringify(data);\r\n  localStorage.setItem(key, dataStringified);\r\n};\r\n\r\nexport const isIpAddress = (testedString) => {\r\n  return ipRegex().test(testedString);\r\n};\r\n","import {INIT_LOCAL_USER_SOCKET, RESET_LOCAL_USER, SET_LOCAL_USER_ERROR, SET_LOCAL_USER_LOADING, SET_LOCAL_USER_METADATA, SET_LOCAL_USER_MEDIA_STREAM, SET_LOCAL_USER_MEDIA_CONSTRAINTS, SET_LOCAL_USER_CAMERA_ENABLED, SET_LOCAL_USER_MICROPHONE_ENABLED} from '../actionTypes';\r\nimport {clearStreamTracks, getPersistedData} from '../../utils';\r\nimport produce from 'immer';\r\n\r\nconst defaultMediaConstraints = {\r\n  audio: {},\r\n  video: {\r\n    // frameRate: { ideal: 20, max: 25 }, // FIXME check supported constraints first to prevent errors\r\n    width: { ideal: 128 },\r\n    height: { ideal: 72 }\r\n  }\r\n};\r\n\r\nconst initialState = {\r\n  socket: null,\r\n  metadata: getPersistedData('metadata'),\r\n  mediaConstraints: defaultMediaConstraints,\r\n  mediaStream: null,\r\n  micEnabled: true,\r\n  camEnabled: true,\r\n  loading: false,\r\n  error: null\r\n};\r\n\r\nconst localUserReducer = produce((localPeerDraft, action) => {\r\n  switch (action.type) {\r\n    case SET_LOCAL_USER_LOADING: {\r\n      localPeerDraft.loading = action.payload.loading;\r\n      return;\r\n    }\r\n    case INIT_LOCAL_USER_SOCKET: {\r\n      localPeerDraft.socket = action.payload.socket;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_METADATA: {\r\n      localPeerDraft.metadata = action.payload.metadata;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_MEDIA_STREAM: {\r\n      const oldMediaStream = localPeerDraft.mediaStream;\r\n\r\n      localPeerDraft.mediaStream = action.payload.mediaStream;\r\n      localPeerDraft.error = null;\r\n\r\n      // Cleanup old stream. Without this, webcam light can stay on unintentionally due to unreliable garbage collection\r\n      if (oldMediaStream) {\r\n        if (action.payload.mediaStream && action.payload.mediaStream.stream.id !== oldMediaStream.stream.id) {\r\n          clearStreamTracks(oldMediaStream.stream);\r\n        } else if (!action.payload.mediaStream) {\r\n          clearStreamTracks(oldMediaStream.stream);\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_MEDIA_CONSTRAINTS: {\r\n      localPeerDraft.mediaConstraints = action.payload.constraints;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_MICROPHONE_ENABLED: {\r\n      localPeerDraft.micEnabled = action.payload.enabled;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_CAMERA_ENABLED: {\r\n      localPeerDraft.camEnabled = action.payload.enabled;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_ERROR: {\r\n      localPeerDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    case RESET_LOCAL_USER: {\r\n      localPeerDraft.socket = null;\r\n      localPeerDraft.metadata = getPersistedData('metadata');\r\n      localPeerDraft.mediaConstraints = defaultMediaConstraints;\r\n      localPeerDraft.mediaStream = null;\r\n      localPeerDraft.micEnabled = true;\r\n      localPeerDraft.camEnabled = true;\r\n      localPeerDraft.loading = false;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default localUserReducer;\r\n","import {ADD_PEER, REMOVE_PEER, SET_PEERS_ERROR} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = {\r\n  data: {\r\n    // 'd7f7saim3': {nickname: 'Andi'},\r\n    // '32mfdnmio': {nickname: 'Jimmy'}\r\n  },\r\n  error: null\r\n};\r\n\r\nconst peersReducer = produce((peersDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_PEER: {\r\n      const { socketId, metadata } = action.payload;\r\n      peersDraft.data[socketId] = { metadata };\r\n      peersDraft.error = null;\r\n      return;\r\n    }\r\n    case REMOVE_PEER: {\r\n      const peer = action.payload.peer;\r\n      delete peersDraft.data[peer.id];\r\n      peersDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_PEERS_ERROR: {\r\n      peersDraft.error = action.payload.error;\r\n      return;\r\n\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default peersReducer;\r\n","import {ADD_CONNECTION, REMOVE_CONNECTION, SET_CONNECTIONS_ERROR} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = {\r\n  data: {},\r\n  error: null\r\n};\r\n\r\nconst connectionsReducer = produce((connectionsDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_CONNECTION: {\r\n      const connection = action.payload.connection;\r\n      connectionsDraft.data[connection.remoteSocketId] = connection;\r\n      connectionsDraft.error = null;\r\n      return;\r\n    }\r\n    case REMOVE_CONNECTION: {\r\n      const connection = action.payload.connection;\r\n      delete connectionsDraft.data[connection.remoteSocketId];\r\n      connectionsDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_CONNECTIONS_ERROR: {\r\n      connectionsDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default connectionsReducer;\r\n","import {ADD_STREAM, CLEAR_ALL_STREAMS, REMOVE_STREAM, SET_STREAMS_ERROR} from '../actionTypes';\r\nimport {clearStreamTracks} from '../../utils';\r\nimport produce, {current} from 'immer';\r\n\r\nconst initialState = {\r\n  data: {},\r\n  error: null\r\n};\r\n\r\nconst remoteStreamsReducer = produce((streamsDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_STREAM: {\r\n      const { socketId, stream } = action.payload;\r\n      streamsDraft.data[socketId] = { stream };\r\n      streamsDraft.error = null;\r\n      return;\r\n    }\r\n    case REMOVE_STREAM: {\r\n      const { socketId } = action.payload;\r\n      const streamWrapper = streamsDraft.data[socketId];\r\n      if (streamWrapper) {\r\n        clearStreamTracks(streamWrapper.stream);\r\n        delete streamsDraft.data[socketId];\r\n      }\r\n      return;\r\n    }\r\n    case SET_STREAMS_ERROR: {\r\n      streamsDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    case CLEAR_ALL_STREAMS: {\r\n      const streamWrappers = current(streamsDraft.data);\r\n      Object.values(streamWrappers).forEach(wrappedStream => clearStreamTracks(wrappedStream.stream));\r\n      streamsDraft.data = {};\r\n      streamsDraft.error = null;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default remoteStreamsReducer;\r\n","import {SET_PLUGIN, SET_PLUGIN_ERROR} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\n// TODO there should be a plugins.reducer storing the plugin data of already fetched plugins (once they come from the backend)\r\n//  activePluginId should be stored in the room.reducer, as well as pluginIds that are shown in the room sidebar.\r\n//  plugin data can be fetched from the backend (or could already be included when fetching the room)\r\nconst initialState = {\r\n  // origin: 'null',\r\n  iframe: null,\r\n  url: '',\r\n  name: 'p2p-test-plugin',\r\n  error: null\r\n};\r\n\r\nconst pluginReducer = produce((pluginDraft, action) => {\r\n  switch (action.type) {\r\n    case SET_PLUGIN: {\r\n      const { url, name, iframe } = action.payload.plugin;\r\n      pluginDraft.iframe = iframe;\r\n      pluginDraft.url = url;\r\n      pluginDraft.name = name;\r\n      pluginDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_PLUGIN_ERROR: {\r\n      pluginDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default pluginReducer;\r\n","import {ADD_NEW_MESSAGE} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = [];\r\n\r\nconst chatReducer = produce((messagesDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_NEW_MESSAGE: {\r\n      messagesDraft.push(action.payload);  // FIXME should be action.payload.message\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default chatReducer;\r\n","import {combineReducers} from 'redux';\r\nimport roomReducer from './room.reducer';\r\nimport localUserReducer from './localUser.reducer';\r\nimport peersReducer from './peers.reducer';\r\nimport connectionsReducer from './connections.reducer';\r\nimport remoteStreamsReducer from './remoteStreams.reducer';\r\nimport pluginReducer from './plugin.reducer';\r\nimport chatReducer from './chat.reducer';\r\n\r\nconst reducer = combineReducers({\r\n  room: roomReducer,\r\n  localUser: localUserReducer,\r\n  peers: peersReducer,\r\n  connections: connectionsReducer,\r\n  remoteStreams: remoteStreamsReducer,\r\n  plugin: pluginReducer,\r\n  chat: chatReducer\r\n});\r\n\r\nexport default reducer;\r\n","import {applyMiddleware, createStore} from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport {composeWithDevTools} from 'redux-devtools-extension';\r\nimport reducer from './reducers';\r\n\r\nconst store = createStore(reducer, composeWithDevTools(applyMiddleware(thunk)));\r\n\r\nexport default store;\r\n","import {createMuiTheme} from '@material-ui/core/styles';\r\n\r\nconst theme = createMuiTheme({\r\n  palette: {\r\n    primary: {\r\n      main: '#2E7D32'\r\n    },\r\n    secondary: {\r\n      main: '#FBC02D'\r\n    }\r\n  }\r\n});\r\n\r\nexport default theme;\r\n","import {ADD_STREAM, CLEAR_ALL_STREAMS, REMOVE_STREAM} from '../actionTypes';\r\n\r\nexport const addStream = (socketId, stream) => (dispatch, getState) => { // TODO no need for a thunk, rename to setStream & SET_STREAM\r\n  if (stream) {\r\n    dispatch({ type: ADD_STREAM, payload: { socketId, stream } });\r\n  }\r\n};\r\n\r\nexport const removeStream = (socketId) => (dispatch, getState) => { // TODO no need for a thunk\r\n  if (socketId) {\r\n    dispatch({ type: REMOVE_STREAM, payload: { socketId } });\r\n  }\r\n};\r\n\r\nexport const clearAllStreams = () => async (dispatch, getState) => {\r\n  dispatch({ type: CLEAR_ALL_STREAMS });\r\n};\r\n","import {SET_CURRENT_ROOM, SET_CURRENT_ROOM_ERROR} from '../actionTypes';\r\nimport {clearAllStreams} from './remoteStreams.actions';\r\nimport {resetLocalUser} from './localUser.actions';\r\nimport {removeConnection} from './connections.actions';\r\n\r\nexport const setCurrentRoom = room => ({\r\n  type: SET_CURRENT_ROOM,\r\n  payload: { room }\r\n});\r\n\r\nexport const setCurrentRoomError = error => ({\r\n  type: SET_CURRENT_ROOM_ERROR,\r\n  payload: { error }\r\n});\r\n\r\nexport const roomExitCleanup = () => (dispatch, getState) => {\r\n  const state = getState();\r\n\r\n  const socket = state.localUser.socket;\r\n  if (socket) {\r\n    // disconnect from socketIO server\r\n    const currentRoom = state.room.data;\r\n    if (currentRoom.id) {\r\n      socket.emit('leave', currentRoom.id);\r\n      dispatch(setCurrentRoom({}));\r\n    }\r\n    socket.disconnect();\r\n    dispatch(resetLocalUser());\r\n\r\n    // clear local media stream\r\n    const localStreamWrapper = state.localUser.mediaStream;\r\n    if (localStreamWrapper) {\r\n      localStreamWrapper.stream.getTracks().forEach(track => track.stop());\r\n    }\r\n    dispatch(clearAllStreams());\r\n  }\r\n\r\n  // close all RTCPeerConnections\r\n  const connections = state.connections.data;\r\n  if (connections) {\r\n    Object.values(connections).forEach(conn => dispatch(removeConnection(conn)));\r\n  }\r\n};\r\n","import {addStream} from './remoteStreams.actions';\r\nimport {clearStreamTracks} from '../../utils';\r\nimport {SET_LOCAL_USER_CAMERA_ENABLED, SET_LOCAL_USER_MEDIA_CONSTRAINTS, SET_LOCAL_USER_MEDIA_STREAM, SET_LOCAL_USER_MICROPHONE_ENABLED} from '../actionTypes';\r\nimport {updateStreamForConnections} from './connections.actions';\r\n\r\nexport const startLocalStream = () => async (dispatch, getState) => {\r\n  console.log('startLocalStream dispatched');\r\n  const { mediaConstraints, micEnabled, camEnabled } = getState().localUser;\r\n\r\n  if (!micEnabled && !camEnabled) {\r\n    dispatch(stopLocalStream());\r\n    return;\r\n  }\r\n\r\n  const actualConstraints = { ...mediaConstraints };\r\n  actualConstraints.audio = micEnabled ? actualConstraints.audio : false;\r\n  actualConstraints.video = camEnabled ? actualConstraints.video : false;\r\n\r\n  try {\r\n    const newStream = await navigator.mediaDevices.getUserMedia(actualConstraints);\r\n    await dispatch(updateStreamForConnections(newStream));\r\n    await dispatch({ type: SET_LOCAL_USER_MEDIA_STREAM, payload: { mediaStream: { stream: newStream } } });\r\n    return newStream;\r\n  } catch (error) {\r\n    console.error('local stream couldn\\'t be started', error);\r\n  }\r\n};\r\n\r\nexport const stopLocalStream = () => async (dispatch, getState) => {\r\n  const { mediaStream } = getState().localUser;\r\n\r\n  if (mediaStream) {\r\n    clearStreamTracks(mediaStream.stream);\r\n    dispatch({ type: SET_LOCAL_USER_MEDIA_STREAM, payload: { mediaStream: false } });\r\n  }\r\n};\r\n\r\nexport const toggleLocalAudio = () => (dispatch, getState) => {\r\n  const socket = getState().localUser.socket;\r\n  if (socket) {\r\n    const localStreamWrapper = getState().localUser.mediaStream;\r\n    if (localStreamWrapper) {\r\n      const localStream = localStreamWrapper.stream;\r\n      localStream.getAudioTracks()[0].enabled = !localStream.getAudioTracks()[0].enabled;\r\n      dispatch(addStream(socket.id, localStream));\r\n    }\r\n  }\r\n};\r\n\r\nexport const toggleLocalVideo = () => (dispatch, getState) => {\r\n  const socket = getState().localUser.socket;\r\n  if (socket) {\r\n    const localStreamWrapper = getState().localUser.mediaStream;\r\n    if (localStreamWrapper) {\r\n      const localStream = localStreamWrapper.stream;\r\n      localStream.getVideoTracks()[0].enabled = !localStream.getVideoTracks()[0].enabled;\r\n      dispatch(addStream(socket.id, localStream));\r\n    }\r\n  }\r\n};\r\n\r\nexport const setMediaStreamConstraints = (constraints) => async (dispatch, getState) => {\r\n  await dispatch({ type: SET_LOCAL_USER_MEDIA_CONSTRAINTS, payload: { constraints } });\r\n\r\n  // Re-Start local stream to update constraints\r\n  const localStreamWrapper = getState().localUser.mediaStream;\r\n  if (localStreamWrapper) {\r\n    dispatch(startLocalStream());\r\n  }\r\n};\r\n\r\nexport const toggleMicrophoneEnabled = () => (dispatch, getState) => {\r\n  const newEnabled = !getState().localUser.micEnabled;\r\n  dispatch({ type: SET_LOCAL_USER_MICROPHONE_ENABLED, payload: { enabled: newEnabled } });\r\n\r\n  // Re-Start local stream to update constraints\r\n  const localStreamWrapper = getState().localUser.mediaStream;\r\n  if (localStreamWrapper || newEnabled) {\r\n    dispatch(startLocalStream());\r\n  }\r\n};\r\n\r\nexport const toggleCameraEnabled = () => (dispatch, getState) => {\r\n  const newEnabled = !getState().localUser.camEnabled;\r\n  dispatch({ type: SET_LOCAL_USER_CAMERA_ENABLED, payload: { enabled: newEnabled } });\r\n\r\n  // Re-Start local stream to update constraints\r\n  const localStreamWrapper = getState().localUser.mediaStream;\r\n  if (localStreamWrapper || newEnabled) {\r\n    dispatch(startLocalStream());\r\n  }\r\n};\r\n","import {ADD_CONNECTION, ADD_NEW_MESSAGE, ADD_PEER, REMOVE_CONNECTION, SET_CURRENT_ROOM} from '../actionTypes';\r\nimport {addStream, removeStream} from './remoteStreams.actions';\r\nimport {setCurrentRoomError} from './room.actions';\r\nimport {startLocalStream} from './localStream.actions';\r\n\r\nexport const addConnection = (connection) => async (dispatch, getState) => {\r\n  if (connection && connection.socketId) {\r\n    console.log('addConnection', connection);\r\n    await dispatch({ type: ADD_CONNECTION, payload: { connection } });\r\n    await dispatch(initConnectionListeners(connection));\r\n  }\r\n};\r\n\r\nexport const removeConnection = connection => async (dispatch, getState) => {\r\n  if (connection && connection.remoteSocketId && connection.socketId) {\r\n\r\n    const stream = getState().remoteStreams.data[connection.remoteSocketId];\r\n    if (stream) {\r\n      await dispatch(removeStream(connection.remoteSocketId));\r\n    }\r\n\r\n    connection.close();\r\n    await dispatch({ type: REMOVE_CONNECTION, payload: { connection } });\r\n  }\r\n};\r\n\r\nexport const initDataChannelListeners = dataChannel => (dispatch, getState) => {\r\n  if (dataChannel) {\r\n    dataChannel.onmessage = evt => {\r\n      console.log('received message: ', evt);\r\n      const data = JSON.parse(evt.data);\r\n      const type = data.type;\r\n\r\n      if (data.textMessage) {\r\n        dispatch({ type: ADD_NEW_MESSAGE, payload: data.textMessage });\r\n\r\n        const metadata = getState().localUser.metadata;\r\n        console.log(\r\n          `%c MESSAGE - ${metadata.nickname || data.textMessage.authorSocketId}: \"${data.textMessage.text}\"`,\r\n          'background: black; color: white; padding: 1rem; border: 1px solid white; border-radius: 5px;'\r\n        );\r\n      }\r\n\r\n      if (type === 'PLUGIN_DATA') {\r\n        window.postMessage(data.payload, '*');\r\n        const iframe = getState().plugin.iframe;\r\n        if (iframe) {\r\n          iframe.contentWindow.postMessage(data, '*');\r\n        }\r\n      }\r\n\r\n      if (type === 'PEER_INTRODUCTION') {\r\n        console.log('Connected peer is introducing himself to you:', data.payload);\r\n        const { senderSocketId, metadata } = data.payload;\r\n        dispatch({ type: ADD_PEER, payload: { metadata: metadata, socketId: senderSocketId } });\r\n      }\r\n    };\r\n\r\n    dataChannel.onopen = () => {\r\n      console.log('datachannel open', dataChannel);\r\n    };\r\n\r\n    dataChannel.onclose = () => {\r\n      console.log('datachannel close');\r\n    };\r\n  }\r\n};\r\n\r\nexport const initConnectionListeners = connection => (dispatch, getState) => {\r\n  if (connection && connection.socketId) {\r\n    const delayMultiplier = 1.5;\r\n    const baseDelay = 450;\r\n    const maxIterations = 9;\r\n    let currentIteration = 0;\r\n    let iceCandidates = [];\r\n\r\n    // emits ice-candidates with an increasing delay until the onicecandidate null event\r\n    // Most of the candidates trickle in within the first 0-2seconds but the null event can happen much later\r\n    // The goal is to send ice-candidates out quickly with the least amount of signaling until the null event\r\n    // High likelihood to be changed/simplified as time goes by...\r\n    const timer = () => {\r\n      if (iceCandidates.length) {\r\n        const { socket } = getState().localUser;\r\n        socket.emit('signaling', { receiverSocketId: connection.remoteSocketId, iceCandidates: iceCandidates });\r\n        iceCandidates = [];\r\n      }\r\n\r\n      if (currentIteration <= maxIterations) {\r\n        const rawDelay = baseDelay * Math.pow(delayMultiplier, currentIteration);\r\n        const roundedDelay = Math.round(rawDelay / 100 * 2) * 100 / 2;\r\n\r\n        console.log('TIMER DELAY', roundedDelay);\r\n        setTimeout(timer, Math.round(roundedDelay));\r\n        currentIteration++;\r\n      }\r\n    };\r\n    timer();\r\n\r\n    connection.onicecandidate = (evt) => {\r\n      const iceCandidate = evt.candidate;\r\n\r\n      if (iceCandidate) {\r\n        iceCandidates.push(iceCandidate);\r\n      } else {\r\n        console.log('no more ICE');\r\n        currentIteration = maxIterations + 1;\r\n        timer();\r\n      }\r\n    };\r\n\r\n    connection.ontrack = ({ track, streams }) => {\r\n      console.log('ontrack - remote stream track received');\r\n      if (streams && streams[0]) {\r\n        console.log('ontrack - adding remote stream track');\r\n        dispatch(addStream(connection.remoteSocketId, streams[0]));\r\n      } else {\r\n        console.error('ontrack - this should not happen... streams[0] is empty!');\r\n      }\r\n    };\r\n\r\n    connection.onnegotiationneeded = async evt => {\r\n      if (connection.signalingState !== 'stable') return;\r\n      console.trace('Why am I \"onnegotiationneeded\" fired?');\r\n\r\n      try {\r\n        connection.makingOffer = true;\r\n        console.trace('creating offer implicitly');\r\n        const offer = await connection.createOffer();\r\n        await connection.setLocalDescription(offer); // newer syntax that implicitly knows whether to create offer or answer\r\n\r\n        const { socket } = getState().localUser;\r\n        socket.emit('signaling', { receiverSocketId: connection.remoteSocketId, description: connection.localDescription });\r\n      } catch (err) {\r\n        console.error(err);\r\n      } finally {\r\n        connection.makingOffer = false;\r\n      }\r\n    };\r\n\r\n    connection.oniceconnectionstatechange = () => {\r\n      if (connection.iceConnectionState === 'failed') {\r\n        console.error('oniceconnectionstatechange - restarting ICE');\r\n        connection.restartIce();\r\n      }\r\n    };\r\n\r\n    connection.onsignalingstatechange = evt => {\r\n      if (connection.signalingState === 'stable' && connection.localDescription && connection.remoteDescription) {\r\n        console.log('CONNECTION ESTABLISHED!! signaling state:', connection.signalingState);\r\n      }\r\n    };\r\n\r\n    connection.ondatachannel = async evt => {\r\n      console.log('ondatachannel');\r\n      connection.defaultDataChannel = evt.channel;\r\n      await dispatch(initDataChannelListeners(connection.defaultDataChannel));\r\n      dispatch(introduceYourself(connection.defaultDataChannel));\r\n\r\n    };\r\n  }\r\n};\r\n\r\nexport const connectWithPeer = remoteSocketId => async (dispatch, getState) => {\r\n  const { socket } = getState().localUser;\r\n\r\n  if (remoteSocketId === socket.id) return;\r\n  console.log('connectWithPeer');\r\n\r\n  const existingConnection = getState().connections.data[remoteSocketId];\r\n\r\n  if (existingConnection) {\r\n    console.log('connectWithPeer() returning existing connection!');\r\n    return existingConnection;\r\n  } else {\r\n    console.log('connectWithPeer - no existing connection found');\r\n    const newConnection = await dispatch(initNewRTCPeerConnection(remoteSocketId));\r\n    await dispatch(addConnection(newConnection));\r\n    return newConnection;\r\n  }\r\n};\r\n\r\nexport const sendDataToConnection = (dataChannel, data) => async (dispatch, getState) => {\r\n  if (dataChannel) {\r\n    const serializedData = JSON.stringify(data);\r\n    dataChannel.send(serializedData);\r\n  }\r\n};\r\n\r\nexport const joinRoom = (roomId, password) => async (dispatch, getState) => { // TODO move to room actions\r\n  const { socket } = getState().localUser;\r\n\r\n  if (socket) {\r\n    socket.emit('join', { roomId, password, socketId: socket.id },\r\n      // callback: the joining user himself is responsible to establish connections with other users\r\n      async (err, data) => {\r\n        if (!err) {\r\n          await dispatch(startLocalStream());\r\n          await dispatch({ type: SET_CURRENT_ROOM, payload: { room: data.room } });\r\n          data.room.joinedUsers.forEach((remoteSocketId) => dispatch(connectWithPeer(remoteSocketId)));\r\n          console.log(`There are ${data.room.joinedUsers.length}x joinedUsers`);\r\n        } else {\r\n          dispatch(setCurrentRoomError(err));\r\n        }\r\n      });\r\n  }\r\n};\r\n\r\nexport const introduceYourself = (dataChannel) => async (dispatch, getState) => {\r\n  const { socket, metadata } = getState().localUser;\r\n\r\n  if (socket && metadata) {\r\n    dispatch(sendDataToConnection(dataChannel, { type: 'PEER_INTRODUCTION', payload: { senderSocketId: socket.id, metadata: metadata } }));\r\n  } else {\r\n    console.error('socket and/or metadata not available!');\r\n  }\r\n};\r\n\r\nexport const initNewRTCPeerConnection = (remoteSocketId) => async (dispatch, getState) => {\r\n  console.log('dispatch initNewRTCPeerConnection() - remoteSocketId', remoteSocketId);\r\n  const { socket } = getState().localUser;\r\n\r\n  const configuration = {\r\n    iceServers: [{ urls: 'stun:stun.l.google.com:19302' }],\r\n    iceCandidatePoolSize: 1\r\n  };\r\n\r\n  const newConnection = new RTCPeerConnection(configuration);\r\n  newConnection.socketId = socket.id;\r\n  newConnection.remoteSocketId = remoteSocketId;\r\n\r\n  newConnection.defaultDataChannel = newConnection.createDataChannel('default');\r\n  dispatch(initDataChannelListeners(newConnection.defaultDataChannel));\r\n\r\n  const localStreamWrapper = await getState().localUser.mediaStream;\r\n  if (localStreamWrapper) {\r\n    console.log('--adding local stream tracks to new connection -', localStreamWrapper.stream.getTracks().length, 'x tracks');\r\n    localStreamWrapper.stream.getTracks().forEach(track => newConnection.addTrack(track, localStreamWrapper.stream));\r\n  }\r\n\r\n  // await dispatch(addConnection(newConnection)); // TODO DA cannot be added here since remote description isnt added yet\r\n  return newConnection;\r\n};\r\n\r\nexport const updateStreamForConnections = (newStream) => async (dispatch, getState) => {\r\n  const connections = Object.values(getState().connections.data);\r\n\r\n  connections.forEach(connection => {\r\n    const senders = connection.getSenders();\r\n\r\n    console.log('removing existing stream tracks');\r\n    senders.forEach((sender) => connection.removeTrack(sender));\r\n\r\n    if (newStream) {\r\n      console.log('adding updated stream tracks to all connections');\r\n      newStream.getTracks().forEach(track => connection.addTrack(track, newStream));\r\n    }\r\n  });\r\n};\r\n","import {INIT_LOCAL_USER_SOCKET, RESET_LOCAL_USER, SET_LOCAL_USER_LOADING, SET_LOCAL_USER_METADATA} from '../actionTypes';\r\nimport io from 'socket.io-client';\r\nimport {getPersistedData, persistData, serializeQueryString} from '../../utils';\r\nimport {addConnection, initNewRTCPeerConnection, removeConnection} from './connections.actions';\r\nimport {setCurrentRoomError} from './room.actions';\r\nimport {BACKEND_URL} from '../../constants';\r\nimport {addStream} from './remoteStreams.actions';\r\n\r\nexport const resetLocalUser = () => ({ type: RESET_LOCAL_USER });\r\n\r\n/**\r\n * Init the socket.io client. Once socket is ready, init the peerJS Peer and store them in the store.\r\n */\r\nexport const initLocalUser = () => async (dispatch, getState) => {\r\n  const metadata = getPersistedData('metadata');\r\n\r\n  if (!getState().localUser.loading) {\r\n    if (!metadata.nickname || !metadata.nickname.length) {\r\n      dispatch(setCurrentRoomError({ error: { name: 'RoomError', message: 'Please enter a nickname before joining the room.' } }));\r\n    } else {\r\n      dispatch(initLocalUserSocket(metadata));\r\n    }\r\n  }\r\n};\r\n\r\nconst initLocalUserSocket = (metadata) => async (dispatch, getState) => {\r\n\r\n  dispatch({ type: SET_LOCAL_USER_LOADING, payload: { loading: true } });\r\n  const socket = io(BACKEND_URL, {\r\n    // transports: ['websocket'],\r\n    secure: window.location.protocol === 'https',\r\n    query: serializeQueryString(metadata)\r\n  });\r\n\r\n  dispatch(initLocalUserSocketListeners(socket));\r\n};\r\n\r\nconst initLocalUserSocketListeners = (socket) => async (dispatch, getState) => {\r\n  socket.on('ready', (socketId) => {\r\n    dispatch({ type: INIT_LOCAL_USER_SOCKET, payload: { socket } });\r\n\r\n    socket.on('user-leave', (socketId) => {\r\n      const connection = getState().connections.data[socketId];\r\n      if (connection) {\r\n        dispatch(removeConnection(connection));\r\n      }\r\n    });\r\n\r\n    socket.on('signaling', async ({ senderSocketId, description, iceCandidates }) => {\r\n      console.log('---on signaling description type =', description ? description.type : '-');\r\n      // For reference: https://w3c.github.io/webrtc-pc/#perfect-negotiation-example\r\n      try {\r\n        let connection = getState().connections.data[senderSocketId];\r\n        let wasNew = false;\r\n        if (!connection) {\r\n          wasNew = true;\r\n          console.log('very first offer received. Connection does not exist yet! creating one -  I am the polite peer');\r\n          // If connection does not already exists, the senderSocketId was sending the very first offer\r\n          connection = await (dispatch(initNewRTCPeerConnection(senderSocketId)));\r\n          connection.polite = true; // the peer receiving very first offer is initially the polite one\r\n          connection.makingOffer = false;\r\n          connection.ignoringOffer = false;\r\n          connection.isSettingRemoteAnswerPending = false;\r\n\r\n          // FIXME temp\r\n          // await dispatch(addConnection(connection)); // NOTE cannote be done before setting remote description, but if not done now the receiving peer doesnt get stream. If done now the receiving peers onnegotiationneeded event gets fired errorously\r\n\r\n          connection.ontrack = ({ track, streams }) => {\r\n            console.log('ontrack - remote stream track received');\r\n            if (streams && streams[0]) {\r\n              console.log('ontrack - adding remote stream track');\r\n              dispatch(addStream(connection.remoteSocketId, streams[0]));\r\n            } else {\r\n              console.error('ontrack - this should not happen... streams[0] is empty!');\r\n            }\r\n          };\r\n        }\r\n\r\n        if (description) {\r\n          // An offer may come in while we are busy processing SRD(answer).\r\n          // In this case, we will be in \"stable\" by the time the offer is processed\r\n          // so it is safe to chain it on our Operations Chain now.\r\n\r\n          const readyForOffer = !connection.makingOffer && (connection.signalingState === 'stable' || connection.isSettingRemoteAnswerPending);\r\n          const offerCollision = description.type === 'offer' && !readyForOffer;\r\n\r\n          // While impolite peer is making an offer he will ignore incoming offers\r\n          connection.ignoreOffer = !connection.polite && offerCollision;\r\n          if (connection.ignoreOffer) {\r\n            console.log('I am impolite and will IGNORE the offer from socketID', connection.remoteSocketId);\r\n            return;\r\n          }\r\n\r\n          connection.isSettingRemoteAnswerPending = description.type === 'answer';\r\n          await connection.setRemoteDescription(new RTCSessionDescription(description)); // with implicit rollback\r\n          if (wasNew) {\r\n            console.log('WASNEW - adding connection');\r\n            await dispatch(addConnection(connection));\r\n          }\r\n          connection.isSettingRemoteAnswerPending = false;\r\n\r\n          if (description.type === 'offer') {\r\n            console.log('I received an offer and will create an answer');\r\n            const answer = await connection.createAnswer();\r\n            await connection.setLocalDescription(answer);\r\n            socket.emit('signaling', { receiverSocketId: connection.remoteSocketId, description: connection.localDescription });\r\n          }\r\n        } else if (iceCandidates) {\r\n          try {\r\n            console.log('--receiving ice candidates', iceCandidates.length, 'x');\r\n            for (const candidate of iceCandidates) {\r\n              await connection.addIceCandidate(new RTCIceCandidate(candidate));\r\n            }\r\n          } catch (err) {\r\n            if (!connection.ignoreOffer) {\r\n              throw err;\r\n            }\r\n          }\r\n        }\r\n      } catch (err) {\r\n        console.error(err);\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport const setMetadata = (metadata) => (dispatch, getState) => {\r\n  persistData('metadata', metadata);\r\n  dispatch({ type: SET_LOCAL_USER_METADATA, payload: { metadata } });\r\n};\r\n\r\n","export const BACKEND_URL = process.env.REACT_APP_BACKEND_URL || window.location.origin;\r\n","import React, {useEffect, useRef} from 'react';\r\nimport {setVideoSrc} from '../../../utils';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Card, CircularProgress, Box} from '@material-ui/core';\r\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: 'flex'\r\n  },\r\n  cardWrapper: {\r\n    position: 'relative',\r\n    display: 'flex',\r\n    flexFlow: 'column nowrap',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    marginBottom: '5px',\r\n    width: '100%',\r\n    height: '130px'\r\n  },\r\n  videoOffIcon: {\r\n    position: 'absolute',\r\n    top: '50%',\r\n    left: '50%',\r\n    transform: 'translate(-50%, -50%)'\r\n  },\r\n  media: {\r\n    width: '100%',\r\n    height: '100%',\r\n    objectFit: 'cover'\r\n  },\r\n  displayName: {\r\n    color: 'white',\r\n    opacity: '0.8',\r\n    position: 'absolute',\r\n    bottom: '5px',\r\n    left: '5px',\r\n    fontSize: '0.9rem',\r\n    userSelect: 'none'\r\n  }\r\n}));\r\n\r\nconst GenericMediaCard = ({ stream, muted = false, user }) => {\r\n  const classes = useStyles();\r\n  const videoRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    setVideoSrc(videoRef, stream, muted);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [stream]);\r\n\r\n  return (\r\n    <Card className={classes.cardWrapper}>\r\n      {stream\r\n        ? <video ref={videoRef} className={classes.media}/>\r\n        : <CircularProgress color=\"inherit\"/>\r\n      }\r\n\r\n      {stream && !stream.getVideoTracks()[0] && <VideocamOffIcon className={classes.videoOffIcon} color='primary' fontSize='large'/>}\r\n      {user && user.nickname && <Box className={classes.displayName}>{user.nickname}</Box>}\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default GenericMediaCard;\r\n","import React, {useEffect, useState} from 'react';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Box, Button, Input, DialogActions, FormControl, InputLabel, Select, Dialog, DialogTitle, DialogContent} from '@material-ui/core';\r\nimport {connect} from 'react-redux';\r\nimport GenericMediaCard from '../../Room/GenericMediaCard/GenericMediaCard';\r\nimport VideocamIcon from '@material-ui/icons/Videocam';\r\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff';\r\nimport MicIcon from '@material-ui/icons/Mic';\r\nimport MicOffIcon from '@material-ui/icons/MicOff';\r\nimport {setMediaStreamConstraints, startLocalStream, stopLocalStream, toggleCameraEnabled, toggleMicrophoneEnabled} from '../../../store/actions/localStream.actions';\r\n\r\nconst useStyles = makeStyles({\r\n  containerForm: {\r\n    width: '400px',\r\n    maxWidth: '90vw'\r\n  },\r\n  formControl: {\r\n    display: 'block'\r\n  },\r\n  select: {\r\n    width: '100%',\r\n    marginBottom: '1rem'\r\n  }\r\n});\r\n\r\nconst MediaPreview = ({ dispatch, socket, localStreamWrapper, mediaConstraints }) => {\r\n  const classes = useStyles();\r\n\r\n  const [audioInputDevices, setAudioInputDevices] = useState(null);\r\n  const [videoInputDevices, setVideoInputDevices] = useState(null);\r\n\r\n  const [currentAudioDevice, setCurrentAudioDevice] = useState(null);\r\n  const [currentVideoDevice, setCurrentVideoDevice] = useState(null);\r\n\r\n  const [settingsOpen, setSettingsOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    initListOfDevices();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    handleSaveSettings();\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [currentVideoDevice, currentAudioDevice]);\r\n\r\n  useEffect(() => {\r\n    if (settingsOpen) {\r\n      dispatch(startLocalStream());\r\n    } else {\r\n      dispatch(stopLocalStream());\r\n    }\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [settingsOpen]);\r\n\r\n  useEffect(() => {\r\n    if (localStreamWrapper) {\r\n      const audioTrack = localStreamWrapper.stream.getAudioTracks()[0];\r\n      if (audioTrack && audioInputDevices) {\r\n        const audioDevice = audioInputDevices.find(d => d.label === audioTrack.label);\r\n        if (audioDevice) {\r\n          setCurrentAudioDevice(audioDevice);\r\n        }\r\n      }\r\n      const videoTrack = localStreamWrapper.stream.getVideoTracks()[0];\r\n      if (videoTrack && videoInputDevices) {\r\n        const videoDevice = videoInputDevices.find(d => d.label === videoTrack.label);\r\n        if (videoDevice) {\r\n          setCurrentVideoDevice(videoDevice);\r\n        }\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [localStreamWrapper]);\r\n\r\n  const setAudioIcon = () => {\r\n    if (localStreamWrapper) {\r\n      const audioTrack = localStreamWrapper.stream.getAudioTracks()[0];\r\n      if (audioTrack && audioTrack.enabled) {\r\n        return <MicIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <MicOffIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  const setVideoIcon = () => { // TODO deduplicate toggle buttons for audio/video\r\n    if (localStreamWrapper) {\r\n      const videoTrack = localStreamWrapper.stream.getVideoTracks()[0];\r\n      if (videoTrack && videoTrack.enabled) {\r\n        return <VideocamIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <VideocamOffIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  const initListOfDevices = async () => {\r\n    const devices = await navigator.mediaDevices.enumerateDevices();\r\n    setAudioInputDevices(devices.filter((device) => device.kind === 'audioinput'));\r\n    setVideoInputDevices(devices.filter((device) => device.kind === 'videoinput'));\r\n  };\r\n\r\n  const handleChangeCurrentAudioDevice = evt => {\r\n    const selectedLabel = evt.target.value;\r\n    const selectedDevice = audioInputDevices.find(d => d.label === selectedLabel);\r\n    setCurrentAudioDevice(selectedDevice || null);\r\n  };\r\n\r\n  const handleChangeCurrentVideoDevice = evt => {\r\n    const selectedLabel = evt.target.value;\r\n    const selectedDevice = videoInputDevices.find(d => d.label === selectedLabel);\r\n    setCurrentVideoDevice(selectedDevice || null);\r\n  };\r\n\r\n  const handleClickOpen = async () => {\r\n    setSettingsOpen(true);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setSettingsOpen(false);\r\n  };\r\n\r\n  const handleSaveSettings = async () => {\r\n    const newConstraints = { ...mediaConstraints };\r\n    if (currentAudioDevice) {\r\n      newConstraints.audio = { ...newConstraints.audio, deviceId: currentAudioDevice.deviceId };\r\n    }\r\n\r\n    if (currentVideoDevice) {\r\n      newConstraints.video = { ...newConstraints.video, deviceId: currentVideoDevice.deviceId };\r\n    }\r\n\r\n    if (currentAudioDevice && currentVideoDevice) {\r\n      await dispatch(setMediaStreamConstraints(newConstraints));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box>\r\n      <Button onClick={handleClickOpen}>Preview Audio & Video Settings</Button>\r\n\r\n      <div>\r\n        <Dialog disableBackdropClick disableEscapeKeyDown open={settingsOpen} onClose={(handleClose)}>\r\n          <DialogTitle>Audio & Video Settings</DialogTitle>\r\n          <DialogContent>\r\n\r\n            <GenericMediaCard stream={localStreamWrapper ? localStreamWrapper.stream : null} muted={false}/>\r\n            {/* toggle Camera enabled */}\r\n            <Button style={{ height: '100%' }} onClick={() => dispatch(toggleCameraEnabled())}>\r\n              {setVideoIcon()}\r\n            </Button>\r\n            {/* toggle Microphone enabled */}\r\n            <Button style={{ height: '100%' }} onClick={() => dispatch(toggleMicrophoneEnabled())}>\r\n              {setAudioIcon()}\r\n            </Button>\r\n\r\n            <form className={classes.containerForm}>\r\n              <FormControl className={classes.formControl}>\r\n                <InputLabel htmlFor=\"select-mic\">Audio Input (Microphone)</InputLabel>\r\n                <Select\r\n                  className={classes.select}\r\n                  native\r\n                  value={currentAudioDevice ? currentAudioDevice.label : ''}\r\n                  onChange={handleChangeCurrentAudioDevice}\r\n                  input={<Input id=\"select-mic\"/>}\r\n                >\r\n                  {audioInputDevices && audioInputDevices.map((device, i) => <option key={device.groupId + i}>{device.label}</option>)}\r\n                </Select>\r\n              </FormControl>\r\n              <FormControl className={classes.formControl}>\r\n                <InputLabel htmlFor=\"select-cam\">Video Input (Camera)</InputLabel>\r\n                <Select\r\n                  className={classes.select}\r\n                  native\r\n                  value={currentVideoDevice ? currentVideoDevice.label : ''}\r\n                  onChange={handleChangeCurrentVideoDevice}\r\n                  input={<Input id=\"select-cam\"/>}\r\n                >\r\n                  {videoInputDevices && videoInputDevices.map((device, i) => <option key={device.groupId + i}>{device.label}</option>)}\r\n                </Select>\r\n              </FormControl>\r\n            </form>\r\n          </DialogContent>\r\n\r\n          <DialogActions>\r\n            <Button onClick={handleClose} color=\"primary\">Close</Button>\r\n            {/*<Button onClick={handleSaveSettings} color=\"primary\">Save</Button>*/}\r\n          </DialogActions>\r\n        </Dialog>\r\n      </div>\r\n\r\n\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  const socket = state.localUser.socket;\r\n  return {\r\n    socket: socket,\r\n    localStreamWrapper: state.localUser.mediaStream,\r\n    mediaConstraints: state.localUser.mediaConstraints\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(MediaPreview);\r\n","import React, {useState} from 'react';\r\nimport {Link} from 'react-router-dom';\r\nimport {makeStyles, ThemeProvider} from '@material-ui/core/styles';\r\nimport {Box, Button, Grid, TextField, Typography} from '@material-ui/core';\r\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos';\r\nimport theme from '../../style/theme/MainTheme';\r\nimport {resetLocalUser, setMetadata} from '../../store/actions/localUser.actions';\r\nimport {connect} from 'react-redux';\r\nimport {setCurrentRoomError} from '../../store/actions/room.actions';\r\nimport MediaPreview from './MediaPreview/MediaPreview';\r\n\r\nconst useStyles = makeStyles({\r\n  containerStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    paddingTop: '128px'\r\n  },\r\n  titleStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    width: '100%',\r\n    padding: '16px',\r\n    color: 'white',\r\n    fontWeight: 'bold',\r\n    backgroundColor: '#388E3C'\r\n  },\r\n  nicknameStyle: {\r\n    width: '90%',\r\n    margin: '16px'\r\n  },\r\n  textfieldLink: {\r\n    width: '90%',\r\n    marginRight: '16px',\r\n    marginLeft: '16px'\r\n  },\r\n  nextButton: {\r\n    color: 'white',\r\n    boxShadow: 'none',\r\n    width: '100%'\r\n\r\n  },\r\n  alignbutton: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    width: '80%',\r\n    marginTop: '24px',\r\n    marginBottom: '24px'\r\n  }\r\n});\r\n\r\nconst RoomLobby = ({ history, match, setMetadata, nickname, roomError, setCurrentRoomError, resetLocalUser }) => {\r\n  const [newNickname, setNewNickname] = useState(nickname);\r\n  const [link, setLink] = useState(match.params.roomId);\r\n  const classes = useStyles();\r\n\r\n  const handleChangeName = (e) => {\r\n    setNewNickname(e.target.value);\r\n  };\r\n\r\n  const handleChangeLink = (e) => {\r\n    setLink(e.target.value);\r\n  };\r\n\r\n  const handleKeyPress = (e) => {\r\n    if (e.key === 'Enter') {\r\n      handleJoin();\r\n    }\r\n  };\r\n\r\n  const handleJoin = (e) => {\r\n    setMetadata({ nickname: newNickname });\r\n    setCurrentRoomError(null);\r\n    // resetLocalUser(); // FIXME verify that removing it doesn't break enter room error handling\r\n    history.push(`/rooms/${match.params.roomId}`);\r\n  };\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <Box display='flex' height={63} bgcolor='#2E7D32' alignItems='center' paddingLeft='36px'>\r\n        <Link to=\"/\" style={{ textDecoration: 'none', color: 'white' }}><ArrowBackIosIcon/></Link>\r\n      </Box>\r\n      <Grid container className={classes.containerStyle}>\r\n        <Grid item xs={11} md={6} lg={5}>\r\n          <Box display='flex' flexDirection='column' alignItems='center' width={'100%'} borderRadius='5px' bgcolor='white'>\r\n            <Typography variant='h4' className={classes.titleStyle}>Enter the room</Typography>\r\n            <TextField\r\n              required\r\n              label=\"Nickname\"\r\n              variant=\"outlined\"\r\n              value={newNickname}\r\n              className={classes.nicknameStyle}\r\n              onChange={handleChangeName}\r\n              onKeyPress={handleKeyPress}\r\n              autoFocus\r\n            />\r\n            <TextField\r\n              required\r\n              label=\"Room ID\"\r\n              variant=\"outlined\"\r\n              value={link}\r\n              className={classes.textfieldLink}\r\n              onChange={handleChangeLink}\r\n            />\r\n            <div className={classes.alignbutton}>\r\n              <Button onClick={handleJoin} size=\"large\" color=\"secondary\" variant=\"contained\" className={classes.nextButton}>\r\n                join\r\n              </Button>\r\n            </div>\r\n            {roomError && <Box color={'red'} textAlign={'center'}>{roomError.error.message}</Box>}\r\n          </Box>\r\n          <MediaPreview/>\r\n        </Grid>\r\n      </Grid>\r\n    </ThemeProvider>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  nickname: state.localUser.metadata.nickname || '',\r\n  roomError: state.room.error\r\n});\r\n\r\nexport default connect(mapStateToProps, { setMetadata, setCurrentRoomError, resetLocalUser })(RoomLobby);\r\n","import {SET_PLUGIN} from '../actionTypes';\r\nimport {sendDataToConnection} from './connections.actions';\r\n\r\nexport const setPlugin = plugin => (dispatch, getState) => {\r\n  // temporary simplified action\r\n  if (plugin) {\r\n    dispatch({ type: SET_PLUGIN, payload: { plugin } });\r\n  }\r\n};\r\n\r\nconst sendPluginMessageToAllConnections = (evt) => (dispatch, getState) => {\r\n  const connections = Object.values(getState().connections.data);\r\n  const data = { type: 'PLUGIN_DATA', payload: evt.data.payload };\r\n  connections.forEach(connection => {\r\n    dispatch(sendDataToConnection(connection.defaultDataChannel, data)); // TODO seperate dataChannel exclusive for plugin data\r\n  });\r\n};\r\n\r\nconst sendPluginMessageToConnection = (evt) => (dispatch, getState) => {\r\n  const { peerId, payload } = evt.data;\r\n  const connection = getState().connections.data[peerId];\r\n  const data = { type: 'PLUGIN_DATA', payload: payload };\r\n  dispatch(sendDataToConnection(connection.defaultDataChannel, data));\r\n};\r\n\r\n// const handlePluginRequestLocalPeer = () => (dispatch, getState) => {\r\n//     try {\r\n//         // TODO verify plugin has PLUGIN_REQUEST_LOCAL_PEER listed in required permissions and user accepted it on start of plugin\r\n//         //  A plugin will have some kind of manifest file (potentially just a .json) for all kinds of metadata like required permissions, name, max users etc\r\n//         // TODO when opening any plugin for the first time, a prompt opens informing user of the required permissions\r\n//         //  he also needs to give his consent by clicking a button which will whitelist the plugin (localstorage for the beginning)\r\n//         const peerId = getState().localUser.peer.id;\r\n//         const data = {type: 'PLUGIN_REQUEST_LOCAL_PEER_GRANT', payload: {peer: peerId}};\r\n//\r\n//         const iframe = getState().plugin.iframe;\r\n//         if (iframe) {\r\n//             iframe.contentWindow.postMessage(data, \"*\");\r\n//         }\r\n//     } catch (err) {\r\n//         console.error('handleRequestLocalPeer error', err);\r\n//     }\r\n// };\r\n\r\nconst pluginMessageActions = {\r\n  'PLUGIN_SEND_TO_ALL_PEERS': sendPluginMessageToAllConnections,\r\n  'PLUGIN_SEND_TO_PEER': sendPluginMessageToConnection,\r\n  // 'PLUGIN_REQUEST_LOCAL_PEER': handlePluginRequestLocalPeer,\r\n  'PLUGIN_PLATFORM_CONTROL_REQUEST': () => console.log('plugin is requesting something from the platform (mute local user, rumble screen, etc')\r\n};\r\n\r\nexport const handlePluginMessage = (evt) => async (dispatch, getState) => {\r\n  if (evt.data.type && evt.data.type.startsWith('PLUGIN')) {\r\n    const action = pluginMessageActions[evt.data.type];\r\n    dispatch(action(evt));\r\n  }\r\n};\r\n","import React, {useEffect, useRef} from 'react';\r\nimport {Box} from '@material-ui/core';\r\nimport {connect} from 'react-redux';\r\nimport {handlePluginMessage, setPlugin} from '../../../store/actions/plugin.actions';\r\n\r\nconst RoomPluginContent = ({ plugin, handlePluginMessage, setPlugin }) => {\r\n  const iframeRef = useRef();\r\n\r\n  useEffect(() => {\r\n    const handleMessage = (evt) => {\r\n      handlePluginMessage(evt);\r\n    };\r\n    window.addEventListener('message', handleMessage);\r\n    return () => window.removeEventListener('message', handleMessage);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (iframeRef && iframeRef.current) {\r\n      setPlugin({ ...plugin, iframe: iframeRef.current });\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [iframeRef, plugin.url]);\r\n\r\n  return (\r\n    <Box flexGrow={1}>\r\n      {plugin && plugin.url && <iframe src={plugin.url} style={{ width: '100%', height: '100%', border: 'none' }} ref={iframeRef} title={'plugin'}/>}\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  plugin: state.plugin\r\n});\r\n\r\nexport default connect(mapStateToProps, { handlePluginMessage, setPlugin })(RoomPluginContent);\r\n","import React from 'react';\r\nimport GenericMediaCard from '../../GenericMediaCard/GenericMediaCard';\r\nimport {connect} from 'react-redux';\r\n\r\nconst RemoteMediaCard = ({ remoteStream, remoteNickname }) => <GenericMediaCard stream={remoteStream} user={{ nickname: remoteNickname }}/>;\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  const remoteSocketId = ownProps.connection.remoteSocketId;\r\n  const remoteStreamWrapper = remoteSocketId ? state.remoteStreams.data[remoteSocketId] : null;\r\n  const remoteStream = remoteStreamWrapper ? remoteStreamWrapper.stream : null;\r\n  const remoteMetadata = state.peers.data[remoteSocketId] ? state.peers.data[remoteSocketId].metadata : {};\r\n  console.log('-----------------remote stream', remoteStream);\r\n  return {\r\n    remoteStream: remoteStream,\r\n    remoteNickname: remoteMetadata.nickname || 'missing Nickname'\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(RemoteMediaCard);\r\n","import React from 'react';\r\nimport {connect} from 'react-redux';\r\nimport RemoteMediaCard from '../RemoteMediaCard/RemoteMediaCard';\r\n\r\nconst RemoteMediaManager = ({ connections }) => {\r\n  return (\r\n    <>\r\n      {connections && connections.map((connection) => <RemoteMediaCard key={'conn' + connection.remoteSocketId} connection={connection}/>)}\r\n    </>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = state => ({\r\n  connections: Object.values(state.connections.data)\r\n});\r\n\r\nexport default connect(mapStateToProps)(RemoteMediaManager);\r\n","import React from 'react';\r\nimport {connect} from 'react-redux';\r\nimport GenericMediaCard from '../GenericMediaCard/GenericMediaCard';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Box} from '@material-ui/core';\r\nimport RemoteMediaManager from './RemoteMediaManager/RemoteMediaManager';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  roomMediaManager: {\r\n    padding: '5px',\r\n    backgroundColor: '#f5deb340',\r\n    borderLeft: '1px solid #0000003b'\r\n  }\r\n}));\r\n\r\nconst RoomMediaManager = ({ localStream, localPeerMetadata }) => {\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <Box bgcolor='lightblue' width={'220px'} minWidth={'150px'} className={classes.roomMediaManager}>\r\n      <GenericMediaCard stream={localStream} muted={true} user={{ nickname: localPeerMetadata.nickname }}/>\r\n      <RemoteMediaManager/>\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  const localStreamWrapper = state.localUser.mediaStream;\r\n  const localStream = localStreamWrapper ? localStreamWrapper.stream : null;\r\n  return {\r\n    localPeerMetadata: state.localUser.metadata,\r\n    localStream: localStream\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, {})(RoomMediaManager);\r\n","import React, {useState} from 'react';\r\nimport {makeStyles, ThemeProvider} from '@material-ui/core/styles';\r\nimport {List, ListItem, ListItemIcon, ListItemText, Divider, Button, Drawer} from '@material-ui/core';\r\nimport LabelIcon from '@material-ui/icons/Label';\r\nimport WidgetsOutlinedIcon from '@material-ui/icons/WidgetsOutlined';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport theme from '../../../style/theme/MainTheme';\r\nimport {setPlugin} from '../../../store/actions/plugin.actions';\r\nimport {connect} from 'react-redux';\r\n\r\nconst useStyles = makeStyles({\r\n  list: {\r\n    width: 250\r\n  },\r\n  menuIcon: {\r\n    margin: '8px'\r\n  }\r\n});\r\n\r\n// TODO this data will be served by the backend in future releases. Not real plugins except first one in the list\r\nconst plugins = [\r\n  { name: 'Random number', url: 'https://andreas-schoch.github.io/p2p-test-plugin/' },\r\n  { name: 'Paint', url: 'https://andreas-schoch.github.io/quackamole-plugin-paint/' },\r\n  { name: 'Gomoku', url: 'https://quackamole-dev.github.io/quackamole-plugin-gomoku/' },\r\n  { name: '2d Shooter (WIP)', url: 'https://andreas-schoch.github.io/quackamole-plugin-2d-topdown-shooter/' },\r\n  { name: 'Breakout game', url: 'https://andreas-schoch.github.io/breakout-game/' }\r\n];\r\n\r\nconst RoomSidebarMenu = ({ plugin, setPlugin }) => {\r\n  const classes = useStyles();\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const toggleDrawer = (event) => {\r\n    if (event.type === 'keydown') {\r\n      return;\r\n    }\r\n    setOpen(!open);\r\n  };\r\n\r\n  const handleSelectPlugin = (evt) => {\r\n    const index = evt.currentTarget.dataset.index;\r\n    setPlugin(plugin ? { ...plugin, ...plugins[index] } : plugins[index]);\r\n  };\r\n\r\n  const list = () => (\r\n    <div className={classes.list} role=\"presentation\" onClick={toggleDrawer}>\r\n      <List>\r\n        {plugins.map(({ name }, i) => (\r\n          <ListItem button key={name} onClick={handleSelectPlugin} data-index={i}>\r\n            <ListItemIcon><LabelIcon/></ListItemIcon>\r\n            <ListItemText primary={name}/>\r\n          </ListItem>\r\n        ))}\r\n      </List>\r\n      <Divider/>\r\n      <List>\r\n        <ListItem button>\r\n          <ListItemIcon><WidgetsOutlinedIcon/></ListItemIcon>\r\n          <ListItemText primary={'Browse Plugins'}/>\r\n        </ListItem>\r\n      </List>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <Button>\r\n        <MenuIcon onClick={toggleDrawer} color='primary' fontSize='large' className={classes.menuIcon}/>\r\n        <Drawer open={open} onClose={toggleDrawer} anchor={'left'}>\r\n          {list()}\r\n        </Drawer>\r\n      </Button>\r\n    </ThemeProvider>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  plugin: state.plugin\r\n});\r\n\r\nexport default connect(mapStateToProps, { setPlugin })(RoomSidebarMenu);\r\n","import React from 'react';\r\nimport cx from 'clsx'; // TODO This comes from some example code, it has some nice features but we need to discuss whether we want to use it\r\nimport {withStyles} from '@material-ui/core/styles';\r\nimport {Avatar, Grid, Typography} from '@material-ui/core';\r\nimport defaultChatMsgStyles from './ChatStyle';\r\n\r\nconst ChatMsg = withStyles(defaultChatMsgStyles, { name: 'ChatMsg' })(props => {\r\n  const {\r\n    classes,\r\n    avatar,\r\n    messages,\r\n    side,\r\n    GridContainerProps,\r\n    GridItemProps,\r\n    AvatarProps,\r\n    getTypographyProps\r\n  } = props;\r\n\r\n  const attachClass = index => {\r\n    if (index === 0) {\r\n      return classes[`${side}First`];\r\n    }\r\n    if (index === messages.length - 1) {\r\n      return classes[`${side}Last`];\r\n    }\r\n    return '';\r\n  };\r\n  return (\r\n    <Grid container spacing={2} justify={side === 'right' ? 'flex-end' : 'flex-start'}{...GridContainerProps} className={classes.wrapper}>\r\n      {side === 'left' && (\r\n        <Grid item {...GridItemProps}>\r\n          <Avatar src={avatar}{...AvatarProps} className={cx(classes.avatar, AvatarProps.className)}/>\r\n        </Grid>\r\n      )}\r\n      <Grid item xs={8}>\r\n        {messages.map((msg, i) => {\r\n          const TypographyProps = getTypographyProps(msg, i, props);\r\n          return (\r\n            <div key={msg.id || i} className={classes[`${side}Row`]}>\r\n              <Typography align={'left'} {...TypographyProps} className={cx(classes.msg, classes[side], attachClass(i), TypographyProps.className)}>\r\n                {msg}\r\n              </Typography>\r\n            </div>\r\n          );\r\n        })}\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n});\r\n\r\nChatMsg.defaultProps = {\r\n  avatar: '',\r\n  messages: [],\r\n  side: 'left',\r\n  GridContainerProps: {},\r\n  GridItemProps: {},\r\n  AvatarProps: {},\r\n  getTypographyProps: () => ({})\r\n};\r\n\r\nexport default ChatMsg;\r\n","export default ({ palette, spacing }) => {\r\n  const radius = spacing(2.5);\r\n  const size = spacing(4);\r\n  const rightBgColor = palette.primary.main;\r\n  return {\r\n    wrapper: {\r\n      '&:nth-child(1)': {\r\n        marginTop: 'auto' // https://bugs.chromium.org/p/chromium/issues/detail?id=411624\r\n      }\r\n    },\r\n    avatar: {\r\n      width: size,\r\n      height: size\r\n    },\r\n    leftRow: {\r\n      textAlign: 'left'\r\n    },\r\n    rightRow: {\r\n      textAlign: 'right'\r\n    },\r\n    msg: {\r\n      padding: spacing(1, 2),\r\n      borderRadius: 4,\r\n      marginBottom: 4,\r\n      display: 'inline-block',\r\n      wordBreak: 'break-word',\r\n      fontFamily:\r\n        '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"',\r\n      fontSize: '14px'\r\n    },\r\n    left: {\r\n      borderTopRightRadius: radius,\r\n      borderBottomRightRadius: radius,\r\n      backgroundColor: palette.grey[100]\r\n    },\r\n    right: {\r\n      borderTopLeftRadius: radius,\r\n      borderBottomLeftRadius: radius,\r\n      backgroundColor: rightBgColor,\r\n      color: palette.common.white\r\n    },\r\n    leftFirst: {\r\n      borderTopLeftRadius: radius\r\n    },\r\n    leftLast: {\r\n      borderBottomLeftRadius: radius\r\n    },\r\n    rightFirst: {\r\n      borderTopRightRadius: radius\r\n    },\r\n    rightLast: {\r\n      borderBottomRightRadius: radius\r\n    }\r\n  };\r\n};\r\n","import React, {useEffect, useRef, useState} from 'react';\r\nimport ChatMsg from './ChatMsg';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {TextField} from '@material-ui/core';\r\nimport SendIcon from '@material-ui/icons/Send';\r\nimport {connect} from 'react-redux';\r\nimport {sendMessage} from '../../../../store/actions/chat.actions';\r\n// import {toArray} from 'react-emoji-render';\r\n\r\nconst useStyles = makeStyles({\r\n  chat: {\r\n    height: '100vh',\r\n    display: 'flex',\r\n    flexFlow: 'column nowrap',\r\n    width: '320px'\r\n  },\r\n  chatFeed: {\r\n    display: 'flex',\r\n    flexFlow: 'column nowrap',\r\n    flexGrow: 1,\r\n    maxHeight: 'calc(100% - 60px)',\r\n    overflow: 'auto',\r\n    padding: '8px'\r\n  },\r\n  chatInput: {\r\n    display: 'flex',\r\n    flexFlow: 'row nowrap',\r\n    alignItems: 'flex-end',\r\n    padding: '8px'\r\n  },\r\n  chatInputTextfield: {\r\n    flexGrow: 1,\r\n    zIndex: 1000,\r\n    backgroundColor: 'white'\r\n  },\r\n  chatInputSendBtn: {\r\n    fontSize: '40px',\r\n    margin: 'auto 5px',\r\n    cursor: 'pointer',\r\n    opacity: 0.8,\r\n    transition: 'opacity 0.2s',\r\n    '&:hover': {\r\n      opacity: 0.95\r\n    }\r\n  }\r\n});\r\n\r\nconst Chat = ({ chatData, sendMessage, socket }) => {\r\n  const classes = useStyles('');\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const feedRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (feedRef.current) {\r\n      feedRef.current.scrollTop = feedRef.current.scrollHeight;\r\n    }\r\n  }, [chatData]);\r\n\r\n  const handleChangeTexfield = (event) => {\r\n    setNewMessage(event.target.value);\r\n  };\r\n\r\n  const handleKeyPress = (event) => {\r\n    if (event.key === 'Enter') {\r\n      if (event.shiftKey) {\r\n        setNewMessage(newMessage.concat('\\n'));\r\n      } else {\r\n        send(event);\r\n      }\r\n    }\r\n  };\r\n\r\n  const send = (e) => {\r\n    e.preventDefault();\r\n    if (newMessage.replace(/\\n/g, '').length) {\r\n      sendMessage(newMessage);\r\n      setNewMessage('');\r\n    }\r\n  };\r\n\r\n  // const parseEmojis = value => {\r\n  //   // toArray outputs React elements for emojis and strings for other\r\n  //   return toArray(value).reduce((previous, current) => {\r\n  //     if (typeof current === 'string') {\r\n  //       return previous + current;\r\n  //     }\r\n  //     return previous + current.props.children;\r\n  //   }, '');\r\n  // };\r\n\r\n  //handle the chat feed to display all messages on the right position\r\n  const chatMessages = chatData.map((message, i) => message.authorSocketId === socket.id\r\n    ? <ChatMsg key={i} side={'right'} messages={[message.text]}/>\r\n    : <ChatMsg key={i} avatar={''} messages={[message.text]}/>\r\n  );\r\n\r\n  return (\r\n    <div className={classes.chat}>\r\n\r\n      <div className={classes.chatFeed} ref={feedRef}>\r\n        {chatMessages}\r\n      </div>\r\n\r\n      <div className={classes.chatInput}>\r\n        <TextField\r\n          variant=\"outlined\"\r\n          multiline\r\n          rowsMax={5}\r\n          className={classes.chatInputTextfield}\r\n          onChange={handleChangeTexfield}\r\n          onKeyPress={handleKeyPress}\r\n          value={newMessage}\r\n          autoFocus\r\n        />\r\n        <SendIcon className={classes.chatInputSendBtn} onClick={send}/>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = state => ({\r\n  chatData: state.chat,\r\n  socket: state.localUser.socket\r\n});\r\n\r\nexport default connect(mapStateToProps, { sendMessage })(Chat);\r\n","import {ADD_NEW_MESSAGE} from '../actionTypes';\r\nimport {sendDataToConnection} from './connections.actions';\r\n\r\nexport const sendMessage = (text) => async (dispatch, getState) => {\r\n  const connections = Object.values(getState().connections.data);\r\n  const socket = getState().localUser.socket;\r\n\r\n  if (socket) {\r\n    connections.forEach(connection => {\r\n      // FIXME change to use separate data channel only for chat instead of identifying it by type or specific properties\r\n      const message = {\r\n        textMessage: { text: text, authorSocketId: socket.id }\r\n      };\r\n\r\n      dispatch(sendDataToConnection(connection.defaultDataChannel, message));\r\n    });\r\n\r\n    dispatch({\r\n      type: ADD_NEW_MESSAGE,\r\n      payload: { text: text, authorSocketId: socket.id }\r\n    });\r\n  } else {\r\n    console.error('socket not found');\r\n  }\r\n};\r\n","import React, {useState} from 'react';\r\nimport {ThemeProvider} from '@material-ui/core/styles';\r\nimport {Button, Drawer} from '@material-ui/core';\r\nimport ChatIcon from '@material-ui/icons/Chat';\r\nimport theme from '../../../style/theme/MainTheme';\r\nimport Chat from './Chat/Chat';\r\n\r\nconst RoomSidebarChat = () => {\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const toggleDrawer = _ => setOpen(!open);\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <Button onClick={toggleDrawer}>\r\n        <ChatIcon color='primary' fontSize='large'/>\r\n      </Button>\r\n      <Drawer open={open} onClose={toggleDrawer} anchor={'right'}>\r\n        <Chat/>\r\n      </Drawer>\r\n    </ThemeProvider>\r\n  );\r\n};\r\n\r\nexport default RoomSidebarChat;\r\n","import React from 'react';\r\nimport {Box, Button} from '@material-ui/core';\r\nimport HomeIcon from '@material-ui/icons/Home';\r\nimport MicNoneIcon from '@material-ui/icons/MicNone';\r\nimport MicOffIcon from '@material-ui/icons/MicOff';\r\nimport RoomSidebarMenu from '../RoomSidebarMenu/RoomSidebarMenu';\r\nimport MicIcon from '@material-ui/icons/Mic';\r\nimport VideocamIcon from '@material-ui/icons/Videocam';\r\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff';\r\nimport RoomSidebarChat from '../RoomSidebarChat/RoomSidebarChat';\r\nimport {Link} from 'react-router-dom';\r\nimport {connect} from 'react-redux';\r\nimport {toggleCameraEnabled, toggleMicrophoneEnabled} from '../../../store/actions/localStream.actions';\r\n\r\n// TODO actionbar needs some rework.\r\nconst RoomActionbar = ({ localStreamWrapper, dispatch }) => {\r\n\r\n  const setAudioIcon = () => {\r\n    if (localStreamWrapper) {\r\n      const audioTrack = localStreamWrapper.stream.getAudioTracks()[0];\r\n      if (audioTrack) {\r\n        return audioTrack.enabled\r\n          ? <MicIcon color='primary' fontSize='large'/>\r\n          : <MicOffIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <MicNoneIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  const setVideoIcon = () => {\r\n    if (localStreamWrapper) {\r\n      const videoTrack = localStreamWrapper.stream.getVideoTracks()[0];\r\n      if (videoTrack && videoTrack.enabled) {\r\n        return <VideocamIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <VideocamOffIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  return (\r\n    <Box\r\n      bgcolor={'#f5deb3eb'}\r\n      height={'10%'}\r\n      display='flex'\r\n      justifyContent={'center'}\r\n      borderTop={'1px solid #0000003b'}\r\n      alignItems={'center'}\r\n    >\r\n      {/* toggle room menu settings */}\r\n      <RoomSidebarMenu/>\r\n\r\n      {/* Navigate to landing page */}\r\n      <Link to={'/'} style={{ height: '100%' }}>\r\n        <Button style={{ height: '100%' }}>\r\n          <HomeIcon color='primary' fontSize='large'/>\r\n        </Button>\r\n      </Link>\r\n\r\n      {/* toggle Microphone audio track */}\r\n      <Button style={{ height: '100%' }} onClick={() => dispatch(toggleMicrophoneEnabled())}>\r\n        {setAudioIcon()}\r\n      </Button>\r\n\r\n      {/* toggle camera video track */}\r\n      <Button style={{ height: '100%' }} onClick={() => dispatch(toggleCameraEnabled())}>\r\n        {setVideoIcon()}\r\n      </Button>\r\n\r\n      {/* toggle chat */}\r\n      <RoomSidebarChat/>\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    localStreamWrapper: state.localUser.mediaStream\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(RoomActionbar);\r\n","import React, {useEffect} from 'react';\r\nimport {Box} from '@material-ui/core';\r\nimport RoomPluginContent from './RoomPluginContent/RoomPluginContent';\r\nimport RoomMediaManager from './RoomMediaManager/RoomMediaManager';\r\nimport {connect} from 'react-redux';\r\nimport {joinRoom} from '../../store/actions/connections.actions';\r\nimport {initLocalUser} from '../../store/actions/localUser.actions';\r\nimport RoomActionbar from './RoomActionbar/RoomActionbar';\r\nimport {roomExitCleanup} from '../../store/actions/room.actions';\r\nimport {startLocalStream} from '../../store/actions/localStream.actions';\r\n\r\nconst Room = ({ socket, match, history, initLocalUser, joinRoom, roomError, currentRoom, localPeerLoading, roomExitCleanup, startLocalStream }) => {\r\n\r\n  useEffect(() => {\r\n    if (roomError) {\r\n      history.push(`/room-lobby/${match.params.roomId}`);\r\n    } else if (!socket && !localPeerLoading) {\r\n      console.log('Room#useEffect before initLocalUser');\r\n      initLocalUser();\r\n    } else if (socket && socket.id && !currentRoom.id) {\r\n      console.log('Room#useEffect before joinRoom');\r\n      // startLocalStream();\r\n      joinRoom(match.params.roomId, 'dummy123');\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [roomError, socket]);\r\n\r\n  useEffect(() => {\r\n    // unmount\r\n    return () => roomExitCleanup();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <Box display='flex' flexDirection='column' width={1} height={'100%'} justifyContent={'space-between'}>\r\n        <Box display='flex' flexDirection='row' width={1} height={'90%'} justifyContent={'space-between'}>\r\n          <RoomPluginContent/>\r\n          <RoomMediaManager/>\r\n        </Box>\r\n        <RoomActionbar/>\r\n      </Box>\r\n    </>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    socket: state.localUser.socket,\r\n    localPeerLoading: state.localUser.loading,\r\n    roomError: state.room.error,\r\n    currentRoom: state.room.data\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, { initLocalUser, joinRoom, roomExitCleanup, startLocalStream })(Room);\r\n","import React from 'react';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Typography, useMediaQuery} from '@material-ui/core';\r\nimport AssessmentOutlinedIcon from '@material-ui/icons/AssessmentOutlined';\r\nimport CallOutlinedIcon from '@material-ui/icons/CallOutlined';\r\nimport VideogameAssetIcon from '@material-ui/icons/VideogameAsset';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    width: 314,\r\n    height: 400,\r\n    border: 'solid 1px lightgrey',\r\n    backgroundColor: 'white'\r\n  },\r\n  smallScreenContainer: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    width: 314,\r\n    height: 400,\r\n    border: 'solid 1px lightgrey',\r\n    backgroundColor: 'white',\r\n    margin: 8\r\n  },\r\n  alignTitle: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    margin: 24\r\n  },\r\n  customizeTitle: {\r\n    fontWeight: 'bold',\r\n    fontSize: '25px',\r\n    marginLeft: 4\r\n  },\r\n  customizeIcon: {\r\n    marginRight: 4,\r\n    color: 'rgb(46, 125, 50)'\r\n  },\r\n  customizeText: {\r\n    paddingLeft: 16,\r\n    paddingRight: 16,\r\n    marginBottom: 16\r\n  }\r\n});\r\n\r\nconst BulletPoint = (props) => {\r\n  const classes = useStyles();\r\n  const smallScreen = useMediaQuery('(max-width: 950px)');\r\n\r\n  const checkIcons = (icon) => {\r\n    if (icon === 'VideogameAssetIcon') {\r\n      return <VideogameAssetIcon fontSize='large' className={classes.customizeIcon}/>;\r\n    } else if (icon === 'AssessmentOutlinedIcon') {\r\n      return <AssessmentOutlinedIcon fontSize='large' className={classes.customizeIcon}/>;\r\n    } else if (icon === 'CallOutlinedIcon') {\r\n      return <CallOutlinedIcon fontSize='large' className={classes.customizeIcon}/>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={smallScreen ? classes.smallScreenContainer : classes.container}>\r\n      <div className={classes.alignTitle}>\r\n        {checkIcons(props.content.icon)}\r\n        <Typography variant='h4' className={classes.customizeTitle}>{props.content.title}</Typography>\r\n      </div>\r\n      <Typography className={classes.customizeText} align='center'>{props.content.text}</Typography>\r\n      <img src={props.content.image} height='181' width='275' alt='icon'/>\r\n    </div>\r\n  );\r\n};\r\nexport default BulletPoint;\r\n","import React from 'react';\r\nimport {makeStyles, ThemeProvider} from '@material-ui/core/styles';\r\nimport {Typography, Box, Button, useMediaQuery} from '@material-ui/core';\r\nimport theme from '../../style/theme/MainTheme';\r\nimport {Link} from 'react-router-dom';\r\nimport BulletPoint from './BulletPoint/BulletPoint';\r\n\r\nconst useStyles = makeStyles({\r\n  header: {\r\n    color: 'white',\r\n    textTransform: 'uppercase',\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    alignItems: 'center'\r\n  },\r\n  box: {\r\n    display: 'flex',\r\n    width: '100%',\r\n    height: '100%',\r\n    justifyContent: 'center'\r\n  },\r\n  smallScreenBox: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    width: '100%',\r\n    height: '100%',\r\n    alignItems: 'center'\r\n  },\r\n  titleContainer: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    width: '40%',\r\n    minWidth: 310\r\n  },\r\n  titleStyle: {\r\n    color: 'white',\r\n    fontWeight: 'bold',\r\n    marginTop: '98px'\r\n  },\r\n  buttonStyle: {\r\n    borderRadius: '5px',\r\n    // width: '106px',\r\n    fontWeight: 'bold',\r\n    color: 'white',\r\n    backgroundColor: '#FBC02D',\r\n    '&:hover': {\r\n      backgroundColor: '#f9a825'\r\n    },\r\n    '&:focus': {\r\n      outline: 0\r\n    }\r\n  },\r\n  mainImg: {\r\n    display: 'flex',\r\n    height: 224,\r\n    width: 309,\r\n    borderRadius: 5,\r\n    marginTop: 76,\r\n    marginLeft: 36,\r\n    marginRight: 36\r\n  },\r\n  smallScreenMainImg: {\r\n    display: 'flex',\r\n    height: 224,\r\n    width: 309,\r\n    borderRadius: 5,\r\n    margin: 36\r\n  },\r\n  bulletPoints: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    zIndex: '3',\r\n    position: 'relative',\r\n    bottom: 150\r\n  },\r\n  smallScreenBulletPoints: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    marginTop: 72\r\n  }\r\n});\r\n\r\nconst Home = () => {\r\n  const classes = useStyles();\r\n  const smallScreen = useMediaQuery('(max-width: 950px)');\r\n  const bulletPoints = [\r\n    {\r\n      title: 'Gaming',\r\n      icon: 'VideogameAssetIcon',\r\n      image: 'https://via.placeholder.com/400x300',\r\n      text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet.'\r\n    },\r\n    {\r\n      title: 'Working',\r\n      icon: 'AssessmentOutlinedIcon',\r\n      image: 'https://via.placeholder.com/400x300',\r\n      text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet.'\r\n    },\r\n    {\r\n      title: 'Chatting',\r\n      icon: 'CallOutlinedIcon',\r\n      image: 'https://via.placeholder.com/400x300',\r\n      text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet.'\r\n    }\r\n  ];\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      {/* Header */}\r\n      <Box height={63} bgcolor='#2E7D32' className={classes.header}>\r\n        <h1>\r\n          <span role={'img'} aria-label={'a duck'}>🦆 </span>\r\n          Quackamole\r\n          <span role={'img'} aria-label={'an avocado'}> 🥑</span>\r\n        </h1>\r\n      </Box>\r\n\r\n      {/* Body */}\r\n      <Box height={540} display='flex' zIndex={1}>\r\n        <Box className={smallScreen ? classes.smallScreenBox : classes.box} bgcolor='#388E3C'>\r\n          <div className={classes.titleContainer}>\r\n            <Typography variant='h3' className={classes.titleStyle} gutterBottom align='center'>\r\n              Peer-to-peer video chat platform\r\n            </Typography>\r\n            <Link to=\"/create-room\" style={{ textDecoration: 'none' }}>\r\n              <Button size=\"large\" className={classes.buttonStyle}>Create a room</Button>\r\n            </Link>\r\n          </div>\r\n          <img\r\n            src='https://via.placeholder.com/400x300'\r\n            className={smallScreen ? classes.smallScreenMainImg : classes.mainImg}\r\n            alt={'quackamole room preview'}\r\n          />\r\n        </Box>\r\n      </Box>\r\n\r\n      {/* Bullet Points */}\r\n      <div className={smallScreen ? classes.smallScreenBulletPoints : classes.bulletPoints}>\r\n        {bulletPoints.map((data, i) => <BulletPoint content={data} key={data.title + i}> </BulletPoint>)}\r\n      </div>\r\n\r\n      {/*Temporary for debugging purposes*/}\r\n      <Link to={'/rooms/dummy-room-id'}>Test room</Link>\r\n    </ThemeProvider>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n","import React, {useState} from 'react';\r\nimport {Link, useHistory} from 'react-router-dom';\r\nimport {makeStyles, ThemeProvider} from '@material-ui/core/styles';\r\nimport {Box, Button, Grid, TextField, Typography} from '@material-ui/core';\r\nimport theme from '../../style/theme/MainTheme';\r\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport {BACKEND_URL} from '../../constants';\r\n\r\nconst useStyles = makeStyles({\r\n  containerStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    paddingTop: '128px'\r\n  },\r\n  titleStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    padding: '16px',\r\n    color: 'white',\r\n    fontWeight: 'bold',\r\n    backgroundColor: '#388E3C',\r\n    width: '100%'\r\n  },\r\n  formControl: {\r\n    width: '20%',\r\n    margin: '16px'\r\n  },\r\n  select: {\r\n    borderColor: '#FB8C00',\r\n    '&:before': {\r\n      borderColor: '#FB8C00'\r\n    },\r\n    '&:after': {\r\n      borderColor: '#f57c00'\r\n    }\r\n  },\r\n  textfield: {\r\n    width: '90%',\r\n    marginTop: '48px'\r\n  },\r\n  textfieldLink: {\r\n    width: '90%',\r\n    marginRight: '16px',\r\n    marginLeft: '16px'\r\n  },\r\n  alignButton: {\r\n    display: 'flex',\r\n    justifyContent: 'flex-end',\r\n    width: '100%',\r\n    padding: '16px'\r\n  },\r\n  btnCreateWrapper: {\r\n    position: 'relative'\r\n  },\r\n  btnCreate: {\r\n    color: 'white',\r\n    boxShadow: 'none',\r\n  },\r\n  fabProgress: {\r\n    position: 'absolute',\r\n    top: -6,\r\n    left: -6,\r\n    zIndex: 1,\r\n  },\r\n  btnCreateProgress: {\r\n    position: 'absolute',\r\n    top: '50%',\r\n    left: '50%',\r\n    marginTop: -12,\r\n    marginLeft: -12,\r\n  },\r\n  paper: {\r\n    padding: theme.spacing(2),\r\n    textAlign: 'center',\r\n    color: theme.palette.text.secondary\r\n  },\r\n  copyLink: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    marginTop: '16px',\r\n    width: '90%'\r\n  },\r\n  nextButton: {\r\n    color: 'white',\r\n    boxShadow: 'none',\r\n    marginBottom: '16px',\r\n    width: '100%'\r\n  },\r\n  subtitle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    margin: '16px'\r\n  }\r\n});\r\n\r\nconst RoomCreateForm = () => {\r\n  const [name, setName] = useState('');\r\n  const [link, setLink] = useState('');\r\n  const [roomId, setRoomId] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const classes = useStyles();\r\n  const history = useHistory();\r\n\r\n  const handleChangeTexfield = (event) => {\r\n    setName(event.target.value);\r\n  };\r\n\r\n  const handleKeyPress = async (evt) => {\r\n    if (!loading && evt.key === 'Enter') {\r\n        if (!roomId) {\r\n          const room = await createRoom();\r\n\r\n          if (room) {\r\n            setError(null);\r\n            setRoomId(room.id);\r\n            setLink(`${window.location.origin}/#/room-lobby/${room.id}`);\r\n          }\r\n      } else if (!error && roomId) {\r\n        history.push(`/room-lobby/${roomId}`);\r\n      }\r\n\r\n\r\n    }\r\n  };\r\n\r\n  const createRoom = async () => {\r\n    try {\r\n      let data = {\r\n        name: name,\r\n        password: 'Test123.',\r\n        maxUsers: 4\r\n      };\r\n\r\n      if (data.name.length === 0) {\r\n        setError(new Error('The room needs a name'));\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      const res = await fetch(`${BACKEND_URL}/api/rooms`, {\r\n        method: 'post',\r\n        body: JSON.stringify(data),\r\n        headers: { 'Content-Type': 'application/json' }\r\n      });\r\n      setLoading(false);\r\n\r\n      if (res.status >= 400) {\r\n        setError(new Error(`Something went wrong. Try again`));\r\n        return;\r\n      }\r\n\r\n      return await res.json();\r\n    } catch (err) {\r\n      setError(err);\r\n    }\r\n  };\r\n\r\n  const createRoomJSX =\r\n    <Box display='flex' flexDirection='column' alignItems='center' width={'100%'} borderRadius='5px' bgcolor='white'>\r\n      <Typography variant='h4' className={classes.titleStyle}>Create a new room</Typography>\r\n      <TextField\r\n        required\r\n        label='Room name'\r\n        variant='outlined'\r\n        value={name}\r\n        onChange={handleChangeTexfield}\r\n        className={classes.textfield}\r\n        onKeyPress={handleKeyPress}\r\n        autoFocus\r\n      />\r\n      <div className={classes.alignButton}>\r\n        <div className={classes.btnCreateWrapper}>\r\n          <Button\r\n            size='large'\r\n            color='secondary'\r\n            variant='contained'\r\n            disabled={loading}\r\n            className={classes.btnCreate}\r\n            onClick={createRoom}\r\n          >\r\n            Create\r\n          </Button>\r\n            {loading && <CircularProgress size={24} className={classes.btnCreateProgress}/>}\r\n        </div>\r\n      </div>\r\n    </Box>;\r\n\r\n  const shareRoomJSX =\r\n    <Box\r\n      display='flex'\r\n      flexDirection='column'\r\n      alignItems='center'\r\n      width={'100%'}\r\n      borderRadius='5px'\r\n      bgcolor='white'\r\n      onKeyPress={handleKeyPress}\r\n    >\r\n      <Typography variant='h4' className={classes.titleStyle}>Room was created</Typography>\r\n      <div className={classes.copyLink}>\r\n        <TextField variant='outlined' value={link} onChange={handleChangeTexfield} className={classes.textfieldLink} autoFocus/>\r\n        <Button size='large' color='secondary' variant='contained' className={classes.myButton} onClick={() => {\r\n          navigator.clipboard.writeText(link);\r\n        }}>\r\n          copy\r\n        </Button>\r\n      </div>\r\n      <Typography variant='h6' align='center' className={classes.subtitle}>\r\n        Share the link to let people join this room\r\n      </Typography>\r\n\r\n      <Link to={`/room-lobby/${roomId}`} style={{ textDecoration: 'none', width: '80%' }}>\r\n        <Button\r\n          size='large'\r\n          color='secondary'\r\n          variant='contained'\r\n          className={classes.nextButton}\r\n          to={`/room-lobby/${roomId}`}\r\n        >\r\n          next\r\n        </Button>\r\n      </Link>\r\n    </Box>;\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      {/* Header */}\r\n      <Box\r\n        display='flex'\r\n        height={63}\r\n        bgcolor='#2E7D32'\r\n        alignItems='center'\r\n        paddingLeft='36px'\r\n      >\r\n        <Link to='/' style={{ textDecoration: 'none', color: 'white' }}>\r\n          <ArrowBackIosIcon/>\r\n        </Link>\r\n      </Box>\r\n\r\n      {/* Body */}\r\n      <Grid container className={classes.containerStyle}>\r\n        <Grid item xs={11} md={6} lg={6}>\r\n        {roomId ? shareRoomJSX : createRoomJSX}\r\n          {error && <Box color={'red'} textAlign={'center'}>{error.message}</Box>}\r\n        </Grid>\r\n      </Grid>\r\n    </ThemeProvider>\r\n  );\r\n};\r\n\r\nexport default RoomCreateForm;\r\n","import React from 'react';\r\nimport {HashRouter as Router, Route, Switch} from 'react-router-dom';\r\nimport {CssBaseline} from '@material-ui/core';\r\nimport RoomLobby from '../RoomLobby/RoomLobby';\r\nimport Room from '../Room/Room';\r\nimport Home from '../Home/Home';\r\nimport RoomCreateForm from '../RoomCreateForm/RoomCreateForm';\r\n\r\nconst App = () => {\r\n  return (\r\n    <CssBaseline>\r\n      <Router>\r\n        <Switch>\r\n          <Route exact path='/' component={Home}/>\r\n          <Route exact path='/create-room' component={RoomCreateForm}/>\r\n          <Route exact path='/room-lobby/:roomId' component={RoomLobby}/>\r\n          <Route path='/rooms/:roomId' component={Room}/>\r\n        </Switch>\r\n      </Router>\r\n    </CssBaseline>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport './index.scss';\r\nimport ReactDOM from 'react-dom';\r\nimport {Provider} from 'react-redux';\r\nimport store from './store';\r\nimport App from './components/App/App';\r\n// eslint-disable-next-line\r\nimport adapter from 'webrtc-adapter'; // insulates app from browser webrtc implementation differences\r\n\r\nReactDOM.render(\r\n  <>\r\n    <Provider store={store}>\r\n      <App/>\r\n    </Provider>\r\n  </>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}