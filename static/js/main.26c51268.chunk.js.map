{"version":3,"sources":["store/reducers/room.reducer.js","store/actionTypes.js","utils.js","store/reducers/localUser.reducer.js","store/reducers/peers.reducer.js","store/reducers/connections.reducer.js","store/reducers/remoteStreams.reducer.js","store/reducers/plugin.reducer.js","store/reducers/chat.reducer.js","store/reducers/index.js","store/index.js","style/theme/MainTheme.jsx","store/actions/remoteStreams.actions.js","store/actions/room.actions.js","store/actions/localStream.actions.js","store/actions/connections.actions.js","store/actions/localUser.actions.js","components/Room/GenericMediaCard/GenericMediaCard.jsx","components/RoomLobby/MediaPreview/MediaPreview.jsx","components/RoomLobby/RoomLobby.jsx","store/actions/plugin.actions.js","components/Room/RoomPluginContent/RoomPluginContent.jsx","components/Room/RoomMediaManager/RemoteMediaCard/RemoteMediaCard.jsx","components/Room/RoomMediaManager/RemoteMediaManager/RemoteMediaManager.jsx","components/Room/RoomMediaManager/RoomMediaManager.jsx","components/Room/RoomSidebarMenu/RoomSidebarMenu.jsx","components/Room/RoomSidebarChat/Chat/ChatMsg.jsx","components/Room/RoomSidebarChat/Chat/ChatStyle.jsx","components/Room/RoomSidebarChat/Chat/Chat.jsx","store/actions/chat.actions.js","components/Room/RoomSidebarChat/RoomSidebarChat.jsx","components/Room/RoomActionbar/RoomActionbar.jsx","components/Room/Room.jsx","constants.js","components/Home/BulletPoint/BulletPoint.jsx","components/Home/Home.jsx","components/RoomCreateForm/RoomCreateForm.jsx","components/App/App.jsx","index.jsx"],"names":["roomReducer","produce","roomDraft","action","type","data","payload","room","error","visitedLobby","clearStreamTracks","stream","getTracks","console","forEach","track","stop","getPersistedData","key","dataJson","localStorage","getItem","JSON","parse","defaultMediaConstraints","audio","video","width","ideal","height","initialState","socket","metadata","mediaConstraints","mediaStream","micEnabled","camEnabled","loading","localUserReducer","localPeerDraft","oldMediaStream","id","constraints","enabled","peersReducer","peersDraft","socketId","peer","connectionsReducer","connectionsDraft","connection","remoteSocketId","remoteStreamsReducer","streamsDraft","streamWrapper","streamWrappers","current","Object","values","wrappedStream","pluginReducer","pluginDraft","plugin","url","name","iframe","chatReducer","messagesDraft","push","reducer","combineReducers","localUser","peers","connections","remoteStreams","chat","store","createStore","composeWithDevTools","applyMiddleware","thunk","theme","createMuiTheme","palette","primary","main","secondary","addStream","dispatch","getState","removeStream","setCurrentRoomError","setVisitedLobby","roomExitCleanup","state","currentRoom","emit","disconnect","resetLocalUser","localStreamWrapper","a","conn","removeConnection","startLocalStream","log","stopLocalStream","actualConstraints","navigator","mediaDevices","getUserMedia","newStream","updateStreamForConnections","setMediaStreamConstraints","toggleMicrophoneEnabled","newEnabled","toggleCameraEnabled","close","initDataChannelListeners","dataChannel","onmessage","evt","textMessage","nickname","authorSocketId","text","window","postMessage","contentWindow","senderSocketId","onopen","onclose","initConnectionListeners","currentIteration","iceCandidates","timer","length","receiverSocketId","rawDelay","Math","pow","roundedDelay","round","setTimeout","onicecandidate","iceCandidate","candidate","maxIterations","ontrack","streams","onnegotiationneeded","oniceconnectionstatechange","iceConnectionState","restartIce","onsignalingstatechange","signalingState","localDescription","remoteDescription","ondatachannel","defaultDataChannel","channel","introduceYourself","connectWithPeer","initNewRTCPeerConnection","newConnection","sendNewOfferToConnection","sendDataToConnection","serializedData","stringify","send","RTCPeerConnection","iceServers","urls","iceCandidatePoolSize","createDataChannel","tracks","addTrack","getSenders","sender","removeTrack","createOffer","offer","setLocalDescription","description","initLocalUserSocketListeners","on","connectionState","setRemoteDescription","RTCSessionDescription","createAnswer","answer","addIceCandidate","setMetadata","dataStringified","setItem","persistData","useStyles","makeStyles","root","display","cardWrapper","position","flexFlow","justifyContent","alignItems","marginBottom","videoOffIcon","top","left","transform","media","objectFit","displayName","color","opacity","bottom","fontSize","userSelect","GenericMediaCard","muted","user","classes","videoRef","useRef","useEffect","srcObject","oncanplay","play","setVideoSrc","className","ref","getVideoTracks","wrapper","textAlign","dialogWrapper","containerForm","maxWidth","formControl","select","connect","useState","microphones","setMicrophones","cameras","setCameras","currentMicrophone","setCurrentMicrophone","currentCamera","setCurrentCamera","settingsOpen","setSettingsOpen","initListOfDevices","handleSaveSettings","audioTrack","getAudioTracks","audioDevice","find","d","label","videoTrack","videoDevice","enumerateDevices","devices","filter","device","kind","handleClickOpen","handleClose","newConstraints","deviceId","onClick","disableBackdropClick","disableEscapeKeyDown","open","onClose","style","setVideoIcon","setAudioIcon","htmlFor","value","onChange","selectedLabel","target","selectedDevice","input","map","mic","i","groupId","cam","containerStyle","paddingTop","titleStyle","padding","fontWeight","backgroundColor","nicknameStyle","margin","textfieldLink","marginRight","marginLeft","nextButton","boxShadow","alignbutton","marginTop","roomError","history","match","newNickname","setNewNickname","params","roomId","link","setLink","handleJoin","e","ThemeProvider","bgcolor","paddingLeft","to","textDecoration","container","item","xs","md","lg","flexDirection","borderRadius","variant","required","onKeyPress","autoFocus","size","message","setPlugin","pluginMessageActions","peerId","iframeRef","handleMessage","startsWith","handlePluginMessage","addEventListener","removeEventListener","flexGrow","src","border","title","ownProps","remoteStreamWrapper","remoteStream","remoteNickname","roomMediaManager","borderLeft","localStream","localPeerMetadata","minWidth","list","menuIcon","plugins","setOpen","toggleDrawer","event","handleSelectPlugin","index","currentTarget","dataset","anchor","role","button","data-index","ChatMsg","withStyles","spacing","radius","rightBgColor","avatar","leftRow","rightRow","msg","wordBreak","fontFamily","borderTopRightRadius","borderBottomRightRadius","grey","right","borderTopLeftRadius","borderBottomLeftRadius","common","white","leftFirst","leftLast","rightFirst","rightLast","props","messages","side","GridContainerProps","GridItemProps","AvatarProps","getTypographyProps","justify","cx","TypographyProps","align","defaultProps","chatFeed","maxHeight","overflow","chatInput","chatInputTextfield","zIndex","chatInputSendBtn","cursor","transition","chatData","newMessage","setNewMessage","feedRef","scrollTop","scrollHeight","preventDefault","replace","chatMessages","multiline","rowsMax","shiftKey","concat","RoomSidebarChat","_","borderTop","localPeerLoading","password","err","joinedUsers","io","process","transports","secure","location","protocol","query","object","entries","join","smallScreenContainer","alignTitle","customizeTitle","customizeIcon","customizeText","paddingRight","BulletPoint","icon","smallScreen","useMediaQuery","content","image","alt","header","textTransform","box","smallScreenBox","titleContainer","buttonStyle","outline","mainImg","smallScreenMainImg","bulletPoints","smallScreenBulletPoints","Home","aria-label","gutterBottom","borderColor","textfield","alignButton","btnCreateWrapper","btnCreate","fabProgress","btnCreateProgress","paper","copyLink","subtitle","RoomCreateForm","setName","setRoomId","setLoading","setError","useHistory","handleChangeTexfield","handleKeyPress","createRoom","maxUsers","Error","fetch","method","body","headers","res","status","json","origin","createRoomJSX","disabled","CircularProgress","shareRoomJSX","myButton","clipboard","writeText","App","exact","path","component","RoomLobby","Room","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.26c51268.chunk.js","sourcesContent":["import {SET_CURRENT_ROOM, SET_CURRENT_ROOM_ERROR, SET_VISITED_LOBBY} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = {\r\n  data: {\r\n    // id: 'dummy-room-id',\r\n    // name: 'Dummy Room',\r\n  },\r\n  visitedLobby: false,\r\n  error: null\r\n};\r\n\r\nconst roomReducer = produce((roomDraft, action) => {\r\n  switch (action.type) {\r\n    case SET_CURRENT_ROOM: {\r\n      roomDraft.data = action.payload.room;\r\n      roomDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_VISITED_LOBBY: {\r\n      roomDraft.visitedLobby = action.payload.visitedLobby;\r\n      return;\r\n    }\r\n    case SET_CURRENT_ROOM_ERROR: {\r\n      roomDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default roomReducer;\r\n","export const ADD_PEER = 'ADD_PEER';\r\nexport const REMOVE_PEER = 'REMOVE_PEER';\r\nexport const SET_PEERS_ERROR = 'SET_PEERS_ERROR';\r\n\r\nexport const ADD_CONNECTION = 'ADD_CONNECTION';\r\nexport const REMOVE_CONNECTION = 'REMOVE_CONNECTION';\r\nexport const SET_CONNECTIONS_ERROR = 'SET_CONNECTIONS_ERROR';\r\n\r\nexport const ADD_STREAM = 'ADD_STREAM';\r\nexport const REMOVE_STREAM = 'REMOVE_STREAM';\r\nexport const SET_STREAMS_ERROR = 'SET_STREAM_ERROR';\r\nexport const CLEAR_ALL_STREAMS = 'CLEAR_ALL_STREAMS';\r\n\r\nexport const SET_CURRENT_ROOM = 'SET_CURRENT_ROOM';\r\nexport const SET_VISITED_LOBBY = 'SET_VISITED_LOBBY';\r\nexport const SET_CURRENT_ROOM_ERROR = 'SET_CURRENT_ROOM_ERROR';\r\n\r\nexport const SET_LOCAL_USER_LOADING = 'SET_LOCAL_USER_LOADING';\r\nexport const INIT_LOCAL_USER_SOCKET = 'INIT_LOCAL_USER_SOCKET';\r\nexport const INIT_LOCAL_USER_PEER = 'INIT_LOCAL_USER_PEER';\r\nexport const SET_LOCAL_USER_METADATA = 'SET_LOCAL_USER_METADATA';\r\nexport const SET_LOCAL_USER_MEDIA_STREAM = 'SET_LOCAL_USER_MEDIA_STREAM';\r\nexport const SET_LOCAL_USER_MEDIA_CONSTRAINTS = 'SET_LOCAL_USER_MEDIA_CONSTRAINTS';\r\nexport const SET_LOCAL_USER_MICROPHONE_ENABLED = 'SET_LOCAL_USER_MICROPHONE_ENABLED';\r\nexport const SET_LOCAL_USER_CAMERA_ENABLED = 'SET_LOCAL_USER_CAMERA_ENABLED';\r\nexport const SET_LOCAL_USER_ERROR = 'SET_LOCAL_USER_ERROR';\r\nexport const RESET_LOCAL_USER = 'RESET_LOCAL_USER';\r\n\r\nexport const SET_PLUGIN = 'SET_PLUGIN';\r\nexport const SET_PLUGIN_ERROR = 'SET_PLUGIN_ERROR';\r\n\r\nexport const ADD_NEW_MESSAGE = 'ADD_NEW_MESSAGE';\r\n","// The place to put all helper methods that do not necessarily belong to a specific component\r\n// Once this file gets too crowded, create an utils folder and start seperating the exported helper methods\r\n\r\n// import {useEffect, useRef, useState} from \"react\";\r\nimport ipRegex from 'ip-regex';\r\n\r\n/**\r\n * Transforms a javascript object into a query string.\r\n * @param object The source object. Example: {a: 5, b: 10}\r\n * @returns {string} The resulting query string. Example 'a=5&b=10'\r\n */\r\nexport const serializeQueryString = object => {\r\n  return Object.entries(object).map(([key, value]) => `${key}=${value}`).join('&');\r\n};\r\n\r\n/**\r\n * Set the src of a html5 <video> element and start playing\r\n * @param videoRef The reference to the video element\r\n * @param stream The stream that should be played by the referenced video element\r\n * @param muted Whether or not the audio of the stream should be muted\r\n */\r\nexport const setVideoSrc = (videoRef, stream, muted = true) => {\r\n  if (videoRef.current && stream) {\r\n    videoRef.current.srcObject = stream;\r\n    videoRef.current.oncanplay = () => { // FIXME rarely does not get fired for all peers, so remote stream can appear white\r\n      if (videoRef.current) {\r\n        videoRef.current.play();\r\n        videoRef.current.muted = muted;\r\n      }\r\n    };\r\n  }\r\n};\r\n\r\nexport const clearStreamTracks = stream => {\r\n  if (stream) {\r\n    if (!stream.getTracks) {\r\n      console.error('something wrong with the stream:', stream);\r\n      return;\r\n    }\r\n\r\n    stream.getTracks().forEach(track => track.stop());\r\n  }\r\n};\r\n\r\nexport const getPersistedData = (key) => {\r\n  const dataJson = localStorage.getItem(key);\r\n  return dataJson ? JSON.parse(dataJson) : {};\r\n};\r\n\r\nexport const persistData = (key, data) => {\r\n  const dataStringified = JSON.stringify(data);\r\n  localStorage.setItem(key, dataStringified);\r\n};\r\n\r\nexport const isIpAddress = (testedString) => {\r\n  return ipRegex().test(testedString);\r\n};\r\n","import {INIT_LOCAL_USER_SOCKET, RESET_LOCAL_USER, SET_LOCAL_USER_ERROR, SET_LOCAL_USER_LOADING, SET_LOCAL_USER_METADATA, SET_LOCAL_USER_MEDIA_STREAM, SET_LOCAL_USER_MEDIA_CONSTRAINTS, SET_LOCAL_USER_CAMERA_ENABLED, SET_LOCAL_USER_MICROPHONE_ENABLED} from '../actionTypes';\r\nimport {clearStreamTracks, getPersistedData} from '../../utils';\r\nimport produce from 'immer';\r\n\r\nconst defaultMediaConstraints = {\r\n  audio: {},\r\n  video: {\r\n    // frameRate: { ideal: 20, max: 25 }, // FIXME check supported constraints first to prevent errors\r\n    width: { ideal: 128 },\r\n    height: { ideal: 72 }\r\n  }\r\n};\r\n\r\nconst initialState = {\r\n  socket: null,\r\n  metadata: getPersistedData('metadata'),\r\n  mediaConstraints: defaultMediaConstraints,\r\n  mediaStream: null,\r\n  micEnabled: true,\r\n  camEnabled: true,\r\n  loading: false,\r\n  error: null\r\n};\r\n\r\nconst localUserReducer = produce((localPeerDraft, action) => {\r\n  switch (action.type) {\r\n    case SET_LOCAL_USER_LOADING: {\r\n      localPeerDraft.loading = action.payload.loading;\r\n      return;\r\n    }\r\n    case INIT_LOCAL_USER_SOCKET: {\r\n      localPeerDraft.socket = action.payload.socket;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_METADATA: {\r\n      localPeerDraft.metadata = action.payload.metadata;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_MEDIA_STREAM: {\r\n      const oldMediaStream = localPeerDraft.mediaStream;\r\n\r\n      localPeerDraft.mediaStream = action.payload.mediaStream;\r\n      localPeerDraft.error = null;\r\n\r\n      // Cleanup old stream. Without this, webcam light can stay on unintentionally due to unreliable garbage collection\r\n      if (oldMediaStream) {\r\n        if (action.payload.mediaStream && action.payload.mediaStream.stream.id !== oldMediaStream.stream.id) {\r\n          clearStreamTracks(oldMediaStream.stream);\r\n        } else if (!action.payload.mediaStream) {\r\n          clearStreamTracks(oldMediaStream.stream);\r\n        }\r\n      }\r\n\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_MEDIA_CONSTRAINTS: {\r\n      localPeerDraft.mediaConstraints = action.payload.constraints;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_MICROPHONE_ENABLED: {\r\n      localPeerDraft.micEnabled = action.payload.enabled;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_CAMERA_ENABLED: {\r\n      localPeerDraft.camEnabled = action.payload.enabled;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_LOCAL_USER_ERROR: {\r\n      localPeerDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    case RESET_LOCAL_USER: {\r\n      localPeerDraft.socket = null;\r\n      localPeerDraft.metadata = getPersistedData('metadata');\r\n      localPeerDraft.mediaConstraints = defaultMediaConstraints;\r\n      localPeerDraft.mediaStream = null;\r\n      localPeerDraft.micEnabled = true;\r\n      localPeerDraft.camEnabled = true;\r\n      localPeerDraft.loading = false;\r\n      localPeerDraft.error = null;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default localUserReducer;\r\n","import {ADD_PEER, REMOVE_PEER, SET_PEERS_ERROR} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = {\r\n  data: {\r\n    // 'd7f7saim3': {nickname: 'Andi'},\r\n    // '32mfdnmio': {nickname: 'Jimmy'}\r\n  },\r\n  error: null\r\n};\r\n\r\nconst peersReducer = produce((peersDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_PEER: {\r\n      const { socketId, metadata } = action.payload;\r\n      peersDraft.data[socketId] = { metadata };\r\n      peersDraft.error = null;\r\n      return;\r\n    }\r\n    case REMOVE_PEER: {\r\n      const peer = action.payload.peer;\r\n      delete peersDraft.data[peer.id];\r\n      peersDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_PEERS_ERROR: {\r\n      peersDraft.error = action.payload.error;\r\n      return;\r\n\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default peersReducer;\r\n","import {ADD_CONNECTION, REMOVE_CONNECTION, SET_CONNECTIONS_ERROR} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = {\r\n  data: {},\r\n  error: null\r\n};\r\n\r\nconst connectionsReducer = produce((connectionsDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_CONNECTION: {\r\n      const connection = action.payload.connection;\r\n      connectionsDraft.data[connection.remoteSocketId] = connection;\r\n      connectionsDraft.error = null;\r\n      return;\r\n    }\r\n    case REMOVE_CONNECTION: {\r\n      const connection = action.payload.connection;\r\n      delete connectionsDraft.data[connection.remoteSocketId];\r\n      connectionsDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_CONNECTIONS_ERROR: {\r\n      connectionsDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default connectionsReducer;\r\n","import {ADD_STREAM, CLEAR_ALL_STREAMS, REMOVE_STREAM, SET_STREAMS_ERROR} from '../actionTypes';\r\nimport {clearStreamTracks} from '../../utils';\r\nimport produce, {current} from 'immer';\r\n\r\nconst initialState = {\r\n  data: {},\r\n  error: null\r\n};\r\n\r\nconst remoteStreamsReducer = produce((streamsDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_STREAM: {\r\n      const { socketId, stream } = action.payload;\r\n      streamsDraft.data[socketId] = { stream };\r\n      streamsDraft.error = null;\r\n      return;\r\n    }\r\n    case REMOVE_STREAM: {\r\n      const { socketId } = action.payload;\r\n      const streamWrapper = streamsDraft.data[socketId];\r\n      if (streamWrapper) {\r\n        clearStreamTracks(streamWrapper.stream);\r\n        delete streamsDraft.data[socketId];\r\n      }\r\n      return;\r\n    }\r\n    case SET_STREAMS_ERROR: {\r\n      streamsDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    case CLEAR_ALL_STREAMS: {\r\n      const streamWrappers = current(streamsDraft.data);\r\n      Object.values(streamWrappers).forEach(wrappedStream => clearStreamTracks(wrappedStream.stream));\r\n      streamsDraft.data = {};\r\n      streamsDraft.error = null;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default remoteStreamsReducer;\r\n","import {SET_PLUGIN, SET_PLUGIN_ERROR} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\n// TODO there should be a plugins.reducer storing the plugin data of already fetched plugins (once they come from the backend)\r\n//  activePluginId should be stored in the room.reducer, as well as pluginIds that are shown in the room sidebar.\r\n//  plugin data can be fetched from the backend (or could already be included when fetching the room)\r\nconst initialState = {\r\n  // origin: 'null',\r\n  iframe: null,\r\n  url: '',\r\n  name: 'p2p-test-plugin',\r\n  error: null\r\n};\r\n\r\nconst pluginReducer = produce((pluginDraft, action) => {\r\n  switch (action.type) {\r\n    case SET_PLUGIN: {\r\n      const { url, name, iframe } = action.payload.plugin;\r\n      pluginDraft.iframe = iframe;\r\n      pluginDraft.url = url;\r\n      pluginDraft.name = name;\r\n      pluginDraft.error = null;\r\n      return;\r\n    }\r\n    case SET_PLUGIN_ERROR: {\r\n      pluginDraft.error = action.payload.error;\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default pluginReducer;\r\n","import {ADD_NEW_MESSAGE} from '../actionTypes';\r\nimport produce from 'immer';\r\n\r\nconst initialState = [];\r\n\r\nconst chatReducer = produce((messagesDraft, action) => {\r\n  switch (action.type) {\r\n    case ADD_NEW_MESSAGE: {\r\n      messagesDraft.push(action.payload);  // FIXME should be action.payload.message\r\n      return;\r\n    }\r\n    default: {}\r\n  }\r\n}, initialState);\r\n\r\nexport default chatReducer;\r\n","import {combineReducers} from 'redux';\r\nimport roomReducer from './room.reducer';\r\nimport localUserReducer from './localUser.reducer';\r\nimport peersReducer from './peers.reducer';\r\nimport connectionsReducer from './connections.reducer';\r\nimport remoteStreamsReducer from './remoteStreams.reducer';\r\nimport pluginReducer from './plugin.reducer';\r\nimport chatReducer from './chat.reducer';\r\n\r\nconst reducer = combineReducers({\r\n  room: roomReducer,\r\n  localUser: localUserReducer,\r\n  peers: peersReducer,\r\n  connections: connectionsReducer,\r\n  remoteStreams: remoteStreamsReducer,\r\n  plugin: pluginReducer,\r\n  chat: chatReducer\r\n});\r\n\r\nexport default reducer;\r\n","import {applyMiddleware, createStore} from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport {composeWithDevTools} from 'redux-devtools-extension';\r\nimport reducer from './reducers';\r\n\r\nconst store = createStore(reducer, composeWithDevTools(applyMiddleware(thunk)));\r\n\r\nexport default store;\r\n","import {createMuiTheme} from '@material-ui/core/styles';\r\n\r\nconst theme = createMuiTheme({\r\n  palette: {\r\n    primary: {\r\n      main: '#2E7D32'\r\n    },\r\n    secondary: {\r\n      main: '#FBC02D'\r\n    }\r\n  }\r\n});\r\n\r\nexport default theme;\r\n","import {ADD_STREAM, CLEAR_ALL_STREAMS, REMOVE_STREAM} from '../actionTypes';\r\n\r\nexport const addStream = (socketId, stream) => (dispatch, getState) => { // TODO no need for a thunk, rename to setStream & SET_STREAM\r\n  if (stream) {\r\n    dispatch({ type: ADD_STREAM, payload: { socketId, stream } });\r\n  }\r\n};\r\n\r\nexport const removeStream = (socketId) => (dispatch, getState) => { // TODO no need for a thunk\r\n  if (socketId) {\r\n    dispatch({ type: REMOVE_STREAM, payload: { socketId } });\r\n  }\r\n};\r\n\r\nexport const clearAllStreams = () => async (dispatch, getState) => {\r\n  dispatch({ type: CLEAR_ALL_STREAMS });\r\n};\r\n","import {SET_CURRENT_ROOM, SET_CURRENT_ROOM_ERROR, SET_VISITED_LOBBY} from '../actionTypes';\r\nimport {clearAllStreams} from './remoteStreams.actions';\r\nimport {resetLocalUser} from './localUser.actions';\r\nimport {removeConnection} from './connections.actions';\r\n\r\nexport const setCurrentRoom = room => ({\r\n  type: SET_CURRENT_ROOM,\r\n  payload: { room }\r\n});\r\n\r\nexport const setCurrentRoomError = error => ({\r\n  type: SET_CURRENT_ROOM_ERROR,\r\n  payload: { error }\r\n});\r\n\r\nexport const setVisitedLobby = visitedLobby => ({\r\n  type: SET_VISITED_LOBBY,\r\n  payload: { visitedLobby }\r\n});\r\n\r\nexport const roomExitCleanup = () => (dispatch, getState) => {\r\n  const state = getState();\r\n\r\n  dispatch(setVisitedLobby(false));\r\n\r\n  const socket = state.localUser.socket;\r\n  if (socket) {\r\n    // disconnect from socketIO server\r\n    const currentRoom = state.room.data;\r\n    if (currentRoom.id) {\r\n      socket.emit('leave', currentRoom.id);\r\n      dispatch(setCurrentRoom({}));\r\n    }\r\n    socket.disconnect();\r\n    dispatch(resetLocalUser());\r\n\r\n    // clear local media stream\r\n    const localStreamWrapper = state.localUser.mediaStream;\r\n    if (localStreamWrapper) {\r\n      localStreamWrapper.stream.getTracks().forEach(track => track.stop());\r\n    }\r\n    dispatch(clearAllStreams());\r\n  }\r\n\r\n  // close all RTCPeerConnections\r\n  const connections = state.connections.data;\r\n  if (connections) {\r\n    Object.values(connections).forEach(conn => dispatch(removeConnection(conn)));\r\n  }\r\n};\r\n","import {addStream} from './remoteStreams.actions';\r\nimport {clearStreamTracks} from '../../utils';\r\nimport {SET_LOCAL_USER_CAMERA_ENABLED, SET_LOCAL_USER_MEDIA_CONSTRAINTS, SET_LOCAL_USER_MEDIA_STREAM, SET_LOCAL_USER_MICROPHONE_ENABLED} from '../actionTypes';\r\nimport {updateStreamForConnections} from './connections.actions';\r\n\r\nexport const startLocalStream = () => async (dispatch, getState) => {\r\n  console.log('startLocalStream dispatched');\r\n  const { mediaConstraints, micEnabled, camEnabled } = getState().localUser;\r\n\r\n  if (!micEnabled && !camEnabled) {\r\n    dispatch(stopLocalStream());\r\n    return;\r\n  }\r\n\r\n  const actualConstraints = { ...mediaConstraints };\r\n  actualConstraints.audio = micEnabled ? actualConstraints.audio : false;\r\n  actualConstraints.video = camEnabled ? actualConstraints.video : false;\r\n\r\n  try {\r\n    const newStream = await navigator.mediaDevices.getUserMedia(actualConstraints);\r\n    await dispatch(updateStreamForConnections(newStream));\r\n    await dispatch({ type: SET_LOCAL_USER_MEDIA_STREAM, payload: { mediaStream: { stream: newStream } } });\r\n    return newStream;\r\n  } catch (error) {\r\n    console.error('local stream couldn\\'t be started', error);\r\n  }\r\n};\r\n\r\nexport const stopLocalStream = () => async (dispatch, getState) => {\r\n  const { mediaStream } = getState().localUser;\r\n\r\n  if (mediaStream) {\r\n    clearStreamTracks(mediaStream.stream);\r\n    dispatch({ type: SET_LOCAL_USER_MEDIA_STREAM, payload: { mediaStream: false } });\r\n  }\r\n};\r\n\r\nexport const toggleLocalAudio = () => (dispatch, getState) => {\r\n  const socket = getState().localUser.socket;\r\n  if (socket) {\r\n    const localStreamWrapper = getState().localUser.mediaStream;\r\n    if (localStreamWrapper) {\r\n      const localStream = localStreamWrapper.stream;\r\n      localStream.getAudioTracks()[0].enabled = !localStream.getAudioTracks()[0].enabled;\r\n      dispatch(addStream(socket.id, localStream));\r\n    }\r\n  }\r\n};\r\n\r\nexport const toggleLocalVideo = () => (dispatch, getState) => {\r\n  const socket = getState().localUser.socket;\r\n  if (socket) {\r\n    const localStreamWrapper = getState().localUser.mediaStream;\r\n    if (localStreamWrapper) {\r\n      const localStream = localStreamWrapper.stream;\r\n      localStream.getVideoTracks()[0].enabled = !localStream.getVideoTracks()[0].enabled;\r\n      dispatch(addStream(socket.id, localStream));\r\n    }\r\n  }\r\n};\r\n\r\nexport const setMediaStreamConstraints = (constraints) => async (dispatch, getState) => {\r\n  await dispatch({ type: SET_LOCAL_USER_MEDIA_CONSTRAINTS, payload: { constraints } });\r\n\r\n  // Re-Start local stream to update constraints\r\n  const localStreamWrapper = getState().localUser.mediaStream;\r\n  if (localStreamWrapper) {\r\n    dispatch(startLocalStream());\r\n  }\r\n};\r\n\r\nexport const toggleMicrophoneEnabled = () => (dispatch, getState) => {\r\n  const newEnabled = !getState().localUser.micEnabled;\r\n  dispatch({ type: SET_LOCAL_USER_MICROPHONE_ENABLED, payload: { enabled: newEnabled } });\r\n\r\n  // Re-Start local stream to update constraints\r\n  const localStreamWrapper = getState().localUser.mediaStream;\r\n  if (localStreamWrapper || newEnabled) {\r\n    dispatch(startLocalStream());\r\n  }\r\n};\r\n\r\nexport const toggleCameraEnabled = () => (dispatch, getState) => {\r\n  const newEnabled = !getState().localUser.camEnabled;\r\n  dispatch({ type: SET_LOCAL_USER_CAMERA_ENABLED, payload: { enabled: newEnabled } });\r\n\r\n  // Re-Start local stream to update constraints\r\n  const localStreamWrapper = getState().localUser.mediaStream;\r\n  if (localStreamWrapper || newEnabled) {\r\n    dispatch(startLocalStream());\r\n  }\r\n};\r\n","import {ADD_CONNECTION, ADD_NEW_MESSAGE, ADD_PEER, REMOVE_CONNECTION, SET_CURRENT_ROOM} from '../actionTypes';\r\nimport {addStream, removeStream} from './remoteStreams.actions';\r\nimport {setCurrentRoomError} from './room.actions';\r\nimport {startLocalStream} from './localStream.actions';\r\n\r\nexport const removeConnection = connection => async (dispatch, getState) => {\r\n  if (connection && connection.remoteSocketId && connection.socketId) {\r\n\r\n    const stream = getState().remoteStreams.data[connection.remoteSocketId];\r\n    if (stream) {\r\n      await dispatch(removeStream(connection.remoteSocketId));\r\n    }\r\n\r\n    connection.close();\r\n    await dispatch({ type: REMOVE_CONNECTION, payload: { connection } });\r\n  }\r\n};\r\n\r\nexport const initDataChannelListeners = dataChannel => (dispatch, getState) => {\r\n  if (dataChannel) {\r\n    console.log(`Initializing data channel listeners...`);\r\n    dataChannel.onmessage = evt => {\r\n      const data = JSON.parse(evt.data);\r\n      const type = data.type;\r\n\r\n      if (data.textMessage) {\r\n        dispatch({ type: ADD_NEW_MESSAGE, payload: data.textMessage });\r\n\r\n        const metadata = getState().localUser.metadata;\r\n        console.log(\r\n          `%c MESSAGE - ${metadata.nickname || data.textMessage.authorSocketId}: \"${data.textMessage.text}\"`,\r\n          'background: black; color: white; padding: 1rem; border: 1px solid white; border-radius: 5px;'\r\n        );\r\n      }\r\n\r\n      if (type === 'PLUGIN_DATA') {\r\n        window.postMessage(data.payload, '*');\r\n        const iframe = getState().plugin.iframe;\r\n        if (iframe) {\r\n          iframe.contentWindow.postMessage(data, '*');\r\n        }\r\n      }\r\n\r\n      if (type === 'PEER_INTRODUCTION') {\r\n        console.log('Connected peer is introducing himself to you:', data.payload);\r\n        const { senderSocketId, metadata } = data.payload;\r\n        dispatch({ type: ADD_PEER, payload: { metadata: metadata, socketId: senderSocketId } });\r\n      }\r\n    };\r\n\r\n    dataChannel.onopen = () => {\r\n      console.log('datachannel open...');\r\n    };\r\n\r\n    dataChannel.onclose = () => {\r\n      console.log('datachannel close');\r\n    };\r\n  }\r\n};\r\n\r\nexport const initConnectionListeners = connection => (dispatch, getState) => {\r\n  if (connection && connection.socketId) {\r\n    console.log(`Initializing RTCPeerConnection listeners...`);\r\n    const delayMultiplier = 1.5;\r\n    const baseDelay = 450;\r\n    const maxIterations = 9;\r\n    let currentIteration = 0;\r\n    let iceCandidates = [];\r\n\r\n    // emits ice-candidates with an increasing delay until the onicecandidate null event\r\n    // Most of the candidates trickle in within the first 0-2seconds but the null event can happen much later\r\n    // The goal is to send ice-candidates out quickly with the least amount of signaling until the null event\r\n    // High likelihood to be changed/simplified as time goes by...\r\n    const timer = () => {\r\n      if (iceCandidates.length) {\r\n        const { socket } = getState().localUser;\r\n        console.log(`Sending ${iceCandidates.length}x ICE CANDIDATES to peer...`);\r\n        socket.emit('signaling', { receiverSocketId: connection.remoteSocketId, iceCandidates: iceCandidates });\r\n        iceCandidates = [];\r\n      }\r\n\r\n      if (currentIteration <= maxIterations) {\r\n        const rawDelay = baseDelay * Math.pow(delayMultiplier, currentIteration);\r\n        const roundedDelay = Math.round(rawDelay / 100 * 2) * 100 / 2;\r\n\r\n        setTimeout(timer, Math.round(roundedDelay));\r\n        currentIteration++;\r\n      }\r\n    };\r\n    timer();\r\n\r\n    connection.onicecandidate = (evt) => {\r\n\r\n      const iceCandidate = evt.candidate;\r\n      if (iceCandidate) {\r\n        iceCandidates.push(iceCandidate);\r\n      } else {\r\n        console.log('no more ICE');\r\n        currentIteration = maxIterations + 1;\r\n        timer();\r\n      }\r\n    };\r\n\r\n    connection.ontrack = ({ track, streams }) => {\r\n      if (streams && streams[0]) {\r\n        console.log(`A remote stream track was received from ${connection.remoteSocketId}...`);\r\n        dispatch(addStream(connection.remoteSocketId, streams[0]));\r\n      } else {\r\n        console.error('ontrack - this should not happen... streams[0] is empty!');\r\n      }\r\n    };\r\n\r\n    connection.onnegotiationneeded = async evt => {\r\n      console.log(`(onnegotiationneeded triggered for connection with \"${connection.remoteSocketId}\"...)`);\r\n    };\r\n\r\n    connection.oniceconnectionstatechange = () => {\r\n      if (connection.iceConnectionState === 'failed') {\r\n        console.error('oniceconnectionstatechange - restarting ICE');\r\n        connection.restartIce();\r\n      }\r\n    };\r\n\r\n    connection.onsignalingstatechange = evt => {\r\n      if (connection.signalingState === 'stable' && connection.localDescription && connection.remoteDescription) {\r\n        console.log('CONNECTION ESTABLISHED!! signaling state:', connection.signalingState);\r\n      }\r\n    };\r\n\r\n    connection.ondatachannel = async evt => {\r\n      console.log('Remote peer opened a data channel with you...');\r\n      connection.defaultDataChannel = evt.channel;\r\n      await dispatch(initDataChannelListeners(connection.defaultDataChannel));\r\n      dispatch(introduceYourself(connection.defaultDataChannel));\r\n    };\r\n  }\r\n};\r\n\r\n/**\r\n * Establishes the initial connection between two peers.\r\n * @param remoteSocketId - The socketId of the peer you want to connect with\r\n */\r\nexport const connectWithPeer = remoteSocketId => async (dispatch, getState) => {\r\n  const { socket } = getState().localUser;\r\n  if (remoteSocketId === socket.id) return;\r\n\r\n  const existingConnection = getState().connections.data[remoteSocketId];\r\n\r\n  if (existingConnection) {\r\n    console.error(`You already established a connection with ${remoteSocketId}`);\r\n  } else {\r\n    console.log(`Preparing to connect with \"${remoteSocketId}\" ...`);\r\n    const newConnection = await dispatch(initNewRTCPeerConnection(remoteSocketId));\r\n    await dispatch(sendNewOfferToConnection(newConnection));\r\n    return newConnection;\r\n  }\r\n};\r\n\r\nexport const sendDataToConnection = (dataChannel, data) => async (dispatch, getState) => {\r\n  if (dataChannel) {\r\n    const serializedData = JSON.stringify(data);\r\n    dataChannel.send(serializedData);\r\n  }\r\n};\r\n\r\nexport const joinRoom = (roomId, password) => async (dispatch, getState) => { // TODO move to room actions\r\n  const { socket } = getState().localUser;\r\n\r\n  if (socket) {\r\n    socket.emit('join', { roomId, password, socketId: socket.id },\r\n      // callback: the joining user himself is responsible to establish connections with other users\r\n      async (err, data) => {\r\n        if (!err) {\r\n          await dispatch(startLocalStream());\r\n          await dispatch({ type: SET_CURRENT_ROOM, payload: { room: data.room } });\r\n          data.room.joinedUsers.forEach((remoteSocketId) => dispatch(connectWithPeer(remoteSocketId)));\r\n          console.log(`There are ${data.room.joinedUsers.length}x joinedUsers`);\r\n        } else {\r\n          dispatch(setCurrentRoomError(err));\r\n        }\r\n      });\r\n  }\r\n};\r\n\r\nexport const introduceYourself = (dataChannel) => async (dispatch, getState) => {\r\n  const { socket, metadata } = getState().localUser;\r\n\r\n  if (socket && metadata) {\r\n    dispatch(sendDataToConnection(dataChannel, { type: 'PEER_INTRODUCTION', payload: { senderSocketId: socket.id, metadata: metadata } }));\r\n  } else {\r\n    console.error('socket and/or metadata not available!');\r\n  }\r\n};\r\n\r\nexport const initNewRTCPeerConnection = (remoteSocketId) => async (dispatch, getState) => {\r\n  console.log(`Creating new RTCPeerConnection with \"${remoteSocketId}\" ...`);\r\n  const { socket } = getState().localUser;\r\n\r\n  const configuration = {\r\n    iceServers: [{ urls: 'stun:stun.l.google.com:19302' }],\r\n    iceCandidatePoolSize: 1\r\n  };\r\n\r\n  const newConnection = new RTCPeerConnection(configuration);\r\n  newConnection.socketId = socket.id;\r\n  newConnection.remoteSocketId = remoteSocketId;\r\n  newConnection.defaultDataChannel = newConnection.createDataChannel('default');\r\n\r\n  await dispatch(initDataChannelListeners(newConnection.defaultDataChannel));\r\n  await dispatch(initConnectionListeners(newConnection));\r\n\r\n  const localStreamWrapper = await getState().localUser.mediaStream;\r\n  if (localStreamWrapper) {\r\n    const tracks = localStreamWrapper.stream.getTracks();\r\n    console.log(`Adding ${tracks.length}x stream tracks to the new RTCPeerConnection with \"${remoteSocketId}\"...`);\r\n    for (const track of tracks) {\r\n      await newConnection.addTrack(track, localStreamWrapper.stream);\r\n    }\r\n  }\r\n\r\n  await dispatch({ type: ADD_CONNECTION, payload: { connection: newConnection } });\r\n  return newConnection;\r\n};\r\n\r\nexport const updateStreamForConnections = (newStream) => async (dispatch, getState) => {\r\n  const connections = Object.values(getState().connections.data);\r\n\r\n  for (const connection of connections) {\r\n    console.log(`Updating localStream for RTCPeerConnection with \"${connection.remoteSocketId}\"...`);\r\n\r\n    for (const sender of connection.getSenders()) {\r\n      await connection.removeTrack(sender);\r\n    }\r\n\r\n    if (newStream) {\r\n      for (const track of newStream.getTracks()) {\r\n        await connection.addTrack(track, newStream);\r\n      }\r\n    }\r\n\r\n    dispatch(sendNewOfferToConnection(connection));\r\n  }\r\n};\r\n\r\nexport const sendNewOfferToConnection = (connection) => async (dispatch, getState) => {\r\n  const socket = getState().localUser.socket;\r\n  const offer = await connection.createOffer();\r\n  await connection.setLocalDescription(offer);\r\n  console.log('Sending offer to remote peer...');\r\n  socket.emit('signaling', { receiverSocketId: connection.remoteSocketId, description: connection.localDescription });\r\n};\r\n","import {INIT_LOCAL_USER_SOCKET, RESET_LOCAL_USER, SET_LOCAL_USER_LOADING, SET_LOCAL_USER_METADATA} from '../actionTypes';\r\nimport io from 'socket.io-client';\r\nimport {getPersistedData, persistData, serializeQueryString} from '../../utils';\r\nimport {initNewRTCPeerConnection, removeConnection} from './connections.actions';\r\nimport {setCurrentRoomError} from './room.actions';\r\nimport {BACKEND_URL} from '../../constants';\r\n\r\nexport const resetLocalUser = () => ({ type: RESET_LOCAL_USER });\r\n\r\n/**\r\n * Init the socket.io client. Once socket is ready, init the peerJS Peer and store them in the store.\r\n */\r\nexport const initLocalUser = () => async (dispatch, getState) => {\r\n  const metadata = getPersistedData('metadata');\r\n\r\n  if (!getState().localUser.loading) {\r\n    if (!metadata.nickname || !metadata.nickname.length) {\r\n      dispatch(setCurrentRoomError({ error: { name: 'RoomError', message: 'Please enter a nickname before joining the room.' } }));\r\n    } else {\r\n      dispatch({ type: SET_LOCAL_USER_LOADING, payload: { loading: true } });\r\n      const socket = io(BACKEND_URL, {\r\n        transports: ['websocket'],\r\n        secure: window.location.protocol === 'https',\r\n        query: serializeQueryString(metadata)\r\n      });\r\n\r\n      dispatch(initLocalUserSocketListeners(socket));\r\n    }\r\n  }\r\n};\r\n\r\nconst initLocalUserSocketListeners = (socket) => async (dispatch, getState) => {\r\n  socket.on('ready', (socketId) => {\r\n    dispatch({ type: INIT_LOCAL_USER_SOCKET, payload: { socket } });\r\n\r\n    socket.on('user-leave', (socketId) => {\r\n      const connection = getState().connections.data[socketId];\r\n      if (connection) {\r\n        dispatch(removeConnection(connection));\r\n      }\r\n    });\r\n\r\n    socket.on('signaling', async ({ senderSocketId, description, iceCandidates }) => {\r\n      let connection = getState().connections.data[senderSocketId];\r\n      if (!connection) {\r\n        connection = await (dispatch(initNewRTCPeerConnection(senderSocketId)));\r\n      }\r\n\r\n      // RECEIVING OFFER\r\n      if (description && description.type === 'offer') {\r\n        console.log(`You received an ${connection.connectionState === 'new' ? 'INITIAL' : ''} OFFER from \"${senderSocketId}\"...`);\r\n\r\n        await connection.setRemoteDescription(new RTCSessionDescription(description));\r\n        const answer = await connection.createAnswer();\r\n        await connection.setLocalDescription(answer);\r\n        console.log('Sending answer to remote peer...');\r\n        socket.emit('signaling', { receiverSocketId: senderSocketId, description: answer });\r\n\r\n        // RECEIVING ANSWER\r\n      } else if (description && description.type) {\r\n        console.log(`You received an ANSWER from \"${senderSocketId}\"...`);\r\n        if (!connection) {\r\n          console.error('No offer was ever made for the received answer. Investigate!');\r\n        }\r\n        await connection.setRemoteDescription(new RTCSessionDescription(description));\r\n\r\n        // RECEIVING ICE CANDIDATES\r\n      } else if (iceCandidates) {\r\n        console.log(`You received ICE CANDIDATES from \"${senderSocketId}\"...`);\r\n        for (const candidate of iceCandidates) {\r\n          await connection.addIceCandidate(candidate);\r\n        }\r\n      }\r\n    });\r\n  });\r\n};\r\n\r\nexport const setMetadata = (metadata) => (dispatch, getState) => {\r\n  persistData('metadata', metadata);\r\n  dispatch({ type: SET_LOCAL_USER_METADATA, payload: { metadata } });\r\n};\r\n","import React, {useEffect, useRef} from 'react';\r\nimport {setVideoSrc} from '../../../utils';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Card, CircularProgress, Box} from '@material-ui/core';\r\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: 'flex'\r\n  },\r\n  cardWrapper: {\r\n    position: 'relative',\r\n    display: 'flex',\r\n    flexFlow: 'column nowrap',\r\n    justifyContent: 'center',\r\n    alignItems: 'center',\r\n    marginBottom: '5px',\r\n    width: '100%',\r\n    height: '130px'\r\n  },\r\n  videoOffIcon: {\r\n    position: 'absolute',\r\n    top: '50%',\r\n    left: '50%',\r\n    transform: 'translate(-50%, -50%)'\r\n  },\r\n  media: {\r\n    width: '100%',\r\n    height: '100%',\r\n    objectFit: 'cover'\r\n  },\r\n  displayName: {\r\n    color: 'white',\r\n    opacity: '0.8',\r\n    position: 'absolute',\r\n    bottom: '5px',\r\n    left: '5px',\r\n    fontSize: '0.9rem',\r\n    userSelect: 'none'\r\n  }\r\n}));\r\n\r\nconst GenericMediaCard = ({ stream, muted = false, user }) => {\r\n  const classes = useStyles();\r\n  const videoRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    setVideoSrc(videoRef, stream, muted);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [stream]);\r\n\r\n  return (\r\n    <Card className={classes.cardWrapper}>\r\n      {stream\r\n        ? <video ref={videoRef} className={classes.media}/>\r\n        : <CircularProgress color=\"inherit\"/>\r\n      }\r\n\r\n      {stream && !stream.getVideoTracks()[0] && <VideocamOffIcon className={classes.videoOffIcon} color='primary' fontSize='large'/>}\r\n      {user && user.nickname && <Box className={classes.displayName}>{user.nickname}</Box>}\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default GenericMediaCard;\r\n","import React, {useEffect, useState} from 'react';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Box, Button, Input, DialogActions, FormControl, InputLabel, Select, Dialog, DialogTitle, DialogContent, MenuItem} from '@material-ui/core';\r\nimport {connect} from 'react-redux';\r\nimport GenericMediaCard from '../../Room/GenericMediaCard/GenericMediaCard';\r\nimport VideocamIcon from '@material-ui/icons/Videocam';\r\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff';\r\nimport MicIcon from '@material-ui/icons/Mic';\r\nimport MicOffIcon from '@material-ui/icons/MicOff';\r\nimport {setMediaStreamConstraints, startLocalStream, stopLocalStream, toggleCameraEnabled, toggleMicrophoneEnabled} from '../../../store/actions/localStream.actions';\r\n\r\nconst useStyles = makeStyles({\r\n  wrapper: {\r\n    textAlign: 'center'\r\n  },\r\n  dialogWrapper: {\r\n    display: 'block'\r\n  },\r\n  containerForm: {\r\n    maxWidth: '95vw'\r\n  },\r\n  formControl: {\r\n    display: 'block'\r\n  },\r\n  select: {\r\n    width: '100%',\r\n    marginBottom: '1rem'\r\n  }\r\n});\r\n\r\nconst MediaPreview = ({ dispatch, localStreamWrapper, mediaConstraints }) => {\r\n  const classes = useStyles();\r\n\r\n  const [microphones, setMicrophones] = useState(null);\r\n  const [cameras, setCameras] = useState(null);\r\n\r\n  const [currentMicrophone, setCurrentMicrophone] = useState(null);\r\n  const [currentCamera, setCurrentCamera] = useState(null);\r\n\r\n  const [settingsOpen, setSettingsOpen] = useState(false);\r\n\r\n  useEffect(() => {\r\n    initListOfDevices();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    handleSaveSettings();\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [currentCamera, currentMicrophone]);\r\n\r\n  useEffect(() => {\r\n    if (settingsOpen) {\r\n      dispatch(startLocalStream());\r\n    } else {\r\n      dispatch(stopLocalStream());\r\n    }\r\n\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [settingsOpen]);\r\n\r\n  useEffect(() => {\r\n    if (localStreamWrapper) {\r\n      const audioTrack = localStreamWrapper.stream.getAudioTracks()[0];\r\n      if (audioTrack && microphones) {\r\n        const audioDevice = microphones.find(d => d.label === audioTrack.label);\r\n        if (audioDevice) {\r\n          setCurrentMicrophone(audioDevice);\r\n        }\r\n      }\r\n      const videoTrack = localStreamWrapper.stream.getVideoTracks()[0];\r\n      if (videoTrack && cameras) {\r\n        const videoDevice = cameras.find(d => d.label === videoTrack.label);\r\n        if (videoDevice) {\r\n          setCurrentCamera(videoDevice);\r\n        }\r\n      }\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [localStreamWrapper]);\r\n\r\n  const setAudioIcon = () => {\r\n    if (localStreamWrapper) {\r\n      const audioTrack = localStreamWrapper.stream.getAudioTracks()[0];\r\n      if (audioTrack && audioTrack.enabled) {\r\n        return <MicIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <MicOffIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  const setVideoIcon = () => { // TODO deduplicate toggle buttons for audio/video\r\n    if (localStreamWrapper) {\r\n      const videoTrack = localStreamWrapper.stream.getVideoTracks()[0];\r\n      if (videoTrack && videoTrack.enabled) {\r\n        return <VideocamIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <VideocamOffIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  const initListOfDevices = async () => {\r\n    const devices = await navigator.mediaDevices.enumerateDevices();\r\n    setMicrophones(devices.filter((device) => device.kind === 'audioinput'));\r\n    setCameras(devices.filter((device) => device.kind === 'videoinput'));\r\n  };\r\n\r\n  const handleChangeCurrentAudioDevice = evt => {\r\n    const selectedLabel = evt.target.value;\r\n    const selectedDevice = microphones.find(d => d.label === selectedLabel);\r\n    setCurrentMicrophone(selectedDevice || null);\r\n  };\r\n\r\n  const handleChangeCurrentVideoDevice = evt => {\r\n    const selectedLabel = evt.target.value;\r\n    const selectedDevice = cameras.find(d => d.label === selectedLabel);\r\n    setCurrentCamera(selectedDevice || null);\r\n  };\r\n\r\n  const handleClickOpen = async () => {\r\n    setSettingsOpen(true);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    setSettingsOpen(false);\r\n  };\r\n\r\n  const handleSaveSettings = async () => {\r\n    const newConstraints = { ...mediaConstraints };\r\n    if (currentMicrophone) {\r\n      newConstraints.audio = { ...newConstraints.audio, deviceId: currentMicrophone.deviceId };\r\n    }\r\n\r\n    if (currentCamera) {\r\n      newConstraints.video = { ...newConstraints.video, deviceId: currentCamera.deviceId };\r\n    }\r\n\r\n    if (currentMicrophone && currentCamera) {\r\n      await dispatch(setMediaStreamConstraints(newConstraints));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box className={classes.wrapper}>\r\n      <Button onClick={handleClickOpen}>Preview Audio & Video Settings</Button>\r\n\r\n      <div>\r\n        <Dialog className={classes.dialogWrapper} disableBackdropClick disableEscapeKeyDown open={settingsOpen} onClose={(handleClose)}>\r\n          <DialogTitle>Audio & Video Settings</DialogTitle>\r\n          <DialogContent className={classes.dialogWrapper}>\r\n\r\n            <GenericMediaCard stream={localStreamWrapper ? localStreamWrapper.stream : null} muted={false}/>\r\n            {/* toggle Camera enabled */}\r\n            <Button style={{ height: '100%' }} onClick={() => dispatch(toggleCameraEnabled())}>\r\n              {setVideoIcon()}\r\n            </Button>\r\n            {/* toggle Microphone enabled */}\r\n            <Button style={{ height: '100%' }} onClick={() => dispatch(toggleMicrophoneEnabled())}>\r\n              {setAudioIcon()}\r\n            </Button>\r\n\r\n            <form className={classes.containerForm}>\r\n              <FormControl className={classes.formControl}>\r\n                <InputLabel htmlFor=\"select-mic\">Audio Input (Microphone)</InputLabel>\r\n                <Select\r\n                  className={classes.select}\r\n                  value={currentMicrophone ? currentMicrophone.label : ''}\r\n                  onChange={handleChangeCurrentAudioDevice}\r\n                  input={<Input id=\"select-mic\"/>}\r\n                >\r\n                  {microphones && microphones.map((mic, i) => <MenuItem key={mic.groupId + i} value={mic.label}>{mic.label}</MenuItem>)}\r\n                </Select>\r\n              </FormControl>\r\n              <FormControl className={classes.formControl}>\r\n                <InputLabel htmlFor=\"select-cam\">Video Input (Camera)</InputLabel>\r\n                <Select\r\n                  className={classes.select}\r\n                  value={currentCamera ? currentCamera.label : ''}\r\n                  onChange={handleChangeCurrentVideoDevice}\r\n                  input={<Input id=\"select-cam\"/>}\r\n                >\r\n                  {cameras && cameras.map((cam, i) => <MenuItem key={cam.groupId + i} value={cam.label}>{cam.label}</MenuItem>)}\r\n                </Select>\r\n              </FormControl>\r\n            </form>\r\n          </DialogContent>\r\n\r\n          <DialogActions>\r\n            <Button onClick={handleClose} color=\"primary\">Close</Button>\r\n            {/*<Button onClick={handleSaveSettings} color=\"primary\">Save</Button>*/}\r\n          </DialogActions>\r\n\r\n        </Dialog>\r\n      </div>\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    localStreamWrapper: state.localUser.mediaStream,\r\n    mediaConstraints: state.localUser.mediaConstraints\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(MediaPreview);\r\n","import React, {useState} from 'react';\r\nimport {Link} from 'react-router-dom';\r\nimport {makeStyles, ThemeProvider} from '@material-ui/core/styles';\r\nimport {Box, Button, Grid, TextField, Typography} from '@material-ui/core';\r\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos';\r\nimport theme from '../../style/theme/MainTheme';\r\nimport {setMetadata} from '../../store/actions/localUser.actions';\r\nimport {connect} from 'react-redux';\r\nimport {setCurrentRoomError, setVisitedLobby} from '../../store/actions/room.actions';\r\nimport MediaPreview from './MediaPreview/MediaPreview';\r\n\r\nconst useStyles = makeStyles({\r\n  containerStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    paddingTop: '128px'\r\n  },\r\n  titleStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    width: '100%',\r\n    padding: '16px',\r\n    color: 'white',\r\n    fontWeight: 'bold',\r\n    backgroundColor: '#388E3C'\r\n  },\r\n  nicknameStyle: {\r\n    width: '90%',\r\n    margin: '16px'\r\n  },\r\n  textfieldLink: {\r\n    width: '90%',\r\n    marginRight: '16px',\r\n    marginLeft: '16px'\r\n  },\r\n  nextButton: {\r\n    color: 'white',\r\n    boxShadow: 'none',\r\n    width: '100%'\r\n\r\n  },\r\n  alignbutton: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    width: '80%',\r\n    marginTop: '24px',\r\n    marginBottom: '24px'\r\n  }\r\n});\r\n\r\nconst RoomLobby = ({ dispatch, history, match, nickname, roomError }) => {\r\n  const [newNickname, setNewNickname] = useState(nickname);\r\n  const [link, setLink] = useState(match.params.roomId);\r\n  const classes = useStyles();\r\n\r\n  const handleChangeName = (e) => {\r\n    setNewNickname(e.target.value);\r\n  };\r\n\r\n  const handleChangeLink = (e) => {\r\n    setLink(e.target.value);\r\n  };\r\n\r\n  const handleKeyPress = (e) => {\r\n    if (e.key === 'Enter') {\r\n      handleJoin();\r\n    }\r\n  };\r\n\r\n  const handleJoin = async (e) => {\r\n    dispatch(setMetadata({ nickname: newNickname }));\r\n    dispatch(setVisitedLobby(true));\r\n    dispatch(setCurrentRoomError(null));\r\n    history.push(`/rooms/${match.params.roomId}`);\r\n  };\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <Box display='flex' height={63} bgcolor='#2E7D32' alignItems='center' paddingLeft='36px'>\r\n        <Link to=\"/\" style={{ textDecoration: 'none', color: 'white' }}><ArrowBackIosIcon/></Link>\r\n      </Box>\r\n      <Grid container className={classes.containerStyle}>\r\n        <Grid item xs={11} md={6} lg={5}>\r\n          <Box display='flex' flexDirection='column' alignItems='center' width={'100%'} borderRadius='5px' bgcolor='white'>\r\n            <Typography variant='h4' className={classes.titleStyle}>Enter the room</Typography>\r\n            <TextField\r\n              required\r\n              label=\"Nickname\"\r\n              variant=\"outlined\"\r\n              value={newNickname}\r\n              className={classes.nicknameStyle}\r\n              onChange={handleChangeName}\r\n              onKeyPress={handleKeyPress}\r\n              autoFocus\r\n            />\r\n            <TextField\r\n              required\r\n              label=\"Room ID\"\r\n              variant=\"outlined\"\r\n              value={link}\r\n              className={classes.textfieldLink}\r\n              onChange={handleChangeLink}\r\n            />\r\n            <div className={classes.alignbutton}>\r\n              <Button onClick={handleJoin} size=\"large\" color=\"secondary\" variant=\"contained\" className={classes.nextButton}>\r\n                join\r\n              </Button>\r\n            </div>\r\n            {roomError && <Box color={'red'} textAlign={'center'}>{roomError.error.message}</Box>}\r\n          </Box>\r\n          <MediaPreview/>\r\n        </Grid>\r\n      </Grid>\r\n    </ThemeProvider>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  nickname: state.localUser.metadata.nickname || '',\r\n  roomError: state.room.error\r\n});\r\n\r\nexport default connect(mapStateToProps)(RoomLobby);\r\n","import {SET_PLUGIN} from '../actionTypes';\r\nimport {sendDataToConnection} from './connections.actions';\r\n\r\nexport const setPlugin = plugin => (dispatch, getState) => {\r\n  // temporary simplified action\r\n  if (plugin) {\r\n    dispatch({ type: SET_PLUGIN, payload: { plugin } });\r\n  }\r\n};\r\n\r\nconst sendPluginMessageToAllConnections = (evt) => (dispatch, getState) => {\r\n  const connections = Object.values(getState().connections.data);\r\n  const data = { type: 'PLUGIN_DATA', payload: evt.data.payload };\r\n  connections.forEach(connection => {\r\n    dispatch(sendDataToConnection(connection.defaultDataChannel, data)); // TODO seperate dataChannel exclusive for plugin data\r\n  });\r\n};\r\n\r\nconst sendPluginMessageToConnection = (evt) => (dispatch, getState) => {\r\n  const { peerId, payload } = evt.data;\r\n  const connection = getState().connections.data[peerId];\r\n  const data = { type: 'PLUGIN_DATA', payload: payload };\r\n  dispatch(sendDataToConnection(connection.defaultDataChannel, data));\r\n};\r\n\r\n// const handlePluginRequestLocalPeer = () => (dispatch, getState) => {\r\n//     try {\r\n//         // TODO verify plugin has PLUGIN_REQUEST_LOCAL_PEER listed in required permissions and user accepted it on start of plugin\r\n//         //  A plugin will have some kind of manifest file (potentially just a .json) for all kinds of metadata like required permissions, name, max users etc\r\n//         // TODO when opening any plugin for the first time, a prompt opens informing user of the required permissions\r\n//         //  he also needs to give his consent by clicking a button which will whitelist the plugin (localstorage for the beginning)\r\n//         const peerId = getState().localUser.peer.id;\r\n//         const data = {type: 'PLUGIN_REQUEST_LOCAL_PEER_GRANT', payload: {peer: peerId}};\r\n//\r\n//         const iframe = getState().plugin.iframe;\r\n//         if (iframe) {\r\n//             iframe.contentWindow.postMessage(data, \"*\");\r\n//         }\r\n//     } catch (err) {\r\n//         console.error('handleRequestLocalPeer error', err);\r\n//     }\r\n// };\r\n\r\nconst pluginMessageActions = {\r\n  'PLUGIN_SEND_TO_ALL_PEERS': sendPluginMessageToAllConnections,\r\n  'PLUGIN_SEND_TO_PEER': sendPluginMessageToConnection,\r\n  // 'PLUGIN_REQUEST_LOCAL_PEER': handlePluginRequestLocalPeer,\r\n  'PLUGIN_PLATFORM_CONTROL_REQUEST': () => console.log('plugin is requesting something from the platform (mute local user, rumble screen, etc')\r\n};\r\n\r\nexport const handlePluginMessage = (evt) => async (dispatch, getState) => {\r\n  if (evt.data.type && evt.data.type.startsWith('PLUGIN')) {\r\n    const action = pluginMessageActions[evt.data.type];\r\n    dispatch(action(evt));\r\n  }\r\n};\r\n","import React, {useEffect, useRef} from 'react';\r\nimport {Box} from '@material-ui/core';\r\nimport {connect} from 'react-redux';\r\nimport {handlePluginMessage, setPlugin} from '../../../store/actions/plugin.actions';\r\n\r\nconst RoomPluginContent = ({ dispatch, plugin }) => {\r\n  const iframeRef = useRef();\r\n\r\n  useEffect(() => {\r\n    const handleMessage = (evt) => {\r\n      dispatch(handlePluginMessage(evt));\r\n    };\r\n    window.addEventListener('message', handleMessage);\r\n    return () => window.removeEventListener('message', handleMessage);\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (iframeRef && iframeRef.current) {\r\n      dispatch(setPlugin({ ...plugin, iframe: iframeRef.current }));\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [iframeRef, plugin.url]);\r\n\r\n  return (\r\n    <Box flexGrow={1}>\r\n      {plugin && plugin.url && <iframe src={plugin.url} style={{ width: '100%', height: '100%', border: 'none' }} ref={iframeRef} title={'plugin'}/>}\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  plugin: state.plugin\r\n});\r\n\r\nexport default connect(mapStateToProps)(RoomPluginContent);\r\n","import React from 'react';\r\nimport GenericMediaCard from '../../GenericMediaCard/GenericMediaCard';\r\nimport {connect} from 'react-redux';\r\n\r\nconst RemoteMediaCard = ({ remoteStream, remoteNickname }) => <GenericMediaCard stream={remoteStream} user={{ nickname: remoteNickname }}/>;\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n  const remoteSocketId = ownProps.connection.remoteSocketId;\r\n  const remoteStreamWrapper = remoteSocketId ? state.remoteStreams.data[remoteSocketId] : null;\r\n  const remoteStream = remoteStreamWrapper ? remoteStreamWrapper.stream : null;\r\n  const remoteMetadata = state.peers.data[remoteSocketId] ? state.peers.data[remoteSocketId].metadata : {};\r\n  return {\r\n    remoteStream: remoteStream,\r\n    remoteNickname: remoteMetadata.nickname || 'missing Nickname'\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(RemoteMediaCard);\r\n","import React from 'react';\r\nimport {connect} from 'react-redux';\r\nimport RemoteMediaCard from '../RemoteMediaCard/RemoteMediaCard';\r\n\r\nconst RemoteMediaManager = ({ connections }) => {\r\n  return (\r\n    <>\r\n      {connections && connections.map((connection) => <RemoteMediaCard key={'conn' + connection.remoteSocketId} connection={connection}/>)}\r\n    </>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = state => ({\r\n  connections: Object.values(state.connections.data)\r\n});\r\n\r\nexport default connect(mapStateToProps)(RemoteMediaManager);\r\n","import React from 'react';\r\nimport {connect} from 'react-redux';\r\nimport GenericMediaCard from '../GenericMediaCard/GenericMediaCard';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Box} from '@material-ui/core';\r\nimport RemoteMediaManager from './RemoteMediaManager/RemoteMediaManager';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  roomMediaManager: {\r\n    padding: '5px',\r\n    backgroundColor: '#f5deb340',\r\n    borderLeft: '1px solid #0000003b'\r\n  }\r\n}));\r\n\r\nconst RoomMediaManager = ({ localStream, localPeerMetadata }) => {\r\n  const classes = useStyles();\r\n\r\n  return (\r\n    <Box bgcolor='lightblue' width={'220px'} minWidth={'150px'} className={classes.roomMediaManager}>\r\n      <GenericMediaCard stream={localStream} muted={true} user={{ nickname: localPeerMetadata.nickname }}/>\r\n      <RemoteMediaManager/>\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  const localStreamWrapper = state.localUser.mediaStream;\r\n  const localStream = localStreamWrapper ? localStreamWrapper.stream : null;\r\n  return {\r\n    localPeerMetadata: state.localUser.metadata,\r\n    localStream: localStream\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(RoomMediaManager);\r\n","import React, {useState} from 'react';\r\nimport {makeStyles, ThemeProvider} from '@material-ui/core/styles';\r\nimport {List, ListItem, ListItemIcon, ListItemText, Divider, Button, Drawer} from '@material-ui/core';\r\nimport LabelIcon from '@material-ui/icons/Label';\r\nimport WidgetsOutlinedIcon from '@material-ui/icons/WidgetsOutlined';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport theme from '../../../style/theme/MainTheme';\r\nimport {setPlugin} from '../../../store/actions/plugin.actions';\r\nimport {connect} from 'react-redux';\r\n\r\nconst useStyles = makeStyles({\r\n  list: {\r\n    width: 250\r\n  },\r\n  menuIcon: {\r\n    margin: '8px'\r\n  }\r\n});\r\n\r\n// TODO this data will be served by the backend in future releases. Not real plugins except first one in the list\r\nconst plugins = [\r\n  { name: 'Random number', url: 'https://andreas-schoch.github.io/p2p-test-plugin/' },\r\n  { name: 'Paint', url: 'https://andreas-schoch.github.io/quackamole-plugin-paint/' },\r\n  { name: 'Gomoku', url: 'https://quackamole-dev.github.io/quackamole-plugin-gomoku/' },\r\n  { name: '2d Shooter (WIP)', url: 'https://andreas-schoch.github.io/quackamole-plugin-2d-topdown-shooter/' },\r\n  { name: 'Breakout game', url: 'https://andreas-schoch.github.io/breakout-game/' }\r\n];\r\n\r\nconst RoomSidebarMenu = ({ dispatch, plugin }) => {\r\n  const classes = useStyles();\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const toggleDrawer = (event) => {\r\n    if (event.type === 'keydown') {\r\n      return;\r\n    }\r\n    setOpen(!open);\r\n  };\r\n\r\n  const handleSelectPlugin = (evt) => {\r\n    const index = evt.currentTarget.dataset.index;\r\n    dispatch(setPlugin(plugin ? { ...plugin, ...plugins[index] } : plugins[index]));\r\n  };\r\n\r\n  const list = () => (\r\n    <div className={classes.list} role=\"presentation\" onClick={toggleDrawer}>\r\n      <List>\r\n        {plugins.map(({ name }, i) => (\r\n          <ListItem button key={name} onClick={handleSelectPlugin} data-index={i}>\r\n            <ListItemIcon><LabelIcon/></ListItemIcon>\r\n            <ListItemText primary={name}/>\r\n          </ListItem>\r\n        ))}\r\n      </List>\r\n      <Divider/>\r\n      <List>\r\n        <ListItem button>\r\n          <ListItemIcon><WidgetsOutlinedIcon/></ListItemIcon>\r\n          <ListItemText primary={'Browse Plugins'}/>\r\n        </ListItem>\r\n      </List>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <Button>\r\n        <MenuIcon onClick={toggleDrawer} color='primary' fontSize='large' className={classes.menuIcon}/>\r\n        <Drawer open={open} onClose={toggleDrawer} anchor={'left'}>\r\n          {list()}\r\n        </Drawer>\r\n      </Button>\r\n    </ThemeProvider>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n  plugin: state.plugin\r\n});\r\n\r\nexport default connect(mapStateToProps)(RoomSidebarMenu);\r\n","import React from 'react';\r\nimport cx from 'clsx'; // TODO This comes from some example code, it has some nice features but we need to discuss whether we want to use it\r\nimport {withStyles} from '@material-ui/core/styles';\r\nimport {Avatar, Grid, Typography} from '@material-ui/core';\r\nimport defaultChatMsgStyles from './ChatStyle';\r\n\r\nconst ChatMsg = withStyles(defaultChatMsgStyles, { name: 'ChatMsg' })(props => {\r\n  const {\r\n    classes,\r\n    avatar,\r\n    messages,\r\n    side,\r\n    GridContainerProps,\r\n    GridItemProps,\r\n    AvatarProps,\r\n    getTypographyProps\r\n  } = props;\r\n\r\n  const attachClass = index => {\r\n    if (index === 0) {\r\n      return classes[`${side}First`];\r\n    }\r\n    if (index === messages.length - 1) {\r\n      return classes[`${side}Last`];\r\n    }\r\n    return '';\r\n  };\r\n  return (\r\n    <Grid container spacing={2} justify={side === 'right' ? 'flex-end' : 'flex-start'}{...GridContainerProps} className={classes.wrapper}>\r\n      {side === 'left' && (\r\n        <Grid item {...GridItemProps}>\r\n          <Avatar src={avatar}{...AvatarProps} className={cx(classes.avatar, AvatarProps.className)}/>\r\n        </Grid>\r\n      )}\r\n      <Grid item xs={8}>\r\n        {messages.map((msg, i) => {\r\n          const TypographyProps = getTypographyProps(msg, i, props);\r\n          return (\r\n            <div key={msg.id || i} className={classes[`${side}Row`]}>\r\n              <Typography align={'left'} {...TypographyProps} className={cx(classes.msg, classes[side], attachClass(i), TypographyProps.className)}>\r\n                {msg}\r\n              </Typography>\r\n            </div>\r\n          );\r\n        })}\r\n      </Grid>\r\n    </Grid>\r\n  );\r\n});\r\n\r\nChatMsg.defaultProps = {\r\n  avatar: '',\r\n  messages: [],\r\n  side: 'left',\r\n  GridContainerProps: {},\r\n  GridItemProps: {},\r\n  AvatarProps: {},\r\n  getTypographyProps: () => ({})\r\n};\r\n\r\nexport default ChatMsg;\r\n","export default ({ palette, spacing }) => {\r\n  const radius = spacing(2.5);\r\n  const size = spacing(4);\r\n  const rightBgColor = palette.primary.main;\r\n  return {\r\n    wrapper: {\r\n      '&:nth-child(1)': {\r\n        marginTop: 'auto' // https://bugs.chromium.org/p/chromium/issues/detail?id=411624\r\n      }\r\n    },\r\n    avatar: {\r\n      width: size,\r\n      height: size\r\n    },\r\n    leftRow: {\r\n      textAlign: 'left'\r\n    },\r\n    rightRow: {\r\n      textAlign: 'right'\r\n    },\r\n    msg: {\r\n      padding: spacing(1, 2),\r\n      borderRadius: 4,\r\n      marginBottom: 4,\r\n      display: 'inline-block',\r\n      wordBreak: 'break-word',\r\n      fontFamily: 'Roboto, Helvetica, Arial, sans-serif',\r\n      fontSize: '14px'\r\n    },\r\n    left: {\r\n      borderTopRightRadius: radius,\r\n      borderBottomRightRadius: radius,\r\n      backgroundColor: palette.grey[100]\r\n    },\r\n    right: {\r\n      borderTopLeftRadius: radius,\r\n      borderBottomLeftRadius: radius,\r\n      backgroundColor: rightBgColor,\r\n      color: palette.common.white\r\n    },\r\n    leftFirst: {\r\n      borderTopLeftRadius: radius\r\n    },\r\n    leftLast: {\r\n      borderBottomLeftRadius: radius\r\n    },\r\n    rightFirst: {\r\n      borderTopRightRadius: radius\r\n    },\r\n    rightLast: {\r\n      borderBottomRightRadius: radius\r\n    }\r\n  };\r\n};\r\n","import React, {useEffect, useRef, useState} from 'react';\r\nimport ChatMsg from './ChatMsg';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {TextField} from '@material-ui/core';\r\nimport SendIcon from '@material-ui/icons/Send';\r\nimport {connect} from 'react-redux';\r\nimport {sendMessage} from '../../../../store/actions/chat.actions';\r\n\r\nconst useStyles = makeStyles({\r\n  chat: {\r\n    height: '100vh',\r\n    display: 'flex',\r\n    flexFlow: 'column nowrap',\r\n    width: '320px'\r\n  },\r\n  chatFeed: {\r\n    display: 'flex',\r\n    flexFlow: 'column nowrap',\r\n    flexGrow: 1,\r\n    maxHeight: 'calc(100% - 60px)',\r\n    overflow: 'auto',\r\n    padding: '8px'\r\n  },\r\n  chatInput: {\r\n    display: 'flex',\r\n    flexFlow: 'row nowrap',\r\n    alignItems: 'flex-end',\r\n    padding: '8px'\r\n  },\r\n  chatInputTextfield: {\r\n    flexGrow: 1,\r\n    zIndex: 1000,\r\n    backgroundColor: 'white'\r\n  },\r\n  chatInputSendBtn: {\r\n    fontSize: '40px',\r\n    margin: 'auto 5px',\r\n    cursor: 'pointer',\r\n    opacity: 0.8,\r\n    transition: 'opacity 0.2s',\r\n    '&:hover': {\r\n      opacity: 0.95\r\n    }\r\n  }\r\n});\r\n\r\nconst Chat = ({ dispatch, chatData, socket }) => {\r\n  const classes = useStyles('');\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const feedRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (feedRef.current) {\r\n      feedRef.current.scrollTop = feedRef.current.scrollHeight;\r\n    }\r\n  }, [chatData]);\r\n\r\n  const handleChangeTexfield = (event) => {\r\n    setNewMessage(event.target.value);\r\n  };\r\n\r\n  const handleKeyPress = (event) => {\r\n    if (event.key === 'Enter') {\r\n      if (event.shiftKey) {\r\n        setNewMessage(newMessage.concat('\\n'));\r\n      } else {\r\n        send(event);\r\n      }\r\n    }\r\n  };\r\n\r\n  const send = (e) => {\r\n    e.preventDefault();\r\n    if (newMessage.replace(/\\n/g, '').length) {\r\n      dispatch(sendMessage(newMessage));\r\n      setNewMessage('');\r\n    }\r\n  };\r\n\r\n  //handle the chat feed to display all messages on the right position\r\n  const chatMessages = chatData.map((message, i) => message.authorSocketId === socket.id\r\n    ? <ChatMsg key={i} side={'right'} messages={[message.text]}/>\r\n    : <ChatMsg key={i} avatar={''} messages={[message.text]}/>\r\n  );\r\n\r\n  return (\r\n    <div className={classes.chat}>\r\n\r\n      <div className={classes.chatFeed} ref={feedRef}>\r\n        {chatMessages}\r\n      </div>\r\n\r\n      <div className={classes.chatInput}>\r\n        <TextField\r\n          variant=\"outlined\"\r\n          multiline\r\n          rowsMax={5}\r\n          className={classes.chatInputTextfield}\r\n          onChange={handleChangeTexfield}\r\n          onKeyPress={handleKeyPress}\r\n          value={newMessage}\r\n          autoFocus\r\n        />\r\n        <SendIcon className={classes.chatInputSendBtn} onClick={send}/>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = state => ({\r\n  chatData: state.chat,\r\n  socket: state.localUser.socket\r\n});\r\n\r\nexport default connect(mapStateToProps)(Chat);\r\n","import {ADD_NEW_MESSAGE} from '../actionTypes';\r\nimport {sendDataToConnection} from './connections.actions';\r\n\r\nexport const sendMessage = (text) => async (dispatch, getState) => {\r\n  const connections = Object.values(getState().connections.data);\r\n  const socket = getState().localUser.socket;\r\n\r\n  if (socket) {\r\n    connections.forEach(connection => {\r\n      // FIXME change to use separate data channel only for chat instead of identifying it by type or specific properties\r\n      const message = {\r\n        textMessage: { text: text, authorSocketId: socket.id }\r\n      };\r\n\r\n      dispatch(sendDataToConnection(connection.defaultDataChannel, message));\r\n    });\r\n\r\n    dispatch({\r\n      type: ADD_NEW_MESSAGE,\r\n      payload: { text: text, authorSocketId: socket.id }\r\n    });\r\n  } else {\r\n    console.error('socket not found');\r\n  }\r\n};\r\n","import React, {useState} from 'react';\r\nimport {ThemeProvider} from '@material-ui/core/styles';\r\nimport {Button, Drawer} from '@material-ui/core';\r\nimport ChatIcon from '@material-ui/icons/Chat';\r\nimport theme from '../../../style/theme/MainTheme';\r\nimport Chat from './Chat/Chat';\r\n\r\nconst RoomSidebarChat = () => {\r\n  const [open, setOpen] = useState(false);\r\n\r\n  const toggleDrawer = _ => setOpen(!open);\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      <Button onClick={toggleDrawer}>\r\n        <ChatIcon color='primary' fontSize='large'/>\r\n      </Button>\r\n      <Drawer open={open} onClose={toggleDrawer} anchor={'right'}>\r\n        <Chat/>\r\n      </Drawer>\r\n    </ThemeProvider>\r\n  );\r\n};\r\n\r\nexport default RoomSidebarChat;\r\n","import React from 'react';\r\nimport {Box, Button} from '@material-ui/core';\r\nimport HomeIcon from '@material-ui/icons/Home';\r\nimport MicNoneIcon from '@material-ui/icons/MicNone';\r\nimport MicOffIcon from '@material-ui/icons/MicOff';\r\nimport RoomSidebarMenu from '../RoomSidebarMenu/RoomSidebarMenu';\r\nimport MicIcon from '@material-ui/icons/Mic';\r\nimport VideocamIcon from '@material-ui/icons/Videocam';\r\nimport VideocamOffIcon from '@material-ui/icons/VideocamOff';\r\nimport RoomSidebarChat from '../RoomSidebarChat/RoomSidebarChat';\r\nimport {Link} from 'react-router-dom';\r\nimport {connect} from 'react-redux';\r\nimport {toggleCameraEnabled, toggleMicrophoneEnabled} from '../../../store/actions/localStream.actions';\r\n\r\nconst RoomActionbar = ({ localStreamWrapper, dispatch }) => {\r\n\r\n  const setAudioIcon = () => {\r\n    if (localStreamWrapper) {\r\n      const audioTrack = localStreamWrapper.stream.getAudioTracks()[0];\r\n      if (audioTrack) {\r\n        return audioTrack.enabled\r\n          ? <MicIcon color='primary' fontSize='large'/>\r\n          : <MicOffIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <MicNoneIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  const setVideoIcon = () => {\r\n    if (localStreamWrapper) {\r\n      const videoTrack = localStreamWrapper.stream.getVideoTracks()[0];\r\n      if (videoTrack && videoTrack.enabled) {\r\n        return <VideocamIcon color='primary' fontSize='large'/>;\r\n      }\r\n    }\r\n    return <VideocamOffIcon color='primary' fontSize='large'/>;\r\n  };\r\n\r\n  return (\r\n    <Box\r\n      bgcolor={'#f5deb3eb'}\r\n      height={'10%'}\r\n      display='flex'\r\n      justifyContent={'center'}\r\n      borderTop={'1px solid #0000003b'}\r\n      alignItems={'center'}\r\n    >\r\n      {/* toggle room menu settings */}\r\n      <RoomSidebarMenu/>\r\n\r\n      {/* Navigate to landing page */}\r\n      <Link to={'/'} style={{ height: '100%' }}>\r\n        <Button style={{ height: '100%' }}>\r\n          <HomeIcon color='primary' fontSize='large'/>\r\n        </Button>\r\n      </Link>\r\n\r\n      {/* toggle Microphone audio track */}\r\n      <Button style={{ height: '100%' }} onClick={() => dispatch(toggleMicrophoneEnabled())}>\r\n        {setAudioIcon()}\r\n      </Button>\r\n\r\n      {/* toggle camera video track */}\r\n      <Button style={{ height: '100%' }} onClick={() => dispatch(toggleCameraEnabled())}>\r\n        {setVideoIcon()}\r\n      </Button>\r\n\r\n      {/* toggle chat */}\r\n      <RoomSidebarChat/>\r\n    </Box>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    localStreamWrapper: state.localUser.mediaStream\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(RoomActionbar);\r\n","import React, {useEffect} from 'react';\r\nimport {Box} from '@material-ui/core';\r\nimport RoomPluginContent from './RoomPluginContent/RoomPluginContent';\r\nimport RoomMediaManager from './RoomMediaManager/RoomMediaManager';\r\nimport {connect} from 'react-redux';\r\nimport {joinRoom} from '../../store/actions/connections.actions';\r\nimport {initLocalUser} from '../../store/actions/localUser.actions';\r\nimport RoomActionbar from './RoomActionbar/RoomActionbar';\r\nimport {roomExitCleanup} from '../../store/actions/room.actions';\r\n\r\nconst Room = ({ dispatch, socket, match, history, roomError, currentRoom, localPeerLoading, visitedLobby }) => {\r\n\r\n  useEffect(() => {\r\n    if (roomError || !visitedLobby) {\r\n      history.push(`/room-lobby/${match.params.roomId}`);\r\n    } else if (!socket && !localPeerLoading) {\r\n      dispatch(initLocalUser());\r\n    } else if (socket && socket.id && !currentRoom.id) {\r\n      dispatch(joinRoom(match.params.roomId, 'dummy123'));\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [roomError, socket]);\r\n\r\n  useEffect(() => {\r\n    // unmount\r\n    return () => dispatch(roomExitCleanup());\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      <Box display='flex' flexDirection='column' width={1} height={'100%'} justifyContent={'space-between'}>\r\n        <Box display='flex' flexDirection='row' width={1} height={'90%'} justifyContent={'space-between'}>\r\n          <RoomPluginContent/>\r\n          <RoomMediaManager/>\r\n        </Box>\r\n        <RoomActionbar/>\r\n      </Box>\r\n    </>\r\n  );\r\n};\r\n\r\nconst mapStateToProps = (state) => {\r\n  return {\r\n    socket: state.localUser.socket,\r\n    localPeerLoading: state.localUser.loading,\r\n    roomError: state.room.error,\r\n    currentRoom: state.room.data,\r\n    visitedLobby: state.room.visitedLobby\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps)(Room);\r\n","export const BACKEND_URL = process.env.REACT_APP_BACKEND_URL || window.location.origin;\r\n","import React from 'react';\r\nimport {makeStyles} from '@material-ui/core/styles';\r\nimport {Typography, useMediaQuery} from '@material-ui/core';\r\nimport AssessmentOutlinedIcon from '@material-ui/icons/AssessmentOutlined';\r\nimport CallOutlinedIcon from '@material-ui/icons/CallOutlined';\r\nimport VideogameAssetIcon from '@material-ui/icons/VideogameAsset';\r\n\r\nconst useStyles = makeStyles({\r\n  container: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    width: 314,\r\n    height: 400,\r\n    border: 'solid 1px lightgrey',\r\n    backgroundColor: 'white'\r\n  },\r\n  smallScreenContainer: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    width: 314,\r\n    height: 400,\r\n    border: 'solid 1px lightgrey',\r\n    backgroundColor: 'white',\r\n    margin: 8\r\n  },\r\n  alignTitle: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    margin: 24\r\n  },\r\n  customizeTitle: {\r\n    fontWeight: 'bold',\r\n    fontSize: '25px',\r\n    marginLeft: 4\r\n  },\r\n  customizeIcon: {\r\n    marginRight: 4,\r\n    color: 'rgb(46, 125, 50)'\r\n  },\r\n  customizeText: {\r\n    paddingLeft: 16,\r\n    paddingRight: 16,\r\n    marginBottom: 16\r\n  }\r\n});\r\n\r\nconst BulletPoint = (props) => {\r\n  const classes = useStyles();\r\n  const smallScreen = useMediaQuery('(max-width: 950px)');\r\n\r\n  const checkIcons = (icon) => {\r\n    if (icon === 'VideogameAssetIcon') {\r\n      return <VideogameAssetIcon fontSize='large' className={classes.customizeIcon}/>;\r\n    } else if (icon === 'AssessmentOutlinedIcon') {\r\n      return <AssessmentOutlinedIcon fontSize='large' className={classes.customizeIcon}/>;\r\n    } else if (icon === 'CallOutlinedIcon') {\r\n      return <CallOutlinedIcon fontSize='large' className={classes.customizeIcon}/>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={smallScreen ? classes.smallScreenContainer : classes.container}>\r\n      <div className={classes.alignTitle}>\r\n        {checkIcons(props.content.icon)}\r\n        <Typography variant='h4' className={classes.customizeTitle}>{props.content.title}</Typography>\r\n      </div>\r\n      <Typography className={classes.customizeText} align='center'>{props.content.text}</Typography>\r\n      <img src={props.content.image} height='181' width='275' alt='icon'/>\r\n    </div>\r\n  );\r\n};\r\nexport default BulletPoint;\r\n","import React from 'react';\r\nimport {makeStyles, ThemeProvider} from '@material-ui/core/styles';\r\nimport {Typography, Box, Button, useMediaQuery} from '@material-ui/core';\r\nimport theme from '../../style/theme/MainTheme';\r\nimport {Link} from 'react-router-dom';\r\nimport BulletPoint from './BulletPoint/BulletPoint';\r\n\r\nconst useStyles = makeStyles({\r\n  header: {\r\n    color: 'white',\r\n    textTransform: 'uppercase',\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    alignItems: 'center'\r\n  },\r\n  box: {\r\n    display: 'flex',\r\n    width: '100%',\r\n    height: '100%',\r\n    justifyContent: 'center'\r\n  },\r\n  smallScreenBox: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    width: '100%',\r\n    height: '100%',\r\n    alignItems: 'center'\r\n  },\r\n  titleContainer: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    width: '40%',\r\n    minWidth: 310\r\n  },\r\n  titleStyle: {\r\n    color: 'white',\r\n    fontWeight: 'bold',\r\n    marginTop: '98px'\r\n  },\r\n  buttonStyle: {\r\n    borderRadius: '5px',\r\n    fontWeight: 'bold',\r\n    color: 'white',\r\n    backgroundColor: '#FBC02D',\r\n    '&:hover': {\r\n      backgroundColor: '#f9a825'\r\n    },\r\n    '&:focus': {\r\n      outline: 0\r\n    }\r\n  },\r\n  mainImg: {\r\n    display: 'flex',\r\n    height: 224,\r\n    width: 309,\r\n    borderRadius: 5,\r\n    marginTop: 76,\r\n    marginLeft: 36,\r\n    marginRight: 36\r\n  },\r\n  smallScreenMainImg: {\r\n    display: 'flex',\r\n    height: 224,\r\n    width: 309,\r\n    borderRadius: 5,\r\n    margin: 36\r\n  },\r\n  bulletPoints: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    zIndex: '3',\r\n    position: 'relative',\r\n    bottom: 150\r\n  },\r\n  smallScreenBulletPoints: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    alignItems: 'center',\r\n    marginTop: 72\r\n  }\r\n});\r\n\r\nconst Home = () => {\r\n  const classes = useStyles();\r\n  const smallScreen = useMediaQuery('(max-width: 950px)');\r\n  const bulletPoints = [\r\n    {\r\n      title: 'Gaming',\r\n      icon: 'VideogameAssetIcon',\r\n      image: 'https://via.placeholder.com/400x300',\r\n      text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet.'\r\n    },\r\n    {\r\n      title: 'Working',\r\n      icon: 'AssessmentOutlinedIcon',\r\n      image: 'https://via.placeholder.com/400x300',\r\n      text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet.'\r\n    },\r\n    {\r\n      title: 'Chatting',\r\n      icon: 'CallOutlinedIcon',\r\n      image: 'https://via.placeholder.com/400x300',\r\n      text: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec nec urna dolor. Maecenas vehicula dui ut quam imperdiet.'\r\n    }\r\n  ];\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      {/* Header */}\r\n      <Box height={63} bgcolor='#2E7D32' className={classes.header}>\r\n        <h1>\r\n          <span role={'img'} aria-label={'a duck'}>🦆 </span>\r\n          Quackamole\r\n          <span role={'img'} aria-label={'an avocado'}> 🥑</span>\r\n        </h1>\r\n      </Box>\r\n\r\n      {/* Body */}\r\n      <Box height={540} display='flex' zIndex={1}>\r\n        <Box className={smallScreen ? classes.smallScreenBox : classes.box} bgcolor='#388E3C'>\r\n          <div className={classes.titleContainer}>\r\n            <Typography variant='h3' className={classes.titleStyle} gutterBottom align='center'>\r\n              Peer-to-peer video chat platform\r\n            </Typography>\r\n            <Link to=\"/create-room\" style={{ textDecoration: 'none' }}>\r\n              <Button size=\"large\" className={classes.buttonStyle}>Create a room</Button>\r\n            </Link>\r\n          </div>\r\n          <img\r\n            src='https://via.placeholder.com/400x300'\r\n            className={smallScreen ? classes.smallScreenMainImg : classes.mainImg}\r\n            alt={'quackamole room preview'}\r\n          />\r\n        </Box>\r\n      </Box>\r\n\r\n      {/* Bullet Points */}\r\n      <div className={smallScreen ? classes.smallScreenBulletPoints : classes.bulletPoints}>\r\n        {bulletPoints.map((data, i) => <BulletPoint content={data} key={data.title + i}> </BulletPoint>)}\r\n      </div>\r\n\r\n      {/*Temporary for debugging purposes*/}\r\n      <Link to={'/rooms/dummy-room-id'}>Test room</Link>\r\n    </ThemeProvider>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n","import React, {useState} from 'react';\r\nimport {Link, useHistory} from 'react-router-dom';\r\nimport {makeStyles, ThemeProvider} from '@material-ui/core/styles';\r\nimport {Box, Button, Grid, TextField, Typography} from '@material-ui/core';\r\nimport theme from '../../style/theme/MainTheme';\r\nimport ArrowBackIosIcon from '@material-ui/icons/ArrowBackIos';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport {BACKEND_URL} from '../../constants';\r\n\r\nconst useStyles = makeStyles({\r\n  containerStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    paddingTop: '128px'\r\n  },\r\n  titleStyle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    padding: '16px',\r\n    color: 'white',\r\n    fontWeight: 'bold',\r\n    backgroundColor: '#388E3C',\r\n    width: '100%'\r\n  },\r\n  formControl: {\r\n    width: '20%',\r\n    margin: '16px'\r\n  },\r\n  select: {\r\n    borderColor: '#FB8C00',\r\n    '&:before': {\r\n      borderColor: '#FB8C00'\r\n    },\r\n    '&:after': {\r\n      borderColor: '#f57c00'\r\n    }\r\n  },\r\n  textfield: {\r\n    width: '90%',\r\n    marginTop: '48px'\r\n  },\r\n  textfieldLink: {\r\n    width: '90%',\r\n    marginRight: '16px',\r\n    marginLeft: '16px'\r\n  },\r\n  alignButton: {\r\n    display: 'flex',\r\n    justifyContent: 'flex-end',\r\n    width: '100%',\r\n    padding: '16px'\r\n  },\r\n  btnCreateWrapper: {\r\n    position: 'relative'\r\n  },\r\n  btnCreate: {\r\n    color: 'white',\r\n    boxShadow: 'none'\r\n  },\r\n  fabProgress: {\r\n    position: 'absolute',\r\n    top: -6,\r\n    left: -6,\r\n    zIndex: 1\r\n  },\r\n  btnCreateProgress: {\r\n    position: 'absolute',\r\n    top: '50%',\r\n    left: '50%',\r\n    marginTop: -12,\r\n    marginLeft: -12\r\n  },\r\n  paper: {\r\n    padding: theme.spacing(2),\r\n    textAlign: 'center',\r\n    color: theme.palette.text.secondary\r\n  },\r\n  copyLink: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    marginTop: '16px',\r\n    width: '90%'\r\n  },\r\n  nextButton: {\r\n    color: 'white',\r\n    boxShadow: 'none',\r\n    marginBottom: '16px',\r\n    width: '100%'\r\n  },\r\n  subtitle: {\r\n    display: 'flex',\r\n    justifyContent: 'center',\r\n    margin: '16px'\r\n  }\r\n});\r\n\r\nconst RoomCreateForm = () => {\r\n  const [name, setName] = useState('');\r\n  const [link, setLink] = useState('');\r\n  const [roomId, setRoomId] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const classes = useStyles();\r\n  const history = useHistory();\r\n\r\n  const handleChangeTexfield = (event) => {\r\n    setName(event.target.value);\r\n  };\r\n\r\n  const handleKeyPress = async (evt) => {\r\n    if (!loading && evt.key === 'Enter') {\r\n      if (!roomId) {\r\n        await createRoom();\r\n      } else if (!error && roomId) {\r\n        history.push(`/room-lobby/${roomId}`);\r\n      }\r\n\r\n    }\r\n  };\r\n\r\n  const createRoom = async () => {\r\n    try {\r\n      let data = {\r\n        name: name,\r\n        password: 'Test123.',\r\n        maxUsers: 4\r\n      };\r\n\r\n      if (data.name.length === 0) {\r\n        setError(new Error('The room needs a name'));\r\n        return;\r\n      }\r\n\r\n      setLoading(true);\r\n      const res = await fetch(`${BACKEND_URL}/api/rooms`, {\r\n        method: 'post',\r\n        body: JSON.stringify(data),\r\n        headers: { 'Content-Type': 'application/json' }\r\n      });\r\n      setLoading(false);\r\n\r\n      if (res.status >= 400) {\r\n        setError(new Error(`Something went wrong. Try again`));\r\n        return;\r\n      }\r\n\r\n      const room = await res.json();\r\n      if (room) {\r\n        setError(null);\r\n        setRoomId(room.id);\r\n        setLink(`${window.location.origin}/#/room-lobby/${room.id}`);\r\n      }\r\n    } catch (err) {\r\n      setError(err);\r\n    }\r\n  };\r\n\r\n  const createRoomJSX =\r\n    <Box display='flex' flexDirection='column' alignItems='center' width={'100%'} borderRadius='5px' bgcolor='white'>\r\n      <Typography variant='h4' className={classes.titleStyle}>Create a new room</Typography>\r\n      <TextField\r\n        required\r\n        label='Room name'\r\n        variant='outlined'\r\n        value={name}\r\n        onChange={handleChangeTexfield}\r\n        className={classes.textfield}\r\n        onKeyPress={handleKeyPress}\r\n        autoFocus\r\n      />\r\n      <div className={classes.alignButton}>\r\n        <div className={classes.btnCreateWrapper}>\r\n          <Button\r\n            size='large'\r\n            color='secondary'\r\n            variant='contained'\r\n            disabled={loading}\r\n            className={classes.btnCreate}\r\n            onClick={createRoom}\r\n          >\r\n            Create\r\n          </Button>\r\n          {loading && <CircularProgress size={24} className={classes.btnCreateProgress}/>}\r\n        </div>\r\n      </div>\r\n    </Box>;\r\n\r\n  const shareRoomJSX =\r\n    <Box\r\n      display='flex'\r\n      flexDirection='column'\r\n      alignItems='center'\r\n      width={'100%'}\r\n      borderRadius='5px'\r\n      bgcolor='white'\r\n      onKeyPress={handleKeyPress}\r\n    >\r\n      <Typography variant='h4' className={classes.titleStyle}>Room was created</Typography>\r\n      <div className={classes.copyLink}>\r\n        <TextField variant='outlined' value={link} onChange={handleChangeTexfield} className={classes.textfieldLink} autoFocus/>\r\n        <Button size='large' color='secondary' variant='contained' className={classes.myButton} onClick={() => {\r\n          navigator.clipboard.writeText(link);\r\n        }}>\r\n          copy\r\n        </Button>\r\n      </div>\r\n      <Typography variant='h6' align='center' className={classes.subtitle}>\r\n        Share the link to let people join this room\r\n      </Typography>\r\n\r\n      <Link to={`/room-lobby/${roomId}`} style={{ textDecoration: 'none', width: '80%' }}>\r\n        <Button\r\n          size='large'\r\n          color='secondary'\r\n          variant='contained'\r\n          className={classes.nextButton}\r\n          to={`/room-lobby/${roomId}`}\r\n        >\r\n          next\r\n        </Button>\r\n      </Link>\r\n    </Box>;\r\n\r\n  return (\r\n    <ThemeProvider theme={theme}>\r\n      {/* Header */}\r\n      <Box\r\n        display='flex'\r\n        height={63}\r\n        bgcolor='#2E7D32'\r\n        alignItems='center'\r\n        paddingLeft='36px'\r\n      >\r\n        <Link to='/' style={{ textDecoration: 'none', color: 'white' }}>\r\n          <ArrowBackIosIcon/>\r\n        </Link>\r\n      </Box>\r\n\r\n      {/* Body */}\r\n      <Grid container className={classes.containerStyle}>\r\n        <Grid item xs={11} md={6} lg={6}>\r\n          {roomId ? shareRoomJSX : createRoomJSX}\r\n          {error && <Box color={'red'} textAlign={'center'}>{error.message}</Box>}\r\n        </Grid>\r\n      </Grid>\r\n    </ThemeProvider>\r\n  );\r\n};\r\n\r\nexport default RoomCreateForm;\r\n","import React from 'react';\r\nimport {HashRouter as Router, Route, Switch} from 'react-router-dom';\r\nimport {CssBaseline} from '@material-ui/core';\r\nimport RoomLobby from '../RoomLobby/RoomLobby';\r\nimport Room from '../Room/Room';\r\nimport Home from '../Home/Home';\r\nimport RoomCreateForm from '../RoomCreateForm/RoomCreateForm';\r\n\r\nconst App = () => {\r\n  return (\r\n    <CssBaseline>\r\n      <Router>\r\n        <Switch>\r\n          <Route exact path='/' component={Home}/>\r\n          <Route exact path='/create-room' component={RoomCreateForm}/>\r\n          <Route exact path='/room-lobby/:roomId' component={RoomLobby}/>\r\n          <Route path='/rooms/:roomId' component={Room}/>\r\n        </Switch>\r\n      </Router>\r\n    </CssBaseline>\r\n  );\r\n};\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport './index.scss';\r\nimport ReactDOM from 'react-dom';\r\nimport {Provider} from 'react-redux';\r\nimport store from './store';\r\nimport App from './components/App/App';\r\n// eslint-disable-next-line\r\nimport adapter from 'webrtc-adapter'; // insulates app from browser webrtc implementation differences\r\n\r\nReactDOM.render(\r\n  <>\r\n    <Provider store={store}>\r\n      <App/>\r\n    </Provider>\r\n  </>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}